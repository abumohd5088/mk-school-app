<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MKPS Admin Panel — Firebase-ready</title>
  <meta name="description" content="Admin panel for Mili Karwaan Public School — manage homework, notices, events, gallery, students, teachers." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#0f766e;--accent2:#f59e0b;--muted:#94a3b8}
    *{box-sizing:border-box}
    body{font-family:'Inter',system-ui,Segoe UI,Roboto,sans-serif;margin:0;background:linear-gradient(180deg,#02121a,#071827);color:#e6f3ef}
    .wrap{max-width:1200px;margin:20px auto;padding:18px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.08));padding:14px;border-radius:12px;margin-bottom:12px;box-shadow:0 8px 24px rgba(2,6,23,.5)}
    h1{margin:0 0 8px;font-size:1.25rem}
    .row{display:flex;gap:12px}
    input,select,textarea{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;padding:10px 12px;border-radius:8px;color:#042018;font-weight:700;cursor:pointer}
    .muted{color:var(--muted)}
    .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:left}
    .small{font-size:.9rem}
    .hidden{display:none}
    .toolbar{display:flex;gap:8px;align-items:center}
    .badge{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:8px}
    .file-preview{max-height:120px;border-radius:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="loginCard">
      <h1>Admin Login (Local guard)</h1>
      <p class="muted">This admin panel is Firebase-ready. If you enable Firebase Auth later, switch the login flow — see README comments inside the file.</p>
      <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
        <input id="adminPwd" type="password" placeholder="Enter admin password" style="flex:1" />
        <button id="loginBtn">Login</button>
      </div>
      <p class="muted small">Default admin password: <strong>Abutalha</strong></p>
    </div><div id="adminPanel" class="hidden">
  <div class="card">
    <div style="display:flex;align-items:center;gap:12px;justify-content:space-between">
      <div>
        <h1>MKPS Admin</h1>
        <div class="muted small">Manage site data: homework, notices, events, gallery, students, teachers. LocalStorage & Firebase-ready.</div>
      </div>
      <div class="toolbar">
        <button id="logoutBtn" style="background:#ffb4b4">Logout</button>
        <button id="exportAll">Export JSON</button>
        <button id="importAll">Import JSON</button>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Quick Actions</h2>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
      <button id="addNoticeBtn">Add Notice</button>
      <button id="addHwBtn">Add Homework</button>
      <button id="addEventBtn">Add Event</button>
      <button id="addGalleryBtn">Add Gallery Image</button>
      <button id="clearLocalBtn" style="background:#ffb4b4">Clear Local Data</button>
    </div>
  </div>

  <div class="card">
    <h2>Notices</h2>
    <div id="noticesArea"></div>
  </div>

  <div class="card">
    <h2>Homework</h2>
    <div id="homeworkArea"></div>
  </div>

  <div class="card">
    <h2>Events</h2>
    <div id="eventsArea"></div>
  </div>

  <div class="card">
    <h2>Gallery</h2>
    <div id="galleryArea"></div>
  </div>

  <div class="card">
    <h2>Students & Teachers (CSV Import/Export)</h2>
    <div style="display:flex;gap:8px;align-items:center">
      <input id="csvFile" type="file" accept=".csv" />
      <button id="importCsv">Import CSV</button>
      <button id="exportCsv">Export CSV</button>
    </div>
  </div>

  <div class="card">
    <h2>Firebase Setup (Optional)</h2>
    <p class="muted small">Paste your Firebase config here to enable Firestore/Storage integration. For now the panel works with localStorage. Replace the placeholders in the comments to connect to Firebase.</p>
    <pre style="background:#021421;padding:10px;border-radius:8px;color:#8be5cf;font-size:.85rem;overflow:auto">// firebaseConfig = {

//   apiKey: "...", //   authDomain: "...", //   projectId: "...", //   storageBucket: "...", //   messagingSenderId: "...", //   appId: "..." // }</pre> </div>

</div>

  </div>  <script>
    // Admin panel (local + firebase-ready)
    const ADMIN_PWD = 'Abutalha' // set by you
    const STORAGE_KEY = 'MKPS_ADMIN_v1'
    const DEFAULT = {
      notices:[{id:'n1',title:'Parent-Teacher Meeting',date:'2025-11-28',time:'4:00 PM',body:'All parents are requested to attend.'}],
      homework:[{id:'h1',subject:'Mathematics',title:'Chapter 5: Algebra',due:'2025-11-25',notes:'Solve exercise 5.3 Q1-15.'}],
      events:[{id:'e1',title:'Annual Sports Day',date:'2025-12-06',desc:'Sports activities for all grades.'}],
      gallery:['https://i.postimg.cc/Zqm9DSvt/erasebg-transformed.png'],
      students:[], teachers:[]
    }

    function loadStore(){ try{ const raw = localStorage.getItem(STORAGE_KEY); return raw?JSON.parse(raw):JSON.parse(JSON.stringify(DEFAULT)); }catch(e){ return JSON.parse(JSON.stringify(DEFAULT)) }}
    function saveStore(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)) }
    let STORE = loadStore()

    // login
    const loginCard = document.getElementById('loginCard');
    const adminPanel = document.getElementById('adminPanel');
    document.getElementById('loginBtn').addEventListener('click', ()=>{ const v=document.getElementById('adminPwd').value; if(v===ADMIN_PWD){ loginCard.classList.add('hidden'); adminPanel.classList.remove('hidden'); renderAll(); } else alert('Wrong password') });
    document.getElementById('logoutBtn').addEventListener('click', ()=>{ if(confirm('Logout?')) location.reload() })

    // render functions
    function renderAll(){ renderNotices(); renderHomework(); renderEvents(); renderGallery(); }

    function renderNotices(){ const el=document.getElementById('noticesArea'); if(!STORE.notices.length) el.innerHTML='<div class="muted">No notices</div>'; else el.innerHTML = `<table><thead><tr><th>Title</th><th>Date</th><th>Actions</th></tr></thead><tbody>${STORE.notices.map(n=>`<tr data-id="${n.id}"><td>${escapeHtml(n.title)}</td><td>${n.date} ${n.time? ' | '+n.time : ''}</td><td><button class="editNotice">Edit</button> <button class="delNotice" style="background:#ffb4b4">Delete</button></td></tr>`).join('')}</tbody></table>`; setNoticeHandlers(); }
    function renderHomework(){ const el=document.getElementById('homeworkArea'); if(!STORE.homework.length) el.innerHTML='<div class="muted">No homework</div>'; else el.innerHTML = `<table><thead><tr><th>Subject</th><th>Title</th><th>Due</th><th>Actions</th></tr></thead><tbody>${STORE.homework.map(h=>`<tr data-id="${h.id}"><td>${escapeHtml(h.subject)}</td><td>${escapeHtml(h.title)}</td><td>${h.due}</td><td><button class="editHw">Edit</button> <button class="delHw" style="background:#ffb4b4">Delete</button></td></tr>`).join('')}</tbody></table>`; setHwHandlers(); }
    function renderEvents(){ const el=document.getElementById('eventsArea'); if(!STORE.events.length) el.innerHTML='<div class="muted">No events</div>'; else el.innerHTML = `<table><thead><tr><th>Event</th><th>Date</th><th>Actions</th></tr></thead><tbody>${STORE.events.map(ev=>`<tr data-id="${ev.id}"><td>${escapeHtml(ev.title)}</td><td>${ev.date}</td><td><button class="editEv">Edit</button> <button class="delEv" style="background:#ffb4b4">Delete</button></td></tr>`).join('')}</tbody></table>`; setEventHandlers(); }
    function renderGallery(){ const el=document.getElementById('galleryArea'); if(!STORE.gallery.length) el.innerHTML='<div class="muted">No images</div>'; else el.innerHTML = `<div style="display:flex;gap:8px;flex-wrap:wrap">${STORE.gallery.map((g,i)=>`<div style="width:120px"><img src="${g}" alt="g${i}" style="width:100%;height:80px;object-fit:cover;border-radius:8px" /><div style="display:flex;gap:6px;margin-top:6px"><button class="delGallery" data-src="${g}" style="background:#ffb4b4">Del</button></div></div>`).join('')}</div>`; setGalleryHandlers(); }

    function setNoticeHandlers(){ $$('.editNotice').forEach(btn=>btn.addEventListener('click', ()=>{ const id = btn.closest('tr').dataset.id; editNotice(id); })); $$('.delNotice').forEach(btn=>btn.addEventListener('click', ()=>{ const id = btn.closest('tr').dataset.id; if(confirm('Delete notice?')){ STORE.notices = STORE.notices.filter(x=>x.id!==id); saveStore(STORE); renderNotices(); }})); }
    function setHwHandlers(){ $$('.editHw').forEach(btn=>btn.addEventListener('click', ()=>{ const id=btn.closest('tr').dataset.id; editHw(id); })); $$('.delHw').forEach(btn=>btn.addEventListener('click', ()=>{ const id=btn.closest('tr').dataset.id; if(confirm('Delete homework?')){ STORE.homework = STORE.homework.filter(x=>x.id!==id); saveStore(STORE); renderHomework(); }})); }
    function setEventHandlers(){ $$('.editEv').forEach(btn=>btn.addEventListener('click', ()=>{ const id=btn.closest('tr').dataset.id; editEvent(id); })); $$('.delEv').forEach(btn=>btn.addEventListener('click', ()=>{ const id=btn.closest('tr').dataset.id; if(confirm('Delete event?')){ STORE.events = STORE.events.filter(x=>x.id!==id); saveStore(STORE); renderEvents(); }})); }
    function setGalleryHandlers(){ $$('.delGallery').forEach(btn=>btn.addEventListener('click', ()=>{ const src=btn.dataset.src; if(confirm('Delete image?')){ STORE.gallery = STORE.gallery.filter(x=>x!==src); saveStore(STORE); renderGallery(); }})); }

    // add actions
    document.getElementById('addNoticeBtn').addEventListener('click', ()=>{ const title=prompt('Title:'); if(!title) return; const date=prompt('Date (YYYY-MM-DD):','2025-11-28'); const time=prompt('Time (optional):','4:00 PM'); const body=prompt('Details:',''); const id='n'+Math.random().toString(36).slice(2,9); STORE.notices.unshift({id,title,date,time,body}); saveStore(STORE); renderNotices(); alert('Notice added (local)') });
    document.getElementById('addHwBtn').addEventListener('click', ()=>{ const subject=prompt('Subject:','Mathematics'); if(!subject) return; const title=prompt('Title:','Chapter 6'); const due=prompt('Due date (YYYY-MM-DD):','2025-11-25'); const notes=prompt('Notes:',''); const id='h'+Math.random().toString(36).slice(2,9); STORE.homework.unshift({id,subject,title,due,notes}); saveStore(STORE); renderHomework(); alert('Homework added (local)') });
    document.getElementById('addEventBtn').addEventListener('click', ()=>{ const title=prompt('Event:'); if(!title) return; const date=prompt('Date (YYYY-MM-DD):','2025-12-06'); const id='e'+Math.random().toString(36).slice(2,9); STORE.events.unshift({id,title,date}); saveStore(STORE); renderEvents(); alert('Event added (local)') });
    document.getElementById('addGalleryBtn').addEventListener('click', ()=>{ const url=prompt('Image URL (direct link):'); if(!url) return; STORE.gallery.unshift(url); saveStore(STORE); renderGallery(); alert('Image added (local)') });

    // edit handlers (simple prompts)
    function editNotice(id){ const n = STORE.notices.find(x=>x.id===id); if(!n) return; const title = prompt('Title:',n.title); if(!title) return; const date = prompt('Date:',n.date); const time = prompt('Time:',n.time||''); const body = prompt('Details:',n.body||''); n.title=title; n.date=date; n.time=time; n.body=body; saveStore(STORE); renderNotices(); }
    function editHw(id){ const h = STORE.homework.find(x=>x.id===id); if(!h) return; const subject = prompt('Subject:',h.subject); if(!subject) return; const title = prompt('Title:',h.title); const due = prompt('Due:',h.due); const notes = prompt('Notes:',h.notes||''); h.subject=subject; h.title=title; h.due=due; h.notes=notes; saveStore(STORE); renderHomework(); }
    function editEvent(id){ const e = STORE.events.find(x=>x.id===id); if(!e) return; const title = prompt('Event:',e.title); if(!title) return; const date = prompt('Date:',e.date); e.title=title; e.date=date; saveStore(STORE); renderEvents(); }

    // import/export JSON
    document.getElementById('exportAll').addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify(STORE,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='mkps-admin-data.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
    document.getElementById('importAll').addEventListener('click', ()=>{ const input=document.createElement('input'); input.type='file'; input.accept='.json'; input.onchange=()=>{ const f=input.files[0]; const r=new FileReader(); r.onload=()=>{ try{ const parsed=JSON.parse(r.result); STORE = parsed; saveStore(STORE); renderAll(); alert('Imported') }catch(e){ alert('Invalid JSON') } }; r.readAsText(f); }; input.click(); });

    // CSV import/export for students/teachers
    document.getElementById('importCsv').addEventListener('click', ()=>{ const f = document.getElementById('csvFile').files[0]; if(!f){ alert('Choose CSV file'); return } const r=new FileReader(); r.onload=()=>{ const txt=r.result; // simple CSV parse: name,role,class,phone,email
      const lines = txt.split('\n').map(l=>l.trim()).filter(l=>l); const arr = lines.map(l=>{ const cols = l.split(',').map(c=>c.trim()); return {name:cols[0],role:cols[1]||'student',class:cols[2]||'',phone:cols[3]||'',email:cols[4]||''} }); // merge into store
      STORE.students = STORE.students.concat(arr.filter(x=>x.role==='student')); STORE.teachers = STORE.teachers.concat(arr.filter(x=>x.role==='teacher')); saveStore(STORE); alert('CSV imported (local).'); renderAll(); }; r.readAsText(f); });
    document.getElementById('exportCsv').addEventListener('click', ()=>{ const rows = [];
      STORE.students.forEach(s=> rows.push([s.name,'student',s.class||'',s.phone||'',s.email||''].join(',')));
      STORE.teachers.forEach(t=> rows.push([t.name,'teacher','',t.phone||'',t.email||''].join(',')));
      const blob=new Blob([rows.join('\n')],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='mkps-users.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });

    // clear local
    document.getElementById('clearLocalBtn').addEventListener('click', ()=>{ if(confirm('Clear ALL local admin data? This cannot be undone.')){ localStorage.removeItem(STORAGE_KEY); STORE = JSON.parse(JSON.stringify(DEFAULT)); saveStore(STORE); renderAll(); alert('Cleared'); } });

    // small helpers
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }
    function $$(s){ return Array.from(document.querySelectorAll(s)) }

    // init: show login
    (function(){ /* keep adminCard visible */ })();
  </script></body>
</html>
