<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Milli Karwaan Public School Balrampur</title>
  <style>
    /* === GLOBAL STYLES === */
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --accent: #e74c3c;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --success: #27ae60;
      --warning: #f39c12;
      --gray: #95a5a6;
      --border: #bdc3c7;
      --shadow: 0 4px 12px rgba(0,0,0,0.1);
      --radius: 8px;
      --transition: all 0.3s ease;
      --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      margin: 0;
      font-family: var(--font-main);
      background: var(--light);
      color: var(--dark);
      line-height: 1.6;
      overflow-x: hidden;
    }

    * {
      box-sizing: border-box;
    }

    img {
      max-width: 100%;
      height: auto;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    /* === HEADER === */
    header {
      background: white;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: 0.75rem 0;
    }

    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      height: 60px;
    }

    .school-info {
      flex: 1;
      margin-left: 1rem;
    }

    .school-name {
      font-size: 1.4rem;
      font-weight: bold;
      color: var(--primary);
      margin: 0;
    }

    .school-address {
      font-size: 0.85rem;
      color: var(--gray);
      margin: 0.25rem 0;
    }

    .contact-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-call {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .btn-call:hover {
      background: #2980b9;
    }

    /* === NAVIGATION === */
    nav {
      background: var(--primary);
      color: white;
      padding: 0.75rem 0;
    }

    .nav-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-links {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
      gap: 1rem;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
      font-size: 0.95rem;
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius);
      transition: var(--transition);
    }

    .nav-links a:hover {
      background: rgba(255,255,255,0.1);
    }

    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }

    /* === HERO === */
    .hero {
      background: linear-gradient(135deg, var(--secondary), var(--primary));
      color: white;
      text-align: center;
      padding: 3rem 1rem;
      margin-bottom: 2rem;
    }

    .hero h1 {
      font-size: 2.5rem;
      margin: 0 0 1rem;
    }

    .hero p {
      font-size: 1.1rem;
      max-width: 700px;
      margin: 0 auto;
    }

    /* === STUDENT FORM === */
    .student-form-container {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2rem;
      max-width: 600px;
      margin: 2rem auto;
      text-align: center;
    }

    .form-title {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      color: var(--primary);
    }

    .form-group {
      margin-bottom: 1rem;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    input, select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 1rem;
    }

    .btn {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 1rem;
      transition: var(--transition);
    }

    .btn:hover {
      background: #2980b9;
    }

    .btn-danger {
      background: var(--accent);
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    .locked-notice {
      background: #d5f5e3;
      color: #27ae60;
      padding: 1rem;
      border-radius: var(--radius);
      margin: 1rem 0;
      text-align: center;
    }

    /* === SECTIONS === */
    section {
      margin: 2rem 0;
    }

    .section-title {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border);
    }

    /* === HOMEWORK === */
    .homework-filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .homework-filters input, .homework-filters select {
      flex: 1;
      min-width: 150px;
    }

    .homework-list {
      display: grid;
      gap: 1rem;
    }

    .homework-card {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.25rem;
      border-left: 4px solid var(--secondary);
    }

    .homework-card.high {
      border-left-color: var(--accent);
    }

    .homework-card.medium {
      border-left-color: var(--warning);
    }

    .homework-card.low {
      border-left-color: var(--success);
    }

    .homework-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .homework-subject {
      font-weight: bold;
      color: var(--primary);
    }

    .homework-date {
      color: var(--gray);
      font-size: 0.9rem;
    }

    .homework-desc {
      margin: 0.75rem 0;
    }

    .homework-attach {
      font-size: 0.85rem;
      color: var(--secondary);
    }

    .homework-done {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    /* === TEACHERS === */
    .teachers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1.5rem;
    }

    .teacher-card {
      background: white;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      text-align: center;
    }

    .teacher-img {
      height: 120px;
      background: #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .teacher-info {
      padding: 1rem;
    }

    .teacher-name {
      font-weight: bold;
      margin: 0 0 0.25rem;
    }

    .teacher-subject {
      color: var(--gray);
      font-size: 0.9rem;
    }

    /* === EVENTS === */
    .events-timeline {
      position: relative;
      padding: 2rem 0;
    }

    .events-timeline::before {
      content: '';
      position: absolute;
      left: 20px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--border);
    }

    .event-item {
      position: relative;
      padding: 1rem 1rem 1rem 4rem;
      margin-bottom: 1rem;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .event-item::before {
      content: '';
      position: absolute;
      left: 12px;
      top: 24px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--secondary);
    }

    .event-date {
      font-size: 0.85rem;
      color: var(--gray);
      margin-bottom: 0.25rem;
    }

    .event-title {
      font-weight: bold;
      margin: 0 0 0.25rem;
    }

    /* === NOTICES === */
    .notice-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .notice-item {
      background: white;
      padding: 1rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .notice-content {
      flex: 1;
    }

    .notice-priority {
      background: var(--accent);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      margin-right: 0.5rem;
    }

    .notice-priority.medium {
      background: var(--warning);
    }

    .notice-priority.low {
      background: var(--success);
    }

    .notice-date {
      font-size: 0.85rem;
      color: var(--gray);
    }

    /* === TIMETABLE === */
    .timetable {
      overflow-x: auto;
    }

    .timetable table {
      width: 100%;
      border-collapse: collapse;
    }

    .timetable th, .timetable td {
      border: 1px solid var(--border);
      padding: 0.75rem;
      text-align: center;
    }

    .timetable th {
      background: var(--primary);
      color: white;
    }

    /* === GALLERY === */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
    }

    .gallery-item {
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      cursor: pointer;
      position: relative;
      height: 150px;
      background: #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* === LIGHTBOX === */
    .lightbox {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .lightbox.active {
      display: flex;
    }

    .lightbox-content {
      max-width: 90%;
      max-height: 80vh;
    }

    .lightbox-controls {
      color: white;
      margin-top: 1rem;
      display: flex;
      gap: 2rem;
    }

    .lightbox-close, .lightbox-nav {
      background: none;
      border: none;
      color: white;
      font-size: 2rem;
      cursor: pointer;
    }

    /* === SIDEBAR === */
    .main-layout {
      display: flex;
      gap: 2rem;
      margin: 2rem 0;
    }

    .content {
      flex: 1;
    }

    .sidebar {
      width: 300px;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
      align-self: start;
    }

    .search-homework {
      margin-bottom: 1.5rem;
    }

    .analytics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .analytic-item {
      background: #f8f9fa;
      padding: 0.75rem;
      border-radius: var(--radius);
      text-align: center;
    }

    .analytic-label {
      font-size: 0.85rem;
      color: var(--gray);
    }

    .analytic-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
    }

    /* === FAQ === */
    .faq-item {
      margin-bottom: 1rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .faq-question {
      background: white;
      padding: 1rem;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .faq-answer {
      background: #f8f9fa;
      padding: 1rem;
      display: none;
    }

    .faq-answer.active {
      display: block;
    }

    /* === CONTACT === */
    .contact-form {
      background: white;
      padding: 2rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .contact-form .form-group {
      margin-bottom: 1rem;
    }

    textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 1rem;
      min-height: 100px;
      resize: vertical;
    }

    /* === FOOTER === */
    footer {
      background: var(--primary);
      color: white;
      padding: 2rem 0;
      margin-top: 3rem;
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
    }

    .footer-section h3 {
      margin: 0 0 1rem;
      font-size: 1.1rem;
    }

    .footer-links {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .footer-links li {
      margin-bottom: 0.5rem;
    }

    .footer-links a {
      color: #bdc3c7;
      text-decoration: none;
    }

    .footer-links a:hover {
      color: white;
    }

    .copyright {
      text-align: center;
      margin-top: 2rem;
      color: #bdc3c7;
      font-size: 0.9rem;
    }

    /* === RESPONSIVE === */
    @media (max-width: 768px) {
      .nav-links {
        display: none;
        flex-direction: column;
        background: var(--primary);
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        padding: 1rem;
      }

      .nav-links.active {
        display: flex;
      }

      .menu-toggle {
        display: block;
      }

      .main-layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
      }

      .hero h1 {
        font-size: 2rem;
      }
    }

    /* === ANIMATIONS === */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container header-inner">
      <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo" class="logo" />
      <div class="school-info">
        <h1 class="school-name">Milli Karwaan Public School Balrampur</h1>
        <p class="school-address">Boluha Police Chowki Balrampur</p>
      </div>
      <div class="contact-actions">
        <a href="tel:9758919151" class="btn-call">
          <span>Call Us</span>
        </a>
        <a href="mailto:madamsir066@gmail.com" class="btn-call" style="background:#95a5a6;">
          <span>Email</span>
        </a>
      </div>
    </div>
  </header>

  <!-- NAVIGATION -->
  <nav>
    <div class="container nav-inner">
      <button class="menu-toggle">☰</button>
      <ul class="nav-links">
        <li><a href="#hero">Home</a></li>
        <li><a href="#homework">Homework</a></li>
        <li><a href="#teachers">Teachers</a></li>
        <li><a href="#events">Events</a></li>
        <li><a href="#notices">Notices</a></li>
        <li><a href="#timetable">Timetable</a></li>
        <li><a href="#gallery">Gallery</a></li>
        <li><a href="#faq">FAQ</a></li>
        <li><a href="#contact">Contact</a></li>
        <li><a href="admin.html" target="_blank">Admin Login</a></li>
        <li><a href="#" id="export-data">Export Data</a></li>
        <li><a href="#" id="download-snapshot">Download Snapshot</a></li>
        <li><a href="#" id="import-data">Import Data</a></li>
      </ul>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero" id="hero">
    <div class="container">
      <h1>Welcome to Milli Karwaan Public School</h1>
      <p>Dedicated to excellence in education and holistic development of every student.</p>
    </div>
  </section>

  <!-- STUDENT ACCESS FORM -->
  <div id="student-form-section" class="container">
    <div class="student-form-container">
      <h2 class="form-title">Student Access</h2>
      <p>Please enter your details to access your personalized content.</p>
      <form id="student-form">
        <div class="form-group">
          <label for="student-name">Student Name</label>
          <input type="text" id="student-name" required />
        </div>
        <div class="form-group">
          <label for="student-class">Class</label>
          <select id="student-class" required>
            <option value="">Select Class</option>
            <option value="1">Class 1</option>
            <option value="2">Class 2</option>
            <option value="3">Class 3</option>
            <option value="4">Class 4</option>
            <option value="5">Class 5</option>
            <option value="6">Class 6</option>
            <option value="7">Class 7</option>
            <option value="8">Class 8</option>
            <option value="9">Class 9</option>
            <option value="10">Class 10</option>
            <option value="11">Class 11</option>
            <option value="12">Class 12</option>
          </select>
        </div>
        <div class="form-group">
          <label for="parent-name">Parent's Name</label>
          <input type="text" id="parent-name" required />
        </div>
        <button type="submit" class="btn">Access Dashboard</button>
      </form>
      <div id="locked-notice" class="locked-notice" style="display:none;">
        <p>Access granted! Welcome back. Your information is locked for security.</p>
        <p id="student-info"></p>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT (HIDDEN UNTIL FORM SUBMITTED) -->
  <main id="main-content" style="display:none;" class="fade-in">
    <div class="container">
      <div class="main-layout">
        <div class="content">
          <!-- HOMEWORK SECTION -->
          <section id="homework">
            <h2 class="section-title">Homework</h2>
            <div class="homework-filters">
              <input type="text" id="search-homework" placeholder="Search homework..." />
              <select id="filter-priority">
                <option value="">All Priorities</option>
                <option value="high">High Priority</option>
                <option value="medium">Medium Priority</option>
                <option value="low">Low Priority</option>
              </select>
              <select id="sort-homework">
                <option value="newest">Newest First</option>
                <option value="oldest">Oldest First</option>
              </select>
            </div>
            <div id="homework-list" class="homework-list"></div>
          </section>

          <!-- TEACHERS SECTION -->
          <section id="teachers">
            <h2 class="section-title">Our Teachers</h2>
            <div id="teachers-list" class="teachers-grid"></div>
          </section>

          <!-- EVENTS SECTION -->
          <section id="events">
            <h2 class="section-title">Upcoming Events</h2>
            <div id="events-list" class="events-timeline"></div>
          </section>

          <!-- NOTICES SECTION -->
          <section id="notices">
            <h2 class="section-title">Notices</h2>
            <div id="notices-list" class="notice-list"></div>
          </section>

          <!-- TIMETABLE SECTION -->
          <section id="timetable">
            <h2 class="section-title">Sample Timetable</h2>
            <div class="timetable">
              <table>
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Monday</th>
                    <th>Tuesday</th>
                    <th>Wednesday</th>
                    <th>Thursday</th>
                    <th>Friday</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>9:00-10:00</td>
                    <td>Math</td>
                    <td>Science</td>
                    <td>English</td>
                    <td>Math</td>
                    <td>Science</td>
                  </tr>
                  <tr>
                    <td>10:00-11:00</td>
                    <td>English</td>
                    <td>Math</td>
                    <td>Science</td>
                    <td>English</td>
                    <td>Math</td>
                  </tr>
                  <tr>
                    <td>11:00-12:00</td>
                    <td>Science</td>
                    <td>English</td>
                    <td>Math</td>
                    <td>Science</td>
                    <td>English</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- GALLERY SECTION -->
          <section id="gallery">
            <h2 class="section-title">School Gallery</h2>
            <div id="gallery-list" class="gallery-grid"></div>
          </section>

          <!-- FAQ SECTION -->
          <section id="faq">
            <h2 class="section-title">Frequently Asked Questions</h2>
            <div class="faq-item">
              <div class="faq-question">
                What are the school hours?
                <span>+</span>
              </div>
              <div class="faq-answer">
                School operates from 8:00 AM to 2:00 PM, Monday through Friday.
              </div>
            </div>
            <div class="faq-item">
              <div class="faq-question">
                How can I contact my child's teacher?
                <span>+</span>
              </div>
              <div class="faq-answer">
                You can email teachers directly or use the contact form on this website. Teachers typically respond within 24-48 hours.
              </div>
            </div>
            <div class="faq-item">
              <div class="faq-question">
                What should I do if my child is absent?
                <span>+</span>
              </div>
              <div class="faq-answer">
                Please call the school office at 9758919151 to report your child's absence and provide a reason.
              </div>
            </div>
          </section>

          <!-- CONTACT SECTION -->
          <section id="contact">
            <h2 class="section-title">Contact Us</h2>
            <form class="contact-form" id="contact-form">
              <div class="form-group">
                <label for="contact-name">Your Name</label>
                <input type="text" id="contact-name" required />
              </div>
              <div class="form-group">
                <label for="contact-email">Your Email</label>
                <input type="email" id="contact-email" required />
              </div>
              <div class="form-group">
                <label for="contact-message">Message</label>
                <textarea id="contact-message" required></textarea>
              </div>
              <button type="submit" class="btn">Send Message</button>
            </form>
          </section>
        </div>

        <!-- SIDEBAR -->
        <div class="sidebar">
          <div class="search-homework">
            <h3>Quick Search</h3>
            <input type="text" id="quick-search" placeholder="Find homework..." />
          </div>
          <div class="analytics">
            <div class="analytic-item">
              <div class="analytic-label">Homework</div>
              <div class="analytic-value" id="homework-count">0</div>
            </div>
            <div class="analytic-item">
              <div class="analytic-label">Teachers</div>
              <div class="analytic-value" id="teachers-count">0</div>
            </div>
            <div class="analytic-item">
              <div class="analytic-label">Unread Messages</div>
              <div class="analytic-value" id="messages-count">0</div>
            </div>
            <div class="analytic-item">
              <div class="analytic-label">Events</div>
              <div class="analytic-value" id="events-count">0</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- LIGHTBOX FOR GALLERY -->
  <div class="lightbox" id="lightbox">
    <img src="" alt="Gallery Image" class="lightbox-content" id="lightbox-img" />
    <div class="lightbox-controls">
      <button class="lightbox-nav" id="lightbox-prev">←</button>
      <button class="lightbox-close" id="lightbox-close">✕</button>
      <button class="lightbox-nav" id="lightbox-next">→</button>
    </div>
  </div>

  <!-- IMPORT DATA FILE INPUT (HIDDEN) -->
  <input type="file" id="import-file" style="display:none;" accept=".json" />

  <script>
    // === GLOBAL VARIABLES ===
    let studentData = null;
    let homeworkList = [];
    let teachersList = [];
    let eventsList = [];
    let noticesList = [];
    let galleryList = [];
    let messagesList = [];

    // === STORAGE KEYS ===
    const STORAGE_KEYS = {
      STUDENT: 'mkps_student',
      HOMEWORK: 'mkps_homework',
      TEACHERS: 'mkps_teachers',
      EVENTS: 'mkps_events',
      NOTICES: 'mkps_notices',
      TIMETABLE: 'mkps_timetable',
      GALLERY: 'mkps_gallery',
      MESSAGES: 'mkps_messages',
      UPDATE: 'mkps_update'
    };

    // === SEED DATA FUNCTION ===
    function seedInitialData() {
      console.log('Seeding initial data...');
      
      // Only seed if no data exists
      if (!localStorage.getItem(STORAGE_KEYS.HOMEWORK)) {
        const sampleHomework = [
          { id: 1, subject: 'Mathematics', class: 9, date: '2023-10-15', description: 'Complete exercises 5.1 to 5.3 on quadratic equations', priority: 'high', done: false, attachment: false },
          { id: 2, subject: 'Science', class: 9, date: '2023-10-16', description: 'Prepare a project on the human digestive system', priority: 'medium', done: false, attachment: true },
          { id: 3, subject: 'English', class: 10, date: '2023-10-14', description: 'Write an essay on "The Importance of Education"', priority: 'high', done: false, attachment: false },
          { id: 4, subject: 'Social Studies', class: 8, date: '2023-10-17', description: 'Read chapter 7 and answer questions 1-5', priority: 'low', done: false, attachment: false },
          { id: 5, subject: 'Physics', class: 11, date: '2023-10-18', description: 'Solve numerical problems on Newton\'s laws of motion', priority: 'high', done: false, attachment: true },
          { id: 6, subject: 'Chemistry', class: 12, date: '2023-10-19', description: 'Prepare a lab report on acid-base titration', priority: 'medium', done: false, attachment: true }
        ];
        localStorage.setItem(STORAGE_KEYS.HOMEWORK, JSON.stringify(sampleHomework));
      }

      if (!localStorage.getItem(STORAGE_KEYS.TEACHERS)) {
        const sampleTeachers = [
          { id: 1, name: 'Dr. A. Sharma', subject: 'Mathematics', class: '9-12', phone: '9876543210', email: 'sharma@mkps.edu' },
          { id: 2, name: 'Mrs. P. Verma', subject: 'Science', class: '6-8', phone: '9876543211', email: 'verma@mkps.edu' },
          { id: 3, name: 'Mr. R. Khan', subject: 'English', class: '9-12', phone: '9876543212', email: 'khan@mkps.edu' },
          { id: 4, name: 'Ms. S. Patel', subject: 'Social Studies', class: '6-10', phone: '9876543213', email: 'patel@mkps.edu' },
          { id: 5, name: 'Dr. M. Singh', subject: 'Physics', class: '11-12', phone: '9876543214', email: 'singh@mkps.edu' }
        ];
        localStorage.setItem(STORAGE_KEYS.TEACHERS, JSON.stringify(sampleTeachers));
      }

      if (!localStorage.getItem(STORAGE_KEYS.EVENTS)) {
        const sampleEvents = [
          { id: 1, title: 'Annual Day Celebration', date: '2023-11-15', time: '10:00 AM', venue: 'School Ground', description: 'Cultural programs and award distribution' },
          { id: 2, title: 'Parent-Teacher Meeting', date: '2023-10-20', time: '2:00 PM', venue: 'School Hall', description: 'Discussion about student progress' },
          { id: 3, title: 'Science Exhibition', date: '2023-11-05', time: '9:00 AM', venue: 'Science Lab', description: 'Student projects on scientific innovations' }
        ];
        localStorage.setItem(STORAGE_KEYS.EVENTS, JSON.stringify(sampleEvents));
      }

      if (!localStorage.getItem(STORAGE_KEYS.NOTICES)) {
        const sampleNotices = [
          { id: 1, title: 'School will remain closed on October 2nd for Gandhi Jayanti', date: '2023-09-25', priority: 'high' },
          { id: 2, title: 'New library books have arrived', date: '2023-10-10', priority: 'medium' },
          { id: 3, title: 'Sports day practice starts next week', date: '2023-10-12', priority: 'low' }
        ];
        localStorage.setItem(STORAGE_KEYS.NOTICES, JSON.stringify(sampleNotices));
      }

      if (!localStorage.getItem(STORAGE_KEYS.GALLERY)) {
        const sampleGallery = [
          { id: 1, url: 'https://placehold.co/600x400?text=School+Event+1', caption: 'Annual Sports Day 2023' },
          { id: 2, url: 'https://placehold.co/600x400?text=Science+Fair', caption: 'Science Exhibition' },
          { id: 3, url: 'https://placehold.co/600x400?text=Class+Photo', caption: 'Class 10 Graduation' },
          { id: 4, url: 'https://placehold.co/600x400?text=Teacher+Training', caption: 'Teacher Workshop' }
        ];
        localStorage.setItem(STORAGE_KEYS.GALLERY, JSON.stringify(sampleGallery));
      }

      if (!localStorage.getItem(STORAGE_KEYS.MESSAGES)) {
        const sampleMessages = [
          { id: 1, name: 'Rahul Kumar', email: 'rahul@email.com', message: 'Inquiry about admission process', read: false, timestamp: Date.now() - 86400000 },
          { id: 2, name: 'Sunita Devi', email: 'sunita@email.com', message: 'Thank you for the excellent teaching', read: true, timestamp: Date.now() - 172800000 }
        ];
        localStorage.setItem(STORAGE_KEYS.MESSAGES, JSON.stringify(sampleMessages));
      }

      // Timetable is static in HTML, no need to store
    }

    // === DATA LOADERS ===
    function loadStudentData() {
      const stored = localStorage.getItem(STORAGE_KEYS.STUDENT);
      if (stored) {
        try {
          studentData = JSON.parse(stored);
          return true;
        } catch (e) {
          console.error('Error parsing student data:', e);
          return false;
        }
      }
      return false;
    }

    function loadData() {
      try {
        const hw = localStorage.getItem(STORAGE_KEYS.HOMEWORK);
        homeworkList = hw ? JSON.parse(hw) : [];

        const teachers = localStorage.getItem(STORAGE_KEYS.TEACHERS);
        teachersList = teachers ? JSON.parse(teachers) : [];

        const events = localStorage.getItem(STORAGE_KEYS.EVENTS);
        eventsList = events ? JSON.parse(events) : [];

        const notices = localStorage.getItem(STORAGE_KEYS.NOTICES);
        noticesList = notices ? JSON.parse(notices) : [];

        const gallery = localStorage.getItem(STORAGE_KEYS.GALLERY);
        galleryList = gallery ? JSON.parse(gallery) : [];

        const messages = localStorage.getItem(STORAGE_KEYS.MESSAGES);
        messagesList = messages ? JSON.parse(messages) : [];

      } catch (e) {
        console.error('Error loading data:', e);
        alert('Error loading data. Some features may not work correctly.');
      }
    }

    // === RENDERERS ===
    function renderHomeworkFor(classNo) {
      const container = document.getElementById('homework-list');
      if (!container) return;

      // Filter homework for the student's class
      let filtered = homeworkList.filter(hw => parseInt(hw.class) === parseInt(classNo));

      // Apply search filter
      const search = document.getElementById('search-homework').value.toLowerCase();
      if (search) {
        filtered = filtered.filter(hw => 
          hw.subject.toLowerCase().includes(search) || 
          hw.description.toLowerCase().includes(search)
        );
      }

      // Apply priority filter
      const priority = document.getElementById('filter-priority').value;
      if (priority) {
        filtered = filtered.filter(hw => hw.priority === priority);
      }

      // Sort
      const sort = document.getElementById('sort-homework').value;
      filtered.sort((a, b) => {
        if (sort === 'newest') {
          return new Date(b.date) - new Date(a.date);
        } else {
          return new Date(a.date) - new Date(b.date);
        }
      });

      if (filtered.length === 0) {
        container.innerHTML = '<p>No homework assigned for your class.</p>';
        return;
      }

      container.innerHTML = filtered.map(hw => `
        <div class="homework-card ${hw.priority}">
          <div class="homework-header">
            <span class="homework-subject">${hw.subject}</span>
            <span class="homework-date">${hw.date}</span>
          </div>
          <div class="homework-desc">${hw.description}</div>
          ${hw.attachment ? '<div class="homework-attach">📎 Attached material available</div>' : ''}
          <div class="homework-done">
            <input type="checkbox" id="hw-${hw.id}" ${hw.done ? 'checked' : ''} data-id="${hw.id}">
            <label for="hw-${hw.id}">Mark as completed</label>
          </div>
        </div>
      `).join('');

      // Add event listeners to checkboxes
      container.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', function() {
          const hwId = parseInt(this.dataset.id);
          const hw = homeworkList.find(h => h.id === hwId);
          if (hw) {
            hw.done = this.checked;
            localStorage.setItem(STORAGE_KEYS.HOMEWORK, JSON.stringify(homeworkList));
            // Don't trigger mkps_update for student actions
          }
        });
      });
    }

    function refreshTeachers() {
      const container = document.getElementById('teachers-list');
      if (!container) return;

      if (teachersList.length === 0) {
        container.innerHTML = '<p>No teachers listed.</p>';
        return;
      }

      container.innerHTML = teachersList.map(t => `
        <div class="teacher-card">
          <div class="teacher-img">👩‍🏫</div>
          <div class="teacher-info">
            <div class="teacher-name">${t.name}</div>
            <div class="teacher-subject">${t.subject} (${t.class})</div>
            <div style="font-size:0.8rem; margin-top:0.25rem;">${t.phone}</div>
          </div>
        </div>
      `).join('');
    }

    function refreshEvents() {
      const container = document.getElementById('events-list');
      if (!container) return;

      if (eventsList.length === 0) {
        container.innerHTML = '<p>No upcoming events.</p>';
        return;
      }

      container.innerHTML = eventsList.map(e => `
        <div class="event-item">
          <div class="event-date">${e.date} | ${e.time}</div>
          <div class="event-title">${e.title}</div>
          <div class="event-desc">${e.description} - ${e.venue}</div>
        </div>
      `).join('');
    }

    function refreshNotices() {
      const container = document.getElementById('notices-list');
      if (!container) return;

      if (noticesList.length === 0) {
        container.innerHTML = '<p>No notices at this time.</p>';
        return;
      }

      container.innerHTML = noticesList.map(n => `
        <div class="notice-item">
          <div class="notice-content">
            <div class="notice-title">${n.title}</div>
            <div class="notice-date">${n.date}</div>
          </div>
          <span class="notice-priority ${n.priority}">${n.priority.toUpperCase()}</span>
        </div>
      `).join('');
    }

    function refreshGallery() {
      const container = document.getElementById('gallery-list');
      if (!container) return;

      if (galleryList.length === 0) {
        container.innerHTML = '<p>No images in gallery.</p>';
        return;
      }

      container.innerHTML = galleryList.map(g => `
        <div class="gallery-item" data-id="${g.id}">
          <img src="${g.url}" alt="${g.caption}" />
        </div>
      `).join('');

      // Add click listeners for lightbox
      document.querySelectorAll('.gallery-item').forEach(item => {
        item.addEventListener('click', function() {
          const id = parseInt(this.dataset.id);
          const img = galleryList.find(g => g.id === id);
          if (img) {
            const lb = document.getElementById('lightbox');
            const lbImg = document.getElementById('lightbox-img');
            lbImg.src = img.url;
            lbImg.alt = img.caption;
            lb.classList.add('active');
          }
        });
      });
    }

    function updateAnalytics() {
      const studentClass = studentData ? studentData.cls : null;
      const classHwCount = studentClass ? homeworkList.filter(h => h.class == studentClass).length : 0;
      document.getElementById('homework-count').textContent = classHwCount;
      document.getElementById('teachers-count').textContent = teachersList.length;
      
      const unreadCount = messagesList.filter(m => !m.read).length;
      document.getElementById('messages-count').textContent = unreadCount;
      document.getElementById('events-count').textContent = eventsList.length;
    }

    // === EVENT HANDLERS ===
    function setupEventListeners() {
      // Student form submission
      const form = document.getElementById('student-form');
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          const name = document.getElementById('student-name').value.trim();
          const cls = document.getElementById('student-class').value;
          const parent = document.getElementById('parent-name').value.trim();

          if (!name || !cls || !parent) {
            alert('Please fill in all fields.');
            return;
          }

          studentData = {
            name,
            cls,
            parent,
            ts: Date.now()
          };

          localStorage.setItem(STORAGE_KEYS.STUDENT, JSON.stringify(studentData));
          
          // Prevent back button
          history.pushState(null, null, location.href);
          window.addEventListener('popstate', function(e) {
            history.pushState(null, null, location.href);
          });

          showMainContent();
        });
      }

      // Navigation menu toggle
      const menuToggle = document.querySelector('.menu-toggle');
      const navLinks = document.querySelector('.nav-links');
      if (menuToggle && navLinks) {
        menuToggle.addEventListener('click', () => {
          navLinks.classList.toggle('active');
        });
      }

      // Homework filters
      const searchHw = document.getElementById('search-homework');
      const filterPriority = document.getElementById('filter-priority');
      const sortHw = document.getElementById('sort-homework');

      [searchHw, filterPriority, sortHw].forEach(el => {
        el?.addEventListener('input', () => {
          if (studentData) renderHomeworkFor(studentData.cls);
        });
      });

      // FAQ accordions
      document.querySelectorAll('.faq-question').forEach(q => {
        q.addEventListener('click', function() {
          const answer = this.nextElementSibling;
          const isActive = answer.classList.contains('active');
          document.querySelectorAll('.faq-answer').forEach(a => a.classList.remove('active'));
          document.querySelectorAll('.faq-question span').forEach(s => s.textContent = '+');
          
          if (!isActive) {
            answer.classList.add('active');
            this.querySelector('span').textContent = '−';
          }
        });
      });

      // Contact form
      const contactForm = document.getElementById('contact-form');
      if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const name = document.getElementById('contact-name').value.trim();
          const email = document.getElementById('contact-email').value.trim();
          const message = document.getElementById('contact-message').value.trim();

          if (!name || !email || !message) {
            alert('Please fill in all fields.');
            return;
          }

          const newMessage = {
            id: Date.now(),
            name,
            email,
            message,
            read: false,
            timestamp: Date.now()
          };

          messagesList.unshift(newMessage);
          localStorage.setItem(STORAGE_KEYS.MESSAGES, JSON.stringify(messagesList));
          
          // Trigger update for admin
          localStorage.setItem(STORAGE_KEYS.UPDATE, Date.now().toString());

          alert('Message sent successfully!');
          contactForm.reset();
        });
      }

      // Lightbox
      const lb = document.getElementById('lightbox');
      const lbClose = document.getElementById('lightbox-close');
      const lbPrev = document.getElementById('lightbox-prev');
      const lbNext = document.getElementById('lightbox-next');

      lbClose?.addEventListener('click', () => {
        lb.classList.remove('active');
      });

      lb?.addEventListener('click', function(e) {
        if (e.target === this) {
          this.classList.remove('active');
        }
      });

      // Export data
      document.getElementById('export-data').addEventListener('click', function(e) {
        e.preventDefault();
        const data = {
          student: localStorage.getItem(STORAGE_KEYS.STUDENT),
          homework: localStorage.getItem(STORAGE_KEYS.HOMEWORK),
          teachers: localStorage.getItem(STORAGE_KEYS.TEACHERS),
          events: localStorage.getItem(STORAGE_KEYS.EVENTS),
          notices: localStorage.getItem(STORAGE_KEYS.NOTICES),
          gallery: localStorage.getItem(STORAGE_KEYS.GALLERY),
          messages: localStorage.getItem(STORAGE_KEYS.MESSAGES),
          exportedAt: new Date().toISOString()
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `mkps-data-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });

      // Import data
      document.getElementById('import-data').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('import-file').click();
      });

      document.getElementById('import-file').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            
            // Validate and import each key
            Object.keys(STORAGE_KEYS).forEach(key => {
              const storageKey = STORAGE_KEYS[key];
              if (data[key.toLowerCase()] !== undefined) {
                localStorage.setItem(storageKey, data[key.toLowerCase()]);
              }
            });

            alert('Data imported successfully! Page will reload.');
            location.reload();

          } catch (err) {
            alert('Error importing data: Invalid JSON file.');
            console.error(err);
          }
        };
        reader.readAsText(file);
      });

      // Download snapshot
      document.getElementById('download-snapshot').addEventListener('click', function(e) {
        e.preventDefault();
        
        const html = `
<!DOCTYPE html>
<html>
<head>
  <title>Milli Karwaan Public School - Data Snapshot</title>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 1200px; margin: 0 auto; padding: 20px }
    h1, h2 { color: #2c3e50 }
    .section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px }
    .homework-item, .teacher-item, .event-item, .notice-item { margin: 10px 0; padding: 10px; background: #f9f9f9 }
    .timestamp { color: #666; font-size: 0.9em }
  </style>
</head>
<body>
  <h1>Milli Karwaan Public School - Data Snapshot</h1>
  <p class="timestamp">Generated on: ${new Date().toLocaleString()}</p>

  <div class="section">
    <h2>Student Information</h2>
    ${studentData ? 
      `<p><strong>Name:</strong> ${studentData.name}</p>
       <p><strong>Class:</strong> ${studentData.cls}</p>
       <p><strong>Parent:</strong> ${studentData.parent}</p>
       <p><strong>Access Date:</strong> ${new Date(studentData.ts).toLocaleString()}</p>` :
      '<p>No student data available.</p>'
    }
  </div>

  <div class="section">
    <h2>Homework (Class ${studentData?.cls || 'N/A'})</h2>
    ${homeworkList.filter(h => !studentData || h.class == studentData.cls).map(hw => 
      `<div class="homework-item">
        <strong>${hw.subject}</strong> (${hw.date}) [${hw.priority}]
        <p>${hw.description}</p>
        <em>Done: ${hw.done ? 'Yes' : 'No'}</em>
      </div>`
    ).join('')}
  </div>

  <div class="section">
    <h2>Teachers</h2>
    ${teachersList.map(t => 
      `<div class="teacher-item">
        <strong>${t.name}</strong> - ${t.subject} (${t.class})
        <br>Phone: ${t.phone} | Email: ${t.email}
      </div>`
    ).join('')}
  </div>

  <div class="section">
    <h2>Events</h2>
    ${eventsList.map(e => 
      `<div class="event-item">
        <strong>${e.title}</strong> - ${e.date} at ${e.time}
        <p>Venue: ${e.venue}</p>
        <p>${e.description}</p>
      </div>`
    ).join('')}
  </div>

  <div class="section">
    <h2>Notices</h2>
    ${noticesList.map(n => 
      `<div class="notice-item">
        <strong>[${n.priority.toUpperCase()}]</strong> ${n.title}
        <br><small>${n.date}</small>
      </div>`
    ).join('')}
  </div>

  <div class="section">
    <h2>Unread Messages</h2>
    ${messagesList.filter(m => !m.read).map(msg => 
      `<div class="message-item">
        <strong>${msg.name}</strong> &lt;${msg.email}&gt;
        <p>${msg.message}</p>
        <small>${new Date(msg.timestamp).toLocaleString()}</small>
      </div>`
    ).join('')}
  </div>
</body>
</html>`;

        const blob = new Blob([html], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `mkps-snapshot-${new Date().toISOString().split('T')[0]}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });
    }

    // === STORAGE EVENT HANDLER ===
    window.addEventListener('storage', function(e) {
      if (e.key === STORAGE_KEYS.UPDATE) {
        console.log('Update received, reloading data...');
        loadData();
        if (studentData) {
          renderHomeworkFor(studentData.cls);
        }
        refreshTeachers();
        refreshEvents();
        refreshNotices();
        refreshGallery();
        updateAnalytics();
      }
    });

    // === INITIALIZATION ===
    function init() {
      // Seed data if needed
      seedInitialData();

      // Load student data
      const hasStudent = loadStudentData();

      if (hasStudent) {
        // Prevent back button
        history.pushState(null, null, location.href);
        window.addEventListener('popstate', function(e) {
          history.pushState(null, null, location.href);
        });
        showMainContent();
      } else {
        // Show form
        document.getElementById('student-form-section').style.display = 'block';
        document.getElementById('main-content').style.display = 'none';
      }

      // Load all data
      loadData();

      // Setup event listeners
      setupEventListeners();

      // Setup lightbox navigation
      setupLightboxNavigation();
    }

    function showMainContent() {
      document.getElementById('student-form-section').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      
      // Show locked notice
      const lockedNotice = document.getElementById('locked-notice');
      if (lockedNotice) {
        lockedNotice.style.display = 'block';
        document.getElementById('student-info').textContent = 
          `Welcome, ${studentData.name} (Class ${studentData.cls})`;
      }

      // Render content
      if (studentData) {
        renderHomeworkFor(studentData.cls);
      }
      refreshTeachers();
      refreshEvents();
      refreshNotices();
      refreshGallery();
      updateAnalytics();
    }

    function setupLightboxNavigation() {
      const lb = document.getElementById('lightbox');
      const lbImg = document.getElementById('lightbox-img');
      const prevBtn = document.getElementById('lightbox-prev');
      const nextBtn = document.getElementById('lightbox-next');

      let currentIndex = 0;

      prevBtn.addEventListener('click', function() {
        if (currentIndex > 0) {
          currentIndex--;
          updateLightboxImage();
        }
      });

      nextBtn.addEventListener('click', function() {
        if (currentIndex < galleryList.length - 1) {
          currentIndex++;
          updateLightboxImage();
        }
      });

      function updateLightboxImage() {
        if (galleryList.length === 0) return;
        const img = galleryList[currentIndex];
        lbImg.src = img.url;
        lbImg.alt = img.caption;
      }

      lb.addEventListener('shown.bs.modal', function() {
        currentIndex = galleryList.findIndex(g => g.url === lbImg.src);
        if (currentIndex === -1) currentIndex = 0;
      });
    }

    // Make functions globally available
    window.renderHomeworkFor = renderHomeworkFor;
    window.refreshTeachers = refreshTeachers;
    window.refreshEvents = refreshEvents;
    window.reloadAll = function() {
      loadData();
      if (studentData) renderHomeworkFor(studentData.cls);
      refreshTeachers();
      refreshEvents();
      refreshNotices();
      refreshGallery();
      updateAnalytics();
    };

    // Initialize on load
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
```

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel - Milli Karwaan Public School</title>
  <style>
    /* === GLOBAL STYLES === */
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --accent: #e74c3c;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --success: #27ae60;
      --warning: #f39c12;
      --gray: #95a5a6;
      --border: #bdc3c7;
      --shadow: 0 4px 12px rgba(0,0,0,0.1);
      --radius: 8px;
      --transition: all 0.3s ease;
      --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      margin: 0;
      font-family: var(--font-main);
      background: #f5f6fa;
      color: var(--dark);
      line-height: 1.6;
    }

    * {
      box-sizing: border-box;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    /* === LOGIN SCREEN === */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
    }

    .login-box {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2.5rem;
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

    .login-logo {
      height: 80px;
      margin-bottom: 1.5rem;
    }

    .login-title {
      font-size: 1.8rem;
      color: var(--primary);
      margin: 0 0 1rem;
    }

    .login-warning {
      background: #fff3cd;
      color: #856404;
      padding: 0.75rem;
      border-radius: var(--radius);
      margin: 1rem 0;
      font-size: 0.9rem;
    }

    .form-group {
      margin-bottom: 1.25rem;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 1rem;
    }

    .btn {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 1rem;
      transition: var(--transition);
      display: inline-block;
    }

    .btn:hover {
      background: #2980b9;
    }

    .btn-danger {
      background: var(--accent);
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    .btn-success {
      background: var(--success);
    }

    .btn-success:hover {
      background: #219653;
    }

    .btn-warning {
      background: var(--warning);
    }

    .btn-warning:hover {
      background: #e67e22;
    }

    /* === ADMIN PANEL === */
    .admin-panel {
      display: none;
      padding: 2rem 0;
    }

    /* === HEADER === */
    header {
      background: white;
      box-shadow: var(--shadow);
      padding: 1rem 0;
    }

    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      height: 50px;
    }

    .admin-title {
      font-size: 1.4rem;
      color: var(--primary);
      margin: 0;
    }

    .logout-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      cursor: pointer;
    }

    /* === SIDEBAR === */
    .admin-layout {
      display: flex;
      gap: 2rem;
      margin-top: 2rem;
    }

    .sidebar {
      width: 250px;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.5rem 0;
    }

    .nav-menu {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .nav-item {
      margin: 0.25rem 0;
    }

    .nav-link {
      display: block;
      padding: 0.75rem 1.5rem;
      color: var(--dark);
      text-decoration: none;
      border-left: 3px solid transparent;
    }

    .nav-link:hover, .nav-link.active {
      background: #f8f9fa;
      border-left-color: var(--secondary);
      color: var(--secondary);
    }

    /* === MAIN CONTENT === */
    .main-content {
      flex: 1;
    }

    .card {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .card-title {
      font-size: 1.3rem;
      color: var(--primary);
      margin: 0 0 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }

    /* === TABLES === */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid var(--border);
      padding: 0.75rem;
      text-align: left;
    }

    th {
      background: #f8f9fa;
      font-weight: 500;
    }

    tr:nth-child(even) {
      background: #f8f9fa;
    }

    /* === FORMS === */
    .form-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .form-col {
      flex: 1;
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .btn-sm {
      padding: 0.5rem 0.75rem;
      font-size: 0.9rem;
    }

    /* === MODAL === */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 1.25rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      margin: 0;
      color: var(--primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      padding: 1.25rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
    }

    /* === BADGES === */
    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .badge-success {
      background: #d4edda;
      color: #155724;
    }

    .badge-warning {
      background: #fff3cd;
      color: #856404;
    }

    .badge-danger {
      background: #f8d7da;
      color: #721c24;
    }

    /* === ACTIVITY LOG === */
    .activity-log {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem;
      font-size: 0.9rem;
      background: #f8f9fa;
    }

    .activity-item {
      padding: 0.5rem 0;
      border-bottom: 1px solid #e9ecef;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-time {
      color: var(--gray);
      font-size: 0.8rem;
    }

    /* === IMPORT/EXPORT === */
    .import-export {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .file-input {
      display: none;
    }

    /* === RESPONSIVE === */
    @media (max-width: 768px) {
      .admin-layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
      }

      .form-row {
        flex-direction: column;
      }

      .modal-content {
        width: 95%;
      }
    }
  </style>
</head>
<body>
  <!-- LOGIN SCREEN -->
  <div class="login-container" id="login-screen">
    <div class="login-box">
      <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo" class="login-logo" />
      <h2 class="login-title">Admin Login</h2>
      <p style="color: #666;">Enter your credentials to access the admin panel.</p>
      
      <div class="login-warning">
        <strong>Security Notice:</strong> This is a client-side demo. In a real application, authentication would be handled securely on the server.
      </div>
      
      <form id="login-form">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" placeholder="Optional" />
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" required />
        </div>
        <button type="submit" class="btn">Login</button>
      </form>
    </div>
  </div>

  <!-- ADMIN PANEL -->
  <div class="admin-panel" id="admin-panel">
    <!-- HEADER -->
    <header>
      <div class="container header-inner">
        <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo" class="logo" />
        <h1 class="admin-title">Admin Panel - Milli Karwaan Public School</h1>
        <button class="logout-btn" id="logout-btn">Logout</button>
      </div>
    </header>

    <div class="container">
      <div class="admin-layout">
        <!-- SIDEBAR -->
        <div class="sidebar">
          <ul class="nav-menu">
            <li class="nav-item">
              <a href="#" class="nav-link active" data-tab="dashboard">Dashboard</a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-tab="homework">Homework</a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-tab="teachers">Teachers</a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-tab="events">Events</a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-tab="notices">Notices</a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-tab="timetable">Timetable</a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-tab="gallery">Gallery</a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-tab="messages">Messages</a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-tab="data">Data Management</a>
            </li>
          </ul>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
          <!-- DASHBOARD -->
          <div id="dashboard" class="tab-content">
            <div class="card">
              <h3 class="card-title">Dashboard</h3>
              <p>Welcome to the Milli Karwaan Public School administration panel. Use the navigation to manage school data.</p>
              
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
                <div style="background: #f8f9fa; padding: 1rem; border-radius: var(--radius); text-align: center;">
                  <div style="font-size: 1.8rem; font-weight: bold; color: var(--secondary);">${/* JS will fill */}</div>
                  <div style="color: var(--gray);">Homework Items</div>
                </div>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: var(--radius); text-align: center;">
                  <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);">${/* JS will fill */}</div>
                  <div style="color: var(--gray);">Teachers</div>
                </div>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: var(--radius); text-align: center;">
                  <div style="font-size: 1.8rem; font-weight: bold; color: var(--accent);">${/* JS will fill */}</div>
                  <div style="color: var(--gray);">Events</div>
                </div>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: var(--radius); text-align: center;">
                  <div style="font-size: 1.8rem; font-weight: bold; color: var(--warning);">${/* JS will fill */}</div>
                  <div style="color: var(--gray);">Unread Messages</div>
                </div>
              </div>

              <h4 style="margin: 1.5rem 0 1rem;">Recent Activity</h4>
              <div class="activity-log" id="activity-log">
                <div class="activity-item">
                  <div>System initialized</div>
                  <div class="activity-time">${new Date().toLocaleString()}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- HOMEWORK -->
          <div id="homework" class="tab-content" style="display:none;">
            <div class="card">
              <h3 class="card-title">Homework Management</h3>
              <div class="import-export">
                <button class="btn btn-success" id="add-homework-btn">Add Homework</button>
                <button class="btn btn-warning" id="bulk-add-homework">Bulk Add Sample</button>
                <button class="btn" id="export-homework">Export Homework</button>
                <button class="btn" id="import-homework">Import Homework</button>
                <button class="btn btn-danger" id="clear-homework">Clear All</button>
              </div>
              
              <div class="table-container">
                <table id="homework-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Subject</th>
                      <th>Class</th>
                      <th>Date</th>
                      <th>Priority</th>
                      <th>Description</th>
                      <th>Attachment</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- JS will fill -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- TEACHERS -->
          <div id="teachers" class="tab-content" style="display:none;">
            <div class="card">
              <h3 class="card-title">Teachers Management</h3>
              <div class="import-export">
                <button class="btn btn-success" id="add-teacher-btn">Add Teacher</button>
                <button class="btn" id="export-teachers">Export Teachers</button>
                <button class="btn" id="import-teachers">Import Teachers</button>
                <button class="btn btn-danger" id="clear-teachers">Clear All</button>
              </div>
              
              <div class="table-container">
                <table id="teachers-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Subject</th>
                      <th>Class</th>
                      <th>Phone</th>
                      <th>Email</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- JS will fill -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- EVENTS -->
          <div id="events" class="tab-content" style="display:none;">
            <div class="card">
              <h3 class="card-title">Events Management</h3>
              <div class="import-export">
                <button class="btn btn-success" id="add-event-btn">Add Event</button>
                <button class="btn" id="export-events">Export Events</button>
                <button class="btn" id="import-events">Import Events</button>
                <button class="btn btn-danger" id="clear-events">Clear All</button>
              </div>
              
              <div class="table-container">
                <table id="events-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Title</th>
                      <th>Date</th>
                      <th>Time</th>
                      <th>Venue</th>
                      <th>Description</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- JS will fill -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- NOTICES -->
          <div id="notices" class="tab-content" style="display:none;">
            <div class="card">
              <h3 class="card-title">Notices Management</h3>
              <div class="import-export">
                <button class="btn btn-success" id="add-notice-btn">Add Notice</button>
                <button class="btn" id="export-notices">Export Notices</button>
                <button class="btn" id="import-notices">Import Notices</button>
                <button class="btn btn-danger" id="clear-notices">Clear All</button>
              </div>
              
              <div class="table-container">
                <table id="notices-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Title</th>
                      <th>Date</th>
                      <th>Priority</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- JS will fill -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- TIMETABLE -->
          <div id="timetable" class="tab-content" style="display:none;">
            <div class="card">
              <h3 class="card-title">Timetable Management</h3>
              <p>This section would allow editing of the school timetable. For demo purposes, it's read-only.</p>
              
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Time</th>
                      <th>Monday</th>
                      <th>Tuesday</th>
                      <th>Wednesday</th>
                      <th>Thursday</th>
                      <th>Friday</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>9:00-10:00</td>
                      <td>Math</td>
                      <td>Science</td>
                      <td>English</td>
                      <td>Math</td>
                      <td>Science</td>
                    </tr>
                    <tr>
                      <td>10:00-11:00</td>
                      <td>English</td>
                      <td>Math</td>
                      <td>Science</td>
                      <td>English</td>
                      <td>Math</td>
                    </tr>
                    <tr>
                      <td>11:00-12:00</td>
                      <td>Science</td>
                      <td>English</td>
                      <td>Math</td>
                      <td>Science</td>
                      <td>English</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- GALLERY -->
          <div id="gallery" class="tab-content" style="display:none;">
            <div class="card">
              <h3 class="card-title">Gallery Management</h3>
              <div class="import-export">
                <button class="btn btn-success" id="add-gallery-btn">Add Image</button>
                <button class="btn" id="export-gallery">Export Gallery</button>
                <button class="btn" id="import-gallery">Import Gallery</button>
                <button class="btn btn-danger" id="clear-gallery">Clear All</button>
              </div>
              
              <div class="table-container">
                <table id="gallery-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Image</th>
                      <th>Caption</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- JS will fill -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- MESSAGES -->
          <div id="messages" class="tab-content" style="display:none;">
            <div class="card">
              <h3 class="card-title">Messages Inbox</h3>
              <div class="import-export">
                <button class="btn" id="export-messages">Export Messages</button>
                <button class="btn btn-danger" id="clear-messages">Clear All</button>
              </div>
              
              <div class="table-container">
                <table id="messages-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Message</th>
                      <th>Date</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- JS will fill -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- DATA MANAGEMENT -->
          <div id="data" class="tab-content" style="display:none;">
            <div class="card">
              <h3 class="card-title">Data Management</h3>
              <p>Import, export, and reset all application data.</p>
              
              <div class="import-export" style="margin-bottom: 2rem;">
                <button class="btn btn-success" id="export-all">Export All Data</button>
                <button class="btn" id="import-all">Import All Data</button>
                <input type="file" id="import-all-file" class="file-input" accept=".json" />
              </div>

              <div style="background: #f8f9fa; padding: 1.5rem; border-radius: var(--radius);">
                <h4>Reset Options</h4>
                <p>Restore data to default values. This cannot be undone.</p>
                <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                  <button class="btn btn-warning" id="reset-all">Reset All Data to Defaults</button>
                  <button class="btn btn-danger" id="clear-all">Clear All Data</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODALS -->
  <!-- Homework Modal -->
  <div class="modal" id="homework-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="homework-modal-title">Add Homework</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="homework-form">
          <input type="hidden" id="homework-id" />
          <div class="form-row">
            <div class="form-col">
              <label for="homework-subject">Subject</label>
              <input type="text" id="homework-subject" required />
            </div>
            <div class="form-col">
              <label for="homework-class">Class</label>
              <select id="homework-class" required>
                <option value="">Select Class</option>
                <option value="1">Class 1</option>
                <option value="2">Class 2</option>
                <option value="3">Class 3</option>
                <option value="4">Class 4</option>
                <option value="5">Class 5</option>
                <option value="6">Class 6</option>
                <option value="7">Class 7</option>
                <option value="8">Class 8</option>
                <option value="9">Class 9</option>
                <option value="10">Class 10</option>
                <option value="11">Class 11</option>
                <option value="12">Class 12</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-col">
              <label for="homework-date">Date</label>
              <input type="date" id="homework-date" required />
            </div>
            <div class="form-col">
              <label for="homework-priority">Priority</label>
              <select id="homework-priority" required>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="homework-description">Description</label>
            <textarea id="homework-description" rows="3" required></textarea>
          </div>
          <div class="form-group">
            <label for="homework-attachment">
              <input type="checkbox" id="homework-attachment" />
              Has Attachment
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="delete-homework-btn" style="display:none;">Delete</button>
        <button class="btn" id="cancel-homework-btn">Cancel</button>
        <button class="btn btn-success" id="save-homework-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Teacher Modal -->
  <div class="modal" id="teacher-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="teacher-modal-title">Add Teacher</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="teacher-form">
          <input type="hidden" id="teacher-id" />
          <div class="form-row">
            <div class="form-col">
              <label for="teacher-name">Name</label>
              <input type="text" id="teacher-name" required />
            </div>
            <div class="form-col">
              <label for="teacher-subject">Subject</label>
              <input type="text" id="teacher-subject" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-col">
              <label for="teacher-class">Teaches Classes</label>
              <input type="text" id="teacher-class" placeholder="e.g. 9-12" required />
            </div>
            <div class="form-col">
              <label for="teacher-phone">Phone</label>
              <input type="tel" id="teacher-phone" required />
            </div>
          </div>
          <div class="form-group">
            <label for="teacher-email">Email</label>
            <input type="email" id="teacher-email" required />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="delete-teacher-btn" style="display:none;">Delete</button>
        <button class="btn" id="cancel-teacher-btn">Cancel</button>
        <button class="btn btn-success" id="save-teacher-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Event Modal -->
  <div class="modal" id="event-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="event-modal-title">Add Event</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="event-form">
          <input type="hidden" id="event-id" />
          <div class="form-row">
            <div class="form-col">
              <label for="event-title">Title</label>
              <input type="text" id="event-title" required />
            </div>
            <div class="form-col">
              <label for="event-date">Date</label>
              <input type="date" id="event-date" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-col">
              <label for="event-time">Time</label>
              <input type="time" id="event-time" required />
            </div>
            <div class="form-col">
              <label for="event-venue">Venue</label>
              <input type="text" id="event-venue" required />
            </div>
          </div>
          <div class="form-group">
            <label for="event-description">Description</label>
            <textarea id="event-description" rows="3" required></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="delete-event-btn" style="display:none;">Delete</button>
        <button class="btn" id="cancel-event-btn">Cancel</button>
        <button class="btn btn-success" id="save-event-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Notice Modal -->
  <div class="modal" id="notice-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="notice-modal-title">Add Notice</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="notice-form">
          <input type="hidden" id="notice-id" />
          <div class="form-group">
            <label for="notice-title">Title</label>
            <input type="text" id="notice-title" required />
          </div>
          <div class="form-row">
            <div class="form-col">
              <label for="notice-date">Date</label>
              <input type="date" id="notice-date" required />
            </div>
            <div class="form-col">
              <label for="notice-priority">Priority</label>
              <select id="notice-priority" required>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
              </select>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="delete-notice-btn" style="display:none;">Delete</button>
        <button class="btn" id="cancel-notice-btn">Cancel</button>
        <button class="btn btn-success" id="save-notice-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Gallery Modal -->
  <div class="modal" id="gallery-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="gallery-modal-title">Add Gallery Image</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="gallery-form">
          <input type="hidden" id="gallery-id" />
          <div class="form-group">
            <label for="gallery-url">Image URL</label>
            <input type="url" id="gallery-url" placeholder="https://example.com/image.jpg" required />
          </div>
          <div class="form-group">
            <label for="gallery-caption">Caption</label>
            <input type="text" id="gallery-caption" required />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="delete-gallery-btn" style="display:none;">Delete</button>
        <button class="btn" id="cancel-gallery-btn">Cancel</button>
        <button class="btn btn-success" id="save-gallery-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal" id="confirm-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Confirm Action</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <p id="confirm-message">Are you sure you want to perform this action? This cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn" id="confirm-cancel">Cancel</button>
        <button class="btn btn-danger" id="confirm-proceed">Proceed</button>
      </div>
    </div>
  </div>

  <!-- Import File Inputs (Hidden) -->
  <input type="file" id="import-homework-file" class="file-input" accept=".json" />
  <input type="file" id="import-teachers-file" class="file-input" accept=".json" />
  <input type="file" id="import-events-file" class="file-input" accept=".json" />
  <input type="file" id="import-notices-file" class="file-input" accept=".json" />
  <input type="file" id="import-gallery-file" class="file-input" accept=".json" />
  <input type="file" id="import-messages-file" class="file-input" accept=".json" />

  <script>
    // === GLOBAL VARIABLES ===
    const STORAGE_KEYS = {
      STUDENT: 'mkps_student',
      HOMEWORK: 'mkps_homework',
      TEACHERS: 'mkps_teachers',
      EVENTS: 'mkps_events',
      NOTICES: 'mkps_notices',
      TIMETABLE: 'mkps_timetable',
      GALLERY: 'mkps_gallery',
      MESSAGES: 'mkps_messages',
      UPDATE: 'mkps_update'
    };

    const ADMIN_PASSWORD = 'Abutalha';

    let homeworkList = [];
    let teachersList = [];
    let eventsList = [];
    let noticesList = [];
    let galleryList = [];
    let messagesList = [];
    let activityLog = [];

    // === DATA LOADERS ===
    function loadData() {
      try {
        const hw = localStorage.getItem(STORAGE_KEYS.HOMEWORK);
        homeworkList = hw ? JSON.parse(hw) : [];

        const teachers = localStorage.getItem(STORAGE_KEYS.TEACHERS);
        teachersList = teachers ? JSON.parse(teachers) : [];

        const events = localStorage.getItem(STORAGE_KEYS.EVENTS);
        eventsList = events ? JSON.parse(events) : [];

        const notices = localStorage.getItem(STORAGE_KEYS.NOTICES);
        noticesList = notices ? JSON.parse(notices) : [];

        const gallery = localStorage.getItem(STORAGE_KEYS.GALLERY);
        galleryList = gallery ? JSON.parse(gallery) : [];

        const messages = localStorage.getItem(STORAGE_KEYS.MESSAGES);
        messagesList = messages ? JSON.parse(messages) : [];

      } catch (e) {
        console.error('Error loading data:', e);
        alert('Error loading data. Some features may not work correctly.');
      }
    }

    // === RENDERERS ===
    function renderHomework() {
      const tbody = document.querySelector('#homework-table tbody');
      if (!tbody) return;

      if (homeworkList.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">No homework items found.</td></tr>';
        return;
      }

      tbody.innerHTML = homeworkList.map(hw => `
        <tr>
          <td>${hw.id}</td>
          <td>${hw.subject}</td>
          <td>Class ${hw.class}</td>
          <td>${hw.date}</td>
          <td><span class="badge badge-${hw.priority}">${hw.priority}</span></td>
          <td>${hw.description}</td>
          <td>${hw.attachment ? 'Yes' : 'No'}</td>
          <td>
            <button class="btn btn-sm" onclick="editHomework(${hw.id})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteHomework(${hw.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function renderTeachers() {
      const tbody = document.querySelector('#teachers-table tbody');
      if (!tbody) return;

      if (teachersList.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">No teachers found.</td></tr>';
        return;
      }

      tbody.innerHTML = teachersList.map(t => `
        <tr>
          <td>${t.id}</td>
          <td>${t.name}</td>
          <td>${t.subject}</td>
          <td>${t.class}</td>
          <td>${t.phone}</td>
          <td>${t.email}</td>
          <td>
            <button class="btn btn-sm" onclick="editTeacher(${t.id})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteTeacher(${t.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function renderEvents() {
      const tbody = document.querySelector('#events-table tbody');
      if (!tbody) return;

      if (eventsList.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">No events found.</td></tr>';
        return;
      }

      tbody.innerHTML = eventsList.map(e => `
        <tr>
          <td>${e.id}</td>
          <td>${e.title}</td>
          <td>${e.date}</td>
          <td>${e.time}</td>
          <td>${e.venue}</td>
          <td>${e.description}</td>
          <td>
            <button class="btn btn-sm" onclick="editEvent(${e.id})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteEvent(${e.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function renderNotices() {
      const tbody = document.querySelector('#notices-table tbody');
      if (!tbody) return;

      if (noticesList.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No notices found.</td></tr>';
        return;
      }

      tbody.innerHTML = noticesList.map(n => `
        <tr>
          <td>${n.id}</td>
          <td>${n.title}</td>
          <td>${n.date}</td>
          <td><span class="badge badge-${n.priority}">${n.priority}</span></td>
          <td>
            <button class="btn btn-sm" onclick="editNotice(${n.id})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteNotice(${n.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function renderGallery() {
      const tbody = document.querySelector('#gallery-table tbody');
      if (!tbody) return;

      if (galleryList.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No images in gallery.</td></tr>';
        return;
      }

      tbody.innerHTML = galleryList.map(g => `
        <tr>
          <td>${g.id}</td>
          <td><a href="${g.url}" target="_blank">View Image</a></td>
          <td>${g.caption}</td>
          <td>
            <button class="btn btn-sm" onclick="editGallery(${g.id})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteGallery(${g.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function renderMessages() {
      const tbody = document.querySelector('#messages-table tbody');
      if (!tbody) return;

      if (messagesList.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">No messages found.</td></tr>';
        return;
      }

      tbody.innerHTML = messagesList.map(m => `
        <tr>
          <td>${m.id}</td>
          <td>${m.name}</td>
          <td>${m.email}</td>
          <td>${m.message}</td>
          <td>${new Date(m.timestamp).toLocaleString()}</td>
          <td><span class="badge ${m.read ? 'badge-success' : 'badge-warning'}">${m.read ? 'Read' : 'Unread'}</span></td>
          <td>
            <button class="btn btn-sm" onclick="toggleMessageRead(${m.id})">${m.read ? 'Mark Unread' : 'Mark Read'}</button>
            <button class="btn btn-sm btn-danger" onclick="deleteMessage(${m.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function updateDashboardStats() {
      document.querySelector('#dashboard .card div:nth-child(1) div:first-child').textContent = homeworkList.length;
      document.querySelector('#dashboard .card div:nth-child(2) div:first-child').textContent = teachersList.length;
      document.querySelector('#dashboard .card div:nth-child(3) div:first-child').textContent = eventsList.length;
      
      const unreadCount = messagesList.filter(m => !m.read).length;
      document.querySelector('#dashboard .card div:nth-child(4) div:first-child').textContent = unreadCount;
    }

    function renderActivityLog() {
      const log = document.getElementById('activity-log');
      if (!log) return;

      log.innerHTML = activityLog.map(item => `
        <div class="activity-item">
          <div>${item.action}</div>
          <div class="activity-time">${item.time}</div>
        </div>
      `).join('');

      // Keep only last 20 items
      if (activityLog.length > 20) {
        activityLog = activityLog.slice(-20);
        renderActivityLog();
      }
    }

    // === MODAL CONTROLLERS ===
    function showModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }

    function hideModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    // === CRUD OPERATIONS ===
    function addActivity(action) {
      activityLog.unshift({
        action,
        time: new Date().toLocaleString()
      });
      renderActivityLog();
    }

    function saveData(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
      localStorage.setItem(STORAGE_KEYS.UPDATE, Date.now().toString());
    }

    // Homework CRUD
    function addHomework() {
      document.getElementById('homework-modal-title').textContent = 'Add Homework';
      document.getElementById('homework-form').reset();
      document.getElementById('homework-id').value = '';
      document.getElementById('delete-homework-btn').style.display = 'none';
      showModal('homework-modal');
    }

    function editHomework(id) {
      const hw = homeworkList.find(h => h.id === id);
      if (!hw) return;

      document.getElementById('homework-modal-title').textContent = 'Edit Homework';
      document.getElementById('homework-id').value = hw.id;
      document.getElementById('homework-subject').value = hw.subject;
      document.getElementById('homework-class').value = hw.class;
      document.getElementById('homework-date').value = hw.date;
      document.getElementById('homework-priority').value = hw.priority;
      document.getElementById('homework-description').value = hw.description;
      document.getElementById('homework-attachment').checked = hw.attachment;
      document.getElementById('delete-homework-btn').style.display = 'inline-block';
      showModal('homework-modal');
    }

    function saveHomework() {
      const id = document.getElementById('homework-id').value;
      const subject = document.getElementById('homework-subject').value;
      const cls = document.getElementById('homework-class').value;
      const date = document.getElementById('homework-date').value;
      const priority = document.getElementById('homework-priority').value;
      const description = document.getElementById('homework-description').value;
      const attachment = document.getElementById('homework-attachment').checked;

      if (!subject || !cls || !date || !priority || !description) {
        alert('Please fill in all fields.');
        return;
      }

      if (id) {
        // Edit existing
        const index = homeworkList.findIndex(h => h.id == id);
        if (index !== -1) {
          homeworkList[index] = { id: parseInt(id), subject, class: cls, date, priority, description, attachment, done: false };
          addActivity(`Updated homework #${id}`);
        }
      } else {
        // Add new
        const newId = homeworkList.length > 0 ? Math.max(...homeworkList.map(h => h.id)) + 1 : 1;
        homeworkList.push({ id: newId, subject, class: cls, date, priority, description, attachment, done: false });
        addActivity(`Added new homework #${newId}`);
      }

      saveData(STORAGE_KEYS.HOMEWORK, homeworkList);
      renderHomework();
      hideModal('homework-modal');
    }

    function deleteHomework(id) {
      showConfirm(
        `Are you sure you want to delete homework #${id}?`,
        () => {
          const index = homeworkList.findIndex(h => h.id === id);
          if (index !== -1) {
            homeworkList.splice(index, 1);
            saveData(STORAGE_KEYS.HOMEWORK, homeworkList);
            renderHomework();
            addActivity(`Deleted homework #${id}`);
          }
        }
      );
    }

    // Teacher CRUD
    function addTeacher() {
      document.getElementById('teacher-modal-title').textContent = 'Add Teacher';
      document.getElementById('teacher-form').reset();
      document.getElementById('teacher-id').value = '';
      document.getElementById('delete-teacher-btn').style.display = 'none';
      showModal('teacher-modal');
    }

    function editTeacher(id) {
      const t = teachersList.find(t => t.id === id);
      if (!t) return;

      document.getElementById('teacher-modal-title').textContent = 'Edit Teacher';
      document.getElementById('teacher-id').value = t.id;
      document.getElementById('teacher-name').value = t.name;
      document.getElementById('teacher-subject').value = t.subject;
      document.getElementById('teacher-class').value = t.class;
      document.getElementById('teacher-phone').value = t.phone;
      document.getElementById('teacher-email').value = t.email;
      document.getElementById('delete-teacher-btn').style.display = 'inline-block';
      showModal('teacher-modal');
    }

    function saveTeacher() {
      const id = document.getElementById('teacher-id').value;
      const name = document.getElementById('teacher-name').value;
      const subject = document.getElementById('teacher-subject').value;
      const cls = document.getElementById('teacher-class').value;
      const phone = document.getElementById('teacher-phone').value;
      const email = document.getElementById('teacher-email').value;

      if (!name || !subject || !cls || !phone || !email) {
        alert('Please fill in all fields.');
        return;
      }

      if (id) {
        // Edit existing
        const index = teachersList.findIndex(t => t.id == id);
        if (index !== -1) {
          teachersList[index] = { id: parseInt(id), name, subject, class: cls, phone, email };
          addActivity(`Updated teacher #${id}`);
        }
      } else {
        // Add new
        const newId = teachersList.length > 0 ? Math.max(...teachersList.map(t => t.id)) + 1 : 1;
        teachersList.push({ id: newId, name, subject, class: cls, phone, email });
        addActivity(`Added new teacher #${newId}`);
      }

      saveData(STORAGE_KEYS.TEACHERS, teachersList);
      renderTeachers();
      hideModal('teacher-modal');
    }

    function deleteTeacher(id) {
      showConfirm(
        `Are you sure you want to delete teacher #${id}?`,
        () => {
          const index = teachersList.findIndex(t => t.id === id);
          if (index !== -1) {
            teachersList.splice(index, 1);
            saveData(STORAGE_KEYS.TEACHERS, teachersList);
            renderTeachers();
            addActivity(`Deleted teacher #${id}`);
          }
        }
      );
    }

    // Event CRUD
    function addEvent() {
      document.getElementById('event-modal-title').textContent = 'Add Event';
      document.getElementById('event-form').reset();
      document.getElementById('event-id').value = '';
      document.getElementById('delete-event-btn').style.display = 'none';
      showModal('event-modal');
    }

    function editEvent(id) {
      const e = eventsList.find(e => e.id === id);
      if (!e) return;

      document.getElementById('event-modal-title').textContent = 'Edit Event';
      document.getElementById('event-id').value = e.id;
      document.getElementById('event-title').value = e.title;
      document.getElementById('event-date').value = e.date;
      document.getElementById('event-time').value = e.time;
      document.getElementById('event-venue').value = e.venue;
      document.getElementById('event-description').value = e.description;
      document.getElementById('delete-event-btn').style.display = 'inline-block';
      showModal('event-modal');
    }

    function saveEvent() {
      const id = document.getElementById('event-id').value;
      const title = document.getElementById('event-title').value;
      const date = document.getElementById('event-date').value;
      const time = document.getElementById('event-time').value;
      const venue = document.getElementById('event-venue').value;
      const description = document.getElementById('event-description').value;

      if (!title || !date || !time || !venue || !description) {
        alert('Please fill in all fields.');
        return;
      }

      if (id) {
        // Edit existing
        const index = eventsList.findIndex(e => e.id == id);
        if (index !== -1) {
          eventsList[index] = { id: parseInt(id), title, date, time, venue, description };
          addActivity(`Updated event #${id}`);
        }
      } else {
        // Add new
        const newId = eventsList.length > 0 ? Math.max(...eventsList.map(e => e.id)) + 1 : 1;
        eventsList.push({ id: newId, title, date, time, venue, description });
        addActivity(`Added new event #${newId}`);
      }

      saveData(STORAGE_KEYS.EVENTS, eventsList);
      renderEvents();
      hideModal('event-modal');
    }

    function deleteEvent(id) {
      showConfirm(
        `Are you sure you want to delete event #${id}?`,
        () => {
          const index = eventsList.findIndex(e => e.id === id);
          if (index !== -1) {
            eventsList.splice(index, 1);
            saveData(STORAGE_KEYS.EVENTS, eventsList);
            renderEvents();
            addActivity(`Deleted event #${id}`);
          }
        }
      );
    }

    // Notice CRUD
    function addNotice() {
      document.getElementById('notice-modal-title').textContent = 'Add Notice';
      document.getElementById('notice-form').reset();
      document.getElementById('notice-id').value = '';
      document.getElementById('delete-notice-btn').style.display = 'none';
      showModal('notice-modal');
    }

    function editNotice(id) {
      const n = noticesList.find(n => n.id === id);
      if (!n) return;

      document.getElementById('notice-modal-title').textContent = 'Edit Notice';
      document.getElementById('notice-id').value = n.id;
      document.getElementById('notice-title').value = n.title;
      document.getElementById('notice-date').value = n.date;
      document.getElementById('notice-priority').value = n.priority;
      document.getElementById('delete-notice-btn').style.display = 'inline-block';
      showModal('notice-modal');
    }

    function saveNotice() {
      const id = document.getElementById('notice-id').value;
      const title = document.getElementById('notice-title').value;
      const date = document.getElementById('notice-date').value;
      const priority = document.getElementById('notice-priority').value;

      if (!title || !date || !priority) {
        alert('Please fill in all fields.');
        return;
      }

      if (id) {
        // Edit existing
        const index = noticesList.findIndex(n => n.id == id);
        if (index !== -1) {
          noticesList[index] = { id: parseInt(id), title, date, priority };
          addActivity(`Updated notice #${id}`);
        }
      } else {
        // Add new
        const newId = noticesList.length > 0 ? Math.max(...noticesList.map(n => n.id)) + 1 : 1;
        noticesList.push({ id: newId, title, date, priority });
        addActivity(`Added new notice #${newId}`);
      }

      saveData(STORAGE_KEYS.NOTICES, noticesList);
      renderNotices();
      hideModal('notice-modal');
    }

    function deleteNotice(id) {
      showConfirm(
        `Are you sure you want to delete notice #${id}?`,
        () => {
          const index = noticesList.findIndex(n => n.id === id);
          if (index !== -1) {
            noticesList.splice(index, 1);
            saveData(STORAGE_KEYS.NOTICES, noticesList);
            renderNotices();
            addActivity(`Deleted notice #${id}`);
          }
        }
      );
    }

    // Gallery CRUD
    function addGallery() {
      document.getElementById('gallery-modal-title').textContent = 'Add Gallery Image';
      document.getElementById('gallery-form').reset();
      document.getElementById('gallery-id').value = '';
      document.getElementById('delete-gallery-btn').style.display = 'none';
      showModal('gallery-modal');
    }

    function editGallery(id) {
      const g = galleryList.find(g => g.id === id);
      if (!g) return;

      document.getElementById('gallery-modal-title').textContent = 'Edit Gallery Image';
      document.getElementById('gallery-id').value = g.id;
      document.getElementById('gallery-url').value = g.url;
      document.getElementById('gallery-caption').value = g.caption;
      document.getElementById('delete-gallery-btn').style.display = 'inline-block';
      showModal('gallery-modal');
    }

    function saveGallery() {
      const id = document.getElementById('gallery-id').value;
      const url = document.getElementById('gallery-url').value;
      const caption = document.getElementById('gallery-caption').value;

      if (!url || !caption) {
        alert('Please fill in all fields.');
        return;
      }

      if (id) {
        // Edit existing
        const index = galleryList.findIndex(g => g.id == id);
        if (index !== -1) {
          galleryList[index] = { id: parseInt(id), url, caption };
          addActivity(`Updated gallery image #${id}`);
        }
      } else {
        // Add new
        const newId = galleryList.length > 0 ? Math.max(...galleryList.map(g => g.id)) + 1 : 1;
        galleryList.push({ id: newId, url, caption });
        addActivity(`Added new gallery image #${newId}`);
      }

      saveData(STORAGE_KEYS.GALLERY, galleryList);
      renderGallery();
      hideModal('gallery-modal');
    }

    function deleteGallery(id) {
      showConfirm(
        `Are you sure you want to delete gallery image #${id}?`,
        () => {
          const index = galleryList.findIndex(g => g.id === id);
          if (index !== -1) {
            galleryList.splice(index, 1);
            saveData(STORAGE_KEYS.GALLERY, galleryList);
            renderGallery();
            addActivity(`Deleted gallery image #${id}`);
          }
        }
      );
    }

    // Message actions
    function toggleMessageRead(id) {
      const index = messagesList.findIndex(m => m.id === id);
      if (index !== -1) {
        messagesList[index].read = !messagesList[index].read;
        saveData(STORAGE_KEYS.MESSAGES, messagesList);
        renderMessages();
        addActivity(`Toggled read status for message #${id}`);
      }
    }

    function deleteMessage(id) {
      showConfirm(
        `Are you sure you want to delete message #${id}?`,
        () => {
          const index = messagesList.findIndex(m => m.id === id);
          if (index !== -1) {
            messagesList.splice(index, 1);
            saveData(STORAGE_KEYS.MESSAGES, messagesList);
            renderMessages();
            addActivity(`Deleted message #${id}`);
          }
        }
      );
    }

    // === CONFIRMATION MODAL ===
    function showConfirm(message, onConfirm) {
      document.getElementById('confirm-message').textContent = message;
      window.confirmCallback = onConfirm;
      showModal('confirm-modal');
    }

    // === DATA IMPORT/EXPORT ===
    function exportData(data, filename) {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function importData(inputId, setData, renderFn, key) {
      document.getElementById(inputId).click();
      
      document.getElementById(inputId).onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            setData(data);
            saveData(key, data);
            renderFn();
            addActivity(`Imported data for ${key.replace('mkps_', '').toUpperCase()}`);
            alert('Data imported successfully!');
          } catch (err) {
            alert('Error importing data: Invalid JSON file.');
            console.error(err);
          }
        };
        reader.readAsText(file);
      };
    }

    // === BULK OPERATIONS ===
    function bulkAddSampleHomework() {
      showConfirm(
        'Add 10 sample homework items for all classes?',
        () => {
          const subjects = ['Mathematics', 'Science', 'English', 'Social Studies', 'Hindi', 'Computer Science'];
          const descriptions = [
            'Complete the assigned exercises from the textbook',
            'Prepare a project on the given topic',
            'Write an essay on the specified subject',
            'Solve the numerical problems provided',
            'Read the chapter and answer the questions',
            'Conduct an experiment and write a report',
            'Prepare for the upcoming test',
            'Complete the worksheet given in class'
          ];

          const priorities = ['low', 'medium', 'high'];

          for (let i = 0; i < 10; i++) {
            const cls = Math.floor(Math.random() * 12) + 1;
            const subject = subjects[Math.floor(Math.random() * subjects.length)];
            const desc = descriptions[Math.floor(Math.random() * descriptions.length)];
            const priority = priorities[Math.floor(Math.random() * priorities.length)];
            
            // Random date within next 14 days
            const date = new Date();
            date.setDate(date.getDate() + Math.floor(Math.random() * 14));
            const dateString = date.toISOString().split('T')[0];

            const newId = homeworkList.length > 0 ? Math.max(...homeworkList.map(h => h.id)) + 1 : 1;
            homeworkList.push({
              id: newId,
              subject,
              class: cls,
              date: dateString,
              priority,
              description: desc,
              attachment: Math.random() > 0.7,
              done: false
            });
          }

          saveData(STORAGE_KEYS.HOMEWORK, homeworkList);
          renderHomework();
          addActivity('Bulk added 10 sample homework items');
          alert('10 sample homework items added!');
        }
      );
    }

    function resetAllData() {
      showConfirm(
        'Reset all data to default values? This will overwrite all current data.',
        () => {
          // Clear all data
          Object.values(STORAGE_KEYS).forEach(key => {
            if (key !== STORAGE_KEYS.UPDATE) {
              localStorage.removeItem(key);
            }
          });

          // Seed fresh data
          seedInitialData();
          loadData();
          refreshAll();
          addActivity('Reset all data to defaults');
          alert('All data has been reset to default values.');
        }
      );
    }

    function clearAllData() {
      showConfirm(
        'Clear all data? This will delete everything and cannot be undone.',
        () => {
          Object.values(STORAGE_KEYS).forEach(key => {
            localStorage.removeItem(key);
          });

          // Reset arrays
          homeworkList = [];
          teachersList = [];
          eventsList = [];
          noticesList = [];
          galleryList = [];
          messagesList = [];

          refreshAll();
          addActivity('Cleared all data');
          alert('All data has been cleared.');
        }
      );
    }

    // === INITIALIZATION ===
    function seedInitialData() {
      console.log('Seeding initial data...');
      
      const sampleHomework = [
        { id: 1, subject: 'Mathematics', class: 9, date: '2023-10-15', description: 'Complete exercises 5.1 to 5.3 on quadratic equations', priority: 'high', done: false, attachment: false },
        { id: 2, subject: 'Science', class: 9, date: '2023-10-16', description: 'Prepare a project on the human digestive system', priority: 'medium', done: false, attachment: true },
        { id: 3, subject: 'English', class: 10, date: '2023-10-14', description: 'Write an essay on "The Importance of Education"', priority: 'high', done: false, attachment: false }
      ];
      localStorage.setItem(STORAGE_KEYS.HOMEWORK, JSON.stringify(sampleHomework));

      const sampleTeachers = [
        { id: 1, name: 'Dr. A. Sharma', subject: 'Mathematics', class: '9-12', phone: '9876543210', email: 'sharma@mkps.edu' },
        { id: 2, name: 'Mrs. P. Verma', subject: 'Science', class: '6-8', phone: '9876543211', email: 'verma@mkps.edu' },
        { id: 3, name: 'Mr. R. Khan', subject: 'English', class: '9-12', phone: '9876543212', email: 'khan@mkps.edu' }
      ];
      localStorage.setItem(STORAGE_KEYS.TEACHERS, JSON.stringify(sampleTeachers));

      const sampleEvents = [
        { id: 1, title: 'Annual Day Celebration', date: '2023-11-15', time: '10:00 AM', venue: 'School Ground', description: 'Cultural programs and award distribution' },
        { id: 2, title: 'Parent-Teacher Meeting', date: '2023-10-20', time: '2:00 PM', venue: 'School Hall', description: 'Discussion about student progress' }
      ];
      localStorage.setItem(STORAGE_KEYS.EVENTS, JSON.stringify(sampleEvents));

      const sampleNotices = [
        { id: 1, title: 'School will remain closed on October 2nd for Gandhi Jayanti', date: '2023-09-25', priority: 'high' },
        { id: 2, title: 'New library books have arrived', date: '2023-10-10', priority: 'medium' }
      ];
      localStorage.setItem(STORAGE_KEYS.NOTICES, JSON.stringify(sampleNotices));

      const sampleGallery = [
        { id: 1, url: 'https://placehold.co/600x400?text=School+Event+1', caption: 'Annual Sports Day 2023' },
        { id: 2, url: 'https://placehold.co/600x400?text=Science+Fair', caption: 'Science Exhibition' }
      ];
      localStorage.setItem(STORAGE_KEYS.GALLERY, JSON.stringify(sampleGallery));

      const sampleMessages = [
        { id: 1, name: 'Rahul Kumar', email: 'rahul@email.com', message: 'Inquiry about admission process', read: false, timestamp: Date.now() - 86400000 }
      ];
      localStorage.setItem(STORAGE_KEYS.MESSAGES, JSON.stringify(sampleMessages));
    }

    function refreshAll() {
      renderHomework();
      renderTeachers();
      renderEvents();
      renderNotices();
      renderGallery();
      renderMessages();
      updateDashboardStats();
    }

    function setupEventListeners() {
      // Login form
      document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const password = document.getElementById('password').value;
        
        if (password === ADMIN_PASSWORD) {
          document.getElementById('login-screen').style.display = 'none';
          document.getElementById('admin-panel').style.display = 'block';
          loadData();
          refreshAll();
          addActivity('Admin logged in');
        } else {
          alert('Invalid password. Please try again.');
        }
      });

      // Logout
      document.getElementById('logout-btn').addEventListener('click', function() {
        if (confirm('Are you sure you want to logout?')) {
          document.getElementById('admin-panel').style.display = 'none';
          document.getElementById('login-screen').style.display = 'flex';
          document.getElementById('login-form').reset();
          addActivity('Admin logged out');
        }
      });

      // Navigation
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
          this.classList.add('active');
          
          document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
          });
          
          const tabId = this.getAttribute('data-tab');
          document.getElementById(tabId).style.display = 'block';
        });
      });

      // Homework
      document.getElementById('add-homework-btn').addEventListener('click', addHomework);
      document.getElementById('bulk-add-homework').addEventListener('click', bulkAddSampleHomework);
      document.getElementById('export-homework').addEventListener('click', () => {
        exportData(homeworkList, `mkps-homework-${new Date().toISOString().split('T')[0]}.json`);
        addActivity('Exported homework data');
      });
      document.getElementById('import-homework').addEventListener('click', () => {
        importData('import-homework-file', 
          data => homeworkList = data, 
          renderHomework, 
          STORAGE_KEYS.HOMEWORK
        );
      });
      document.getElementById('clear-homework').addEventListener('click', () => {
        showConfirm(
          'Clear all homework? This cannot be undone.',
          () => {
            homeworkList = [];
            saveData(STORAGE_KEYS.HOMEWORK, homeworkList);
            renderHomework();
            addActivity('Cleared all homework');
          }
        );
      });

      // Teachers
      document.getElementById('add-teacher-btn').addEventListener('click', addTeacher);
      document.getElementById('export-teachers').addEventListener('click', () => {
        exportData(teachersList, `mkps-teachers-${new Date().toISOString().split('T')[0]}.json`);
        addActivity('Exported teachers data');
      });
      document.getElementById('import-teachers').addEventListener('click', () => {
        importData('import-teachers-file', 
          data => teachersList = data, 
          renderTeachers, 
          STORAGE_KEYS.TEACHERS
        );
      });
      document.getElementById('clear-teachers').addEventListener('click', () => {
        showConfirm(
          'Clear all teachers? This cannot be undone.',
          () => {
            teachersList = [];
            saveData(STORAGE_KEYS.TEACHERS, teachersList);
            renderTeachers();
            addActivity('Cleared all teachers');
          }
        );
      });

      // Events
      document.getElementById('add-event-btn').addEventListener('click', addEvent);
      document.getElementById('export-events').addEventListener('click', () => {
        exportData(eventsList, `mkps-events-${new Date().toISOString().split('T')[0]}.json`);
        addActivity('Exported events data');
      });
      document.getElementById('import-events').addEventListener('click', () => {
        importData('import-events-file', 
          data => eventsList = data, 
          renderEvents, 
          STORAGE_KEYS.EVENTS
        );
      });
      document.getElementById('clear-events').addEventListener('click', () => {
        showConfirm(
          'Clear all events? This cannot be undone.',
          () => {
            eventsList = [];
            saveData(STORAGE_KEYS.EVENTS, eventsList);
            renderEvents();
            addActivity('Cleared all events');
          }
        );
      });

      // Notices
      document.getElementById('add-notice-btn').addEventListener('click', addNotice);
      document.getElementById('export-notices').addEventListener('click', () => {
        exportData(noticesList, `mkps-notices-${new Date().toISOString().split('T')[0]}.json`);
        addActivity('Exported notices data');
      });
      document.getElementById('import-notices').addEventListener('click', () => {
        importData('import-notices-file', 
          data => noticesList = data, 
          renderNotices, 
          STORAGE_KEYS.NOTICES
        );
      });
      document.getElementById('clear-notices').addEventListener('click', () => {
        showConfirm(
          'Clear all notices? This cannot be undone.',
          () => {
            noticesList = [];
            saveData(STORAGE_KEYS.NOTICES, noticesList);
            renderNotices();
            addActivity('Cleared all notices');
          }
        );
      });

      // Gallery
      document.getElementById('add-gallery-btn').addEventListener('click', addGallery);
      document.getElementById('export-gallery').addEventListener('click', () => {
        exportData(galleryList, `mkps-gallery-${new Date().toISOString().split('T')[0]}.json`);
        addActivity('Exported gallery data');
      });
      document.getElementById('import-gallery').addEventListener('click', () => {
        importData('import-gallery-file', 
          data => galleryList = data, 
          renderGallery, 
          STORAGE_KEYS.GALLERY
        );
      });
      document.getElementById('clear-gallery').addEventListener('click', () => {
        showConfirm(
          'Clear all gallery images? This cannot be undone.',
          () => {
            galleryList = [];
            saveData(STORAGE_KEYS.GALLERY, galleryList);
            renderGallery();
            addActivity('Cleared all gallery images');
          }
        );
      });

      // Messages
      document.getElementById('export-messages').addEventListener('click', () => {
        exportData(messagesList, `mkps-messages-${new Date().toISOString().split('T')[0]}.json`);
        addActivity('Exported messages data');
      });
      document.getElementById('clear-messages').addEventListener('click', () => {
        showConfirm(
          'Clear all messages? This cannot be undone.',
          () => {
            messagesList = [];
            saveData(STORAGE_KEYS.MESSAGES, messagesList);
            renderMessages();
            addActivity('Cleared all messages');
          }
        );
      });

      // Data Management
      document.getElementById('export-all').addEventListener('click', () => {
        const allData = {
          homework: homeworkList,
          teachers: teachersList,
          events: eventsList,
          notices: noticesList,
          gallery: galleryList,
          messages: messagesList,
          exportedAt: new Date().toISOString()
        };
        exportData(allData, `mkps-backup-${new Date().toISOString().split('T')[0]}.json`);
        addActivity('Exported all data');
      });

      document.getElementById('import-all').addEventListener('click', () => {
        document.getElementById('import-all-file').click();
      });

      document.getElementById('import-all-file').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            
            // Validate and import each key
            if (data.homework !== undefined) {
              homeworkList = data.homework;
              localStorage.setItem(STORAGE_KEYS.HOMEWORK, JSON.stringify(homeworkList));
            }
            if (data.teachers !== undefined) {
              teachersList = data.teachers;
              localStorage.setItem(STORAGE_KEYS.TEACHERS, JSON.stringify(teachersList));
            }
            if (data.events !== undefined) {
              eventsList = data.events;
              localStorage.setItem(STORAGE_KEYS.EVENTS, JSON.stringify(eventsList));
            }
            if (data.notices !== undefined) {
              noticesList = data.notices;
              localStorage.setItem(STORAGE_KEYS.NOTICES, JSON.stringify(noticesList));
            }
            if (data.gallery !== undefined) {
              galleryList = data.gallery;
              localStorage.setItem(STORAGE_KEYS.GALLERY, JSON.stringify(galleryList));
            }
            if (data.messages !== undefined) {
              messagesList = data.messages;
              localStorage.setItem(STORAGE_KEYS.MESSAGES, JSON.stringify(messagesList));
            }

            // Trigger update
            localStorage.setItem(STORAGE_KEYS.UPDATE, Date.now().toString());
            
            refreshAll();
            addActivity('Imported all data');
            alert('All data imported successfully!');
          } catch (err) {
            alert('Error importing data: Invalid JSON file.');
            console.error(err);
          }
        };
        reader.readAsText(file);
      });

      document.getElementById('reset-all').addEventListener('click', resetAllData);
      document.getElementById('clear-all').addEventListener('click', clearAllData);

      // Modal controls
      document.querySelectorAll('.modal-close').forEach(btn => {
        btn.addEventListener('click', function() {
          this.closest('.modal').classList.remove('active');
        });
      });

      document.getElementById('cancel-homework-btn').addEventListener('click', () => hideModal('homework-modal'));
      document.getElementById('save-homework-btn').addEventListener('click', saveHomework);
      document.getElementById('delete-homework-btn').addEventListener('click', () => {
        const id = document.getElementById('homework-id').value;
        if (id) deleteHomework(parseInt(id));
      });

      document.getElementById('cancel-teacher-btn').addEventListener('click', () => hideModal('teacher-modal'));
      document.getElementById('save-teacher-btn').addEventListener('click', saveTeacher);
      document.getElementById('delete-teacher-btn').addEventListener('click', () => {
        const id = document.getElementById('teacher-id').value;
        if (id) deleteTeacher(parseInt(id));
      });

      document.getElementById('cancel-event-btn').addEventListener('click', () => hideModal('event-modal'));
      document.getElementById('save-event-btn').addEventListener('click', saveEvent);
      document.getElementById('delete-event-btn').addEventListener('click', () => {
        const id = document.getElementById('event-id').value;
        if (id) deleteEvent(parseInt(id));
      });

      document.getElementById('cancel-notice-btn').addEventListener('click', () => hideModal('notice-modal'));
      document.getElementById('save-notice-btn').addEventListener('click', saveNotice);
      document.getElementById('delete-notice-btn').addEventListener('click', () => {
        const id = document.getElementById('notice-id').value;
        if (id) deleteNotice(parseInt(id));
      });

      document.getElementById('cancel-gallery-btn').addEventListener('click', () => hideModal('gallery-modal'));
      document.getElementById('save-gallery-btn').addEventListener('click', saveGallery);
      document.getElementById('delete-gallery-btn').addEventListener('click', () => {
        const id = document.getElementById('gallery-id').value;
        if (id) deleteGallery(parseInt(id));
      });

      // Confirm modal
      document.getElementById('confirm-cancel').addEventListener('click', () => hideModal('confirm-modal'));
      document.getElementById('confirm-proceed').addEventListener('click', () => {
        if (window.confirmCallback) {
          window.confirmCallback();
          window.confirmCallback = null;
        }
        hideModal('confirm-modal');
      });

      // Close modals when clicking outside
      document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
          if (e.target === this) {
            this.classList.remove('active');
          }
        });
      });
    }

    // Make functions globally available
    window.editHomework = editHomework;
    window.deleteHomework = deleteHomework;
    window.editTeacher = editTeacher;
    window.deleteTeacher = deleteTeacher;
    window.editEvent = editEvent;
    window.deleteEvent = deleteEvent;
    window.editNotice = editNotice;
    window.deleteNotice = deleteNotice;
    window.editGallery = editGallery;
    window.deleteGallery = deleteGallery;
    window.toggleMessageRead = toggleMessageRead;
    window.deleteMessage = deleteMessage;

    // Initialize
    window.addEventListener('DOMContentLoaded', function() {
      setupEventListeners();
      
      // Add initial activity
      addActivity('Admin panel initialized');
      
      // Show login screen
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('admin-panel').style.display = 'none';
    });
  </script>
</body>
</html>
