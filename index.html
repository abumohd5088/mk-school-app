<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Milli Karwaan Public School Balrampur</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root {
      --primary: #e53e3e;
      --primary-dark: #c53030;
      --primary-light: #fed7d7;
      --bg-light: #f7fafc;
      --bg-dark: #1a202c;
      --text-light: #4a5568;
      --text-dark: #e2e8f0;
      --card-bg-light: #ffffff;
      --card-bg-dark: #2d3748;
      --border-light: #e2e8f0;
      --border-dark: #4a5568;
      --shadow: 0 4px 6px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
      --radius: 12px;
      --transition: all 0.3s ease;
    }

    [data-theme="dark"] {
      --bg-light: #1a202c;
      --bg-dark: #121826;
      --text-light: #e2e8f0;
      --text-dark: #a0aec0;
      --card-bg-light: #2d3748;
      --card-bg-dark: #1e293b;
      --border-light: #4a5568;
      --border-dark: #2d3748;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      line-height: 1.7;
      transition: var(--transition);
      overflow-x: hidden;
    }

    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    img {
      max-width: 100%;
      border-radius: 6px;
    }

    a {
      color: var(--primary);
      text-decoration: none;
      transition: var(--transition);
    }

    a:hover {
      color: var(--primary-dark);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* GATE STYLES */
    #access-gate {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, var(--primary), #b33030);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 9999;
      opacity: 1;
      visibility: visible;
      transition: opacity 0.5s ease;
    }

    #access-gate.fade-out {
      opacity: 0;
      visibility: hidden;
    }

    #access-gate h1 {
      font-size: 2.8rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    #access-gate p {
      font-size: 1.1rem;
      margin-bottom: 30px;
      max-width: 600px;
    }

    .gate-form {
      background: rgba(255,255,255,0.15);
      padding: 40px;
      border-radius: var(--radius);
      backdrop-filter: blur(10px);
      width: 90%;
      max-width: 500px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      background: rgba(255,255,255,0.2);
      color: white;
      font-size: 1rem;
    }

    .form-group input::placeholder {
      color: rgba(255,255,255,0.7);
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: white;
      box-shadow: 0 0 0 2px rgba(255,255,255,0.5);
    }

    .btn {
      display: inline-block;
      background: white;
      color: var(--primary);
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .btn-primary {
      background: white;
      color: var(--primary);
    }

    .btn-danger {
      background: #e53e3e;
      color: white;
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 0.9rem;
    }

    /* HEADER */
    header {
      background: var(--card-bg-light);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 15px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
      border-bottom: 1px solid var(--border-light);
    }

    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .logo {
      height: 60px;
    }

    .school-info {
      flex: 1;
      min-width: 300px;
    }

    .school-info h1 {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      color: var(--primary);
      margin-bottom: 4px;
    }

    .school-info p {
      font-size: 0.9rem;
      color: var(--text-light);
    }

    .tagline {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary);
      margin: 5px 0;
    }

    .tagline-sub {
      font-size: 0.9rem;
      color: var(--text-light);
      font-style: italic;
    }

    .contact-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .call-btn {
      background: var(--primary);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .call-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .email-link {
      color: var(--text-light);
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9rem;
    }

    /* NAVIGATION */
    nav {
      background: var(--card-bg-light);
      padding: 10px 0;
      border-bottom: 1px solid var(--border-light);
    }

    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-links {
      display: flex;
      list-style: none;
      gap: 20px;
    }

    .nav-links a {
      color: var(--text-light);
      font-weight: 500;
      position: relative;
    }

    .nav-links a:hover, .nav-links a.active {
      color: var(--primary);
    }

    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--primary);
      transition: var(--transition);
    }

    .nav-links a:hover::after, .nav-links a.active::after {
      width: 100%;
    }

    .menu-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-light);
      cursor: pointer;
      display: none;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 20px;
      background: var(--card-bg-light);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      min-width: 250px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: var(--transition);
    }

    .dropdown-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-light);
      border-bottom: 1px solid var(--border-light);
      transition: var(--transition);
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background: var(--primary-light);
      color: var(--primary);
      padding-left: 25px;
    }

    .dropdown-item i {
      width: 20px;
      text-align: center;
      color: var(--primary);
    }

    /* SIDEBAR */
    .sidebar {
      position: fixed;
      top: 0;
      left: -300px;
      width: 300px;
      height: 100vh;
      background: var(--card-bg-light);
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      transition: var(--transition);
      overflow-y: auto;
      padding: 20px;
      border-right: 1px solid var(--border-light);
    }

    .sidebar.open {
      left: 0;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border-light);
      margin-bottom: 20px;
    }

    .sidebar-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-light);
    }

    .quick-search {
      margin-bottom: 20px;
    }

    .quick-search input {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      background: var(--bg-light);
      color: var(--text-light);
    }

    .quick-contact {
      background: var(--primary-light);
      padding: 15px;
      border-radius: var(--radius);
      margin-bottom: 20px;
    }

    .quick-contact h4 {
      color: var(--primary);
      margin-bottom: 10px;
    }

    .analytics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 20px;
    }

    .analytics-item {
      background: var(--bg-light);
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }

    .analytics-item h5 {
      font-size: 0.9rem;
      color: var(--text-light);
    }

    .analytics-item p {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary);
    }

    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
      padding: 10px;
      border-radius: 8px;
      background: var(--bg-light);
    }

    .theme-toggle input {
      cursor: pointer;
    }

    /* MAIN */
    main {
      padding: 40px 0;
    }

    section {
      margin-bottom: 60px;
    }

    .section-title {
      font-size: 2.2rem;
      color: var(--primary);
      margin-bottom: 30px;
      text-align: center;
      position: relative;
      display: inline-block;
      left: 50%;
      transform: translateX(-50%);
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--primary);
    }

    /* CARDS */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 25px;
    }

    .card {
      background: var(--card-bg-light);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: var(--transition);
      border: 1px solid var(--border-light);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .card-header {
      background: var(--primary);
      color: white;
      padding: 15px 20px;
      font-weight: 600;
    }

    .card-body {
      padding: 20px;
    }

    .card-footer {
      padding: 15px 20px;
      background: var(--bg-light);
      border-top: 1px solid var(--border-light);
      font-size: 0.9rem;
      color: var(--text-light);
    }

    /* TEACHERS */
    .teacher-card .card-header {
      background: linear-gradient(135deg, #4299e1, #3182ce);
    }

    .teacher-info {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .teacher-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary-light);
    }

    .teacher-details h3 {
      color: var(--text-light);
      margin-bottom: 5px;
    }

    .teacher-details p {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .contact-teacher {
      margin-top: 10px;
    }

    .contact-teacher a {
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* EVENTS */
    .events-timeline {
      position: relative;
      max-width: 800px;
      margin: 0 auto;
    }

    .events-timeline::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 0;
      transform: translateX(-50%);
      width: 2px;
      height: 100%;
      background: var(--primary-light);
    }

    .timeline-item {
      position: relative;
      width: 100%;
      padding: 20px 0;
    }

    .timeline-item:nth-child(odd) {
      padding-left: calc(50% + 30px);
    }

    .timeline-item:nth-child(even) {
      padding-right: calc(50% + 30px);
      text-align: right;
    }

    .timeline-content {
      background: var(--card-bg-light);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: inline-block;
      max-width: 400px;
      border: 1px solid var(--border-light);
    }

    .timeline-date {
      position: absolute;
      width: 40px;
      height: 40px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-weight: 600;
      font-size: 0.8rem;
      top: 20px;
    }

    .timeline-item:nth-child(odd) .timeline-date {
      left: calc(50% - 20px);
    }

    .timeline-item:nth-child(even) .timeline-date {
      right: calc(50% - 20px);
    }

    /* NOTICE BOARD */
    .notices {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .notice {
      background: var(--card-bg-light);
      border-radius: var(--radius);
      padding: 20px;
      border-left: 5px solid var(--primary);
      box-shadow: var(--shadow);
      position: relative;
      border: 1px solid var(--border-light);
    }

    .notice.priority-high {
      border-left-color: #e53e3e;
    }

    .notice.priority-medium {
      border-left-color: #dd6b20;
    }

    .notice.priority-low {
      border-left-color: #38a169;
    }

    .notice-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .notice-badge.high {
      background: #fecaca;
      color: #9b2c2c;
    }

    .notice-badge.medium {
      background: #fed78c;
      color: #9c4221;
    }

    .notice-badge.low {
      background: #c6f6d5;
      color: #2f855a;
    }

    .notice-date {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 5px;
    }

    .notice-title {
      font-size: 1.2rem;
      margin-bottom: 10px;
      color: var(--text-light);
    }

    .notice-content {
      color: var(--text-light);
      line-height: 1.6;
    }

    /* TIMETABLE */
    .timetable {
      overflow-x: auto;
    }

    .timetable table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }

    .timetable th {
      background: var(--primary);
      color: white;
      padding: 12px;
      text-align: left;
    }

    .timetable td {
      padding: 12px;
      border-bottom: 1px solid var(--border-light);
      background: var(--card-bg-light);
    }

    .timetable tr:nth-child(even) td {
      background: var(--bg-light);
    }

    /* GALLERY */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }

    .gallery-item {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius);
      cursor: pointer;
      aspect-ratio: 1;
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: var(--transition);
    }

    .gallery-item:hover img {
      transform: scale(1.1);
    }

    /* LIGHTBOX */
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .lightbox.open {
      display: flex;
    }

    .lightbox-content {
      position: relative;
      max-width: 90%;
      max-height: 90%;
    }

    .lightbox-img {
      max-width: 100%;
      max-height: 80vh;
      border-radius: 8px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      font-size: 1.5rem;
    }

    .lightbox-prev {
      left: 20px;
    }

    .lightbox-next {
      right: 20px;
    }

    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.5);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      font-size: 1.2rem;
    }

    .lightbox-counter {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.5);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
    }

    /* FAQ */
    .faq-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .faq-item {
      margin-bottom: 15px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .faq-question {
      padding: 15px 20px;
      background: var(--card-bg-light);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .faq-question:hover {
      background: var(--primary-light);
    }

    .faq-question i {
      transition: var(--transition);
    }

    .faq-question[aria-expanded="true"] i {
      transform: rotate(180deg);
    }

    .faq-answer {
      padding: 0 20px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      background: var(--bg-light);
    }

    .faq-answer.open {
      max-height: 500px;
      padding: 20px;
    }

    /* CONTACT */
    .contact-form {
      max-width: 600px;
      margin: 0 auto;
      background: var(--card-bg-light);
      padding: 30px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border-light);
    }

    .form-group-contact {
      margin-bottom: 20px;
    }

    .form-group-contact label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-light);
    }

    .form-group-contact input,
    .form-group-contact textarea,
    .form-group-contact select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      background: var(--bg-light);
      color: var(--text-light);
      font-size: 1rem;
    }

    .form-group-contact textarea {
      min-height: 120px;
      resize: vertical;
    }

    .submit-btn {
      background: var(--primary);
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }

    .submit-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    /* HOMEWORK */
    .homework-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .homework-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .homework-filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-input {
      padding: 10px 15px;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      background: var(--bg-light);
      color: var(--text-light);
    }

    .homework-actions {
      display: flex;
      gap: 10px;
    }

    .homework-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .homework-item {
      background: var(--card-bg-light);
      border-radius: var(--radius);
      padding: 20px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow);
    }

    .homework-header-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .homework-date {
      font-size: 0.9rem;
      color: var(--primary);
      font-weight: 600;
    }

    .homework-class {
      background: var(--primary-light);
      color: var(--primary);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .homework-subject {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-light);
      margin-bottom: 10px;
    }

    .homework-teacher {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 15px;
    }

    .homework-instructions {
      line-height: 1.7;
      color: var(--text-light);
      margin-bottom: 15px;
    }

    .homework-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .tag {
      background: var(--primary-light);
      color: var(--primary);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .homework-actions-item {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .homework-actions-item a {
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* FEES */
    .fees-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    .fees-table th {
      background: var(--primary);
      color: white;
      padding: 15px;
      text-align: left;
    }

    .fees-table td {
      padding: 15px;
      border-bottom: 1px solid var(--border-light);
      background: var(--card-bg-light);
    }

    .fees-table tr:nth-child(even) td {
      background: var(--bg-light);
    }

    /* CLUBS */
    .clubs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 25px;
    }

    .club-card .card-header {
      background: linear-gradient(135deg, #48bb78, #38a169);
    }

    .club-card i {
      font-size: 3rem;
      margin-bottom: 15px;
      color: var(--primary);
    }

    .club-card h3 {
      color: var(--text-light);
      margin-bottom: 10px;
    }

    /* ACHIEVEMENTS */
    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
    }

    .achievement-item {
      text-align: center;
      padding: 20px;
      background: var(--card-bg-light);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border-light);
    }

    .achievement-icon {
      font-size: 2.5rem;
      color: var(--primary);
      margin-bottom: 15px;
    }

    .achievement-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--text-light);
    }

    .achievement-desc {
      font-size: 0.9rem;
      color: var(--text-light);
    }

    /* MODALS */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1500;
    }

    .modal.open {
      display: flex;
    }

    .modal-content {
      background: var(--card-bg-light);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      max-width: 800px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid var(--border-light);
    }

    .modal-header h3 {
      color: var(--primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-light);
    }

    .modal-body {
      padding: 20px;
    }

    .messages-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .message-item {
      background: var(--bg-light);
      padding: 15px;
      border-radius: var(--radius);
      border-left: 4px solid var(--primary);
    }

    .message-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 0.9rem;
      color: var(--text-light);
    }

    .message-content {
      line-height: 1.6;
      color: var(--text-light);
    }

    /* UTILITIES */
    .hidden {
      display: none !important;
    }

    .text-center {
      text-align: center;
    }

    .mt-20 {
      margin-top: 20px;
    }

    .mb-20 {
      margin-bottom: 20px;
    }

    .flex {
      display: flex;
    }

    .justify-between {
      justify-content: space-between;
    }

    .items-center {
      align-items: center;
    }

    .gap-10 {
      gap: 10px;
    }

    .print-only {
      display: none;
    }

    @media print {
      .print-only {
        display: block;
      }
      .no-print {
        display: none !important;
      }
      body {
        background: white !important;
        color: black !important;
      }
      .card, .notice, .homework-item {
        page-break-inside: avoid;
        border: 1px solid #ddd !important;
      }
      header, nav, .sidebar, .contact-actions, .dropdown-menu, .menu-btn, .theme-toggle {
        display: none !important;
      }
      .container {
        max-width: 100% !important;
        padding: 10px !important;
      }
      .section-title {
        left: 0 !important;
        transform: none !important;
      }
      .section-title::after {
        left: 0 !important;
      }
    }

    @media (max-width: 992px) {
      .nav-links {
        display: none;
      }
      .menu-btn {
        display: block;
      }
      .sidebar {
        left: -300px;
      }
      .sidebar.open {
        left: 0;
      }
      .hamburger {
        display: block;
        cursor: pointer;
      }
    }

    @media (max-width: 768px) {
      .header-container {
        flex-direction: column;
        text-align: center;
        align-items: center;
      }
      .contact-actions {
        justify-content: center;
      }
      .timeline-item {
        padding-left: 0 !important;
        padding-right: 0 !important;
        text-align: center;
      }
      .timeline-item::before {
        left: 50% !important;
        transform: translateX(-50%) !important;
      }
      .timeline-content {
        max-width: 100% !important;
      }
      .timeline-date {
        left: 50% !important;
        transform: translateX(-50%) !important;
        top: -25px;
      }
      .homework-header {
        flex-direction: column;
        align-items: stretch;
      }
      .homework-actions {
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      #access-gate h1 {
        font-size: 2.2rem;
      }
      .gate-form {
        padding: 20px;
      }
      .section-title {
        font-size: 1.8rem;
      }
      .analytics {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- ACCESS GATE -->
  <div id="access-gate">
    <div class="gate-form">
      <h1>Milli Karwaan Public School</h1>
      <p>Student Portal Access</p>
      <form id="gate-form">
        <div class="form-group">
          <label for="student-name">Student Name</label>
          <input type="text" id="student-name" placeholder="Enter your full name" required>
        </div>
        <div class="form-group">
          <label for="student-class">Class (1-12)</label>
          <select id="student-class" required>
            <option value="">Select Class</option>
            <option value="1">Class 1</option>
            <option value="2">Class 2</option>
            <option value="3">Class 3</option>
            <option value="4">Class 4</option>
            <option value="5">Class 5</option>
            <option value="6">Class 6</option>
            <option value="7">Class 7</option>
            <option value="8">Class 8</option>
            <option value="9">Class 9</option>
            <option value="10">Class 10</option>
            <option value="11">Class 11</option>
            <option value="12">Class 12</option>
          </select>
        </div>
        <div class="form-group">
          <label for="parent-name">Parent's Name</label>
          <input type="text" id="parent-name" placeholder="Enter parent's full name" required>
        </div>
        <button type="submit" class="btn btn-primary">Enter Portal</button>
      </form>
      <div id="gate-error" class="mt-20" style="color: #e53e3e; min-height: 20px;"></div>
    </div>
  </div>

  <!-- HEADER -->
  <header class="no-print">
    <div class="container header-container">
      <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="MKPS Logo" class="logo">
      <div class="school-info">
        <h1>Milli Karwaan Public School Balrampur</h1>
        <p>Boluha Police Chowki Balrampur (Balrampur, Uttar Pradesh)</p>
        <div class="tagline">ज्ञान, अनुशासन और समर्पण — भविष्य की राह</div>
        <div class="tagline-sub">“Gyaan, Anushaasan aur Samarpan — Bhavishya ki Raah”</div>
      </div>
      <div class="contact-actions">
        <a href="mailto:madamsir066@gmail.com" class="email-link">
          <i class="fas fa-envelope"></i> madamsir066@gmail.com
        </a>
        <a href="tel:9758919151" class="call-btn">
          <i class="fas fa-phone"></i> CALL
        </a>
      </div>
    </div>
  </header>

  <!-- NAVIGATION -->
  <nav class="no-print">
    <div class="container nav-container">
      <ul class="nav-links">
        <li><a href="#home" class="active">Home</a></li>
        <li><a href="#homework">Homework</a></li>
        <li><a href="#teachers">Teachers</a></li>
        <li><a href="#events">Events</a></li>
      </ul>
      <button class="menu-btn" id="menu-btn">⋮</button>
    </div>
  </nav>

  <!-- DROPDOWN MENU -->
  <div class="dropdown-menu" id="dropdown-menu">
    <a href="#notice-board" class="dropdown-item"><i class="fas fa-bullhorn"></i> Notice Board</a>
    <a href="#timetable" class="dropdown-item"><i class="fas fa-calendar-alt"></i> Timetable</a>
    <a href="#fees" class="dropdown-item"><i class="fas fa-rupee-sign"></i> Fees</a>
    <a href="#achievements" class="dropdown-item"><i class="fas fa-trophy"></i> Achievements</a>
    <a href="#clubs" class="dropdown-item"><i class="fas fa-cubes"></i> Clubs & Labs</a>
    <a href="#gallery" class="dropdown-item"><i class="fas fa-images"></i> Gallery</a>
    <a href="#faq" class="dropdown-item"><i class="fas fa-question-circle"></i> FAQ</a>
    <a href="#contact" class="dropdown-item"><i class="fas fa-envelope"></i> Contact</a>
    <a href="admin.html" class="dropdown-item"><i class="fas fa-user-shield"></i> Admin Login</a>
    <a href="#" class="dropdown-item" id="export-data"><i class="fas fa-file-export"></i> Export Data</a>
    <a href="#" class="dropdown-item" id="import-data"><i class="fas fa-file-import"></i> Import Data</a>
    <a href="#" class="dropdown-item" id="download-snapshot"><i class="fas fa-download"></i> Download Snapshot</a>
    <a href="#" class="dropdown-item" id="view-messages"><i class="fas fa-comments"></i> View Messages</a>
    <a href="#" class="dropdown-item" id="reset-demo"><i class="fas fa-redo"></i> Reset Demo</a>
  </div>

  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h3>Quick Access</h3>
      <button class="sidebar-close" id="sidebar-close">×</button>
    </div>
    <div class="quick-search">
      <input type="text" id="quick-search" placeholder="Search homework...">
    </div>
    <div class="quick-contact">
      <h4>Contact Us</h4>
      <p><i class="fas fa-phone"></i> 9758919151</p>
      <p><i class="fas fa-envelope"></i> madamsir066@gmail.com</p>
    </div>
    <div class="analytics">
      <div class="analytics-item">
        <h5>Students</h5>
        <p id="student-count">0</p>
      </div>
      <div class="analytics-item">
        <h5>Teachers</h5>
        <p id="teacher-count">0</p>
      </div>
      <div class="analytics-item">
        <h5>Notices</h5>
        <p id="notice-count">0</p>
      </div>
      <div class="analytics-item">
        <h5>Gallery</h5>
        <p id="gallery-count">0</p>
      </div>
    </div>
    <div class="theme-toggle">
      <input type="checkbox" id="theme-toggle">
      <label for="theme-toggle">Dark Mode</label>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <main id="main-content">
    <div class="container">
      <section id="home">
        <h2 class="section-title">Welcome to Milli Karwaan Public School</h2>
        <div class="cards-grid">
          <div class="card">
            <div class="card-header">Student Information</div>
            <div class="card-body">
              <p><strong>Name:</strong> <span id="student-name-display">Not Set</span></p>
              <p><strong>Class:</strong> <span id="student-class-display">Not Set</span></p>
              <p><strong>Parent:</strong> <span id="parent-name-display">Not Set</span></p>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Today's Focus</div>
            <div class="card-body">
              <p id="today-focus">Loading...</p>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Quick Links</div>
            <div class="card-body">
              <p><a href="#homework"><i class="fas fa-book"></i> Homework</a></p>
              <p><a href="#timetable"><i class="fas fa-calendar-alt"></i> Timetable</a></p>
              <p><a href="#notice-board"><i class="fas fa-bullhorn"></i> Notices</a></p>
            </div>
          </div>
        </div>
      </section>

      <section id="homework">
        <h2 class="section-title">Homework & Assignments</h2>
        <div class="homework-container">
          <div class="homework-header">
            <div class="homework-filters">
              <input type="text" id="search-homework" class="filter-input" placeholder="Search...">
              <select id="filter-tag" class="filter-input">
                <option value="">All Tags</option>
                <option value="urgent">Urgent</option>
                <option value="project">Project</option>
                <option value="quiz">Quiz</option>
                <option value="vfx">VFX</option>
                <option value="3d">3D</option>
                <option value="animation">Animation</option>
              </select>
            </div>
            <div class="homework-actions">
              <button class="btn btn-sm" id="print-homework"><i class="fas fa-print"></i> Print</button>
              <button class="btn btn-sm" id="download-homework"><i class="fas fa-download"></i> Download</button>
            </div>
          </div>
          <div class="homework-list" id="homework-list">
            <!-- Homework items will be inserted here -->
          </div>
        </div>
      </section>

      <section id="teachers">
        <h2 class="section-title">Our Teachers</h2>
        <div class="cards-grid" id="teachers-list">
          <!-- Teachers will be inserted here -->
        </div>
      </section>

      <section id="events">
        <h2 class="section-title">Upcoming Events</h2>
        <div class="events-timeline" id="events-list">
          <!-- Events will be inserted here -->
        </div>
      </section>

      <section id="notice-board">
        <h2 class="section-title">Notice Board</h2>
        <div class="notices" id="notices-list">
          <!-- Notices will be inserted here -->
        </div>
      </section>

      <section id="timetable">
        <h2 class="section-title">Class Timetable</h2>
        <div class="timetable">
          <table id="timetable-data">
            <thead>
              <tr>
                <th>Time</th>
                <th>Monday</th>
                <th>Tuesday</th>
                <th>Wednesday</th>
                <th>Thursday</th>
                <th>Friday</th>
                <th>Saturday</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>9:00-10:00</td>
                <td>Mathematics</td>
                <td>Science</td>
                <td>English</td>
                <td>Hindi</td>
                <td>Social Studies</td>
                <td>Computer Science</td>
              </tr>
              <tr>
                <td>10:00-11:00</td>
                <td>Science</td>
                <td>Mathematics</td>
                <td>Hindi</td>
                <td>English</td>
                <td>Computer Science</td>
                <td>Arts & Craft</td>
              </tr>
              <tr>
                <td>11:00-12:00</td>
                <td>English</td>
                <td>Hindi</td>
                <td>Mathematics</td>
                <td>Science</td>
                <td>Physical Education</td>
                <td>Robotics Club</td>
              </tr>
              <tr>
                <td>1:00-2:00</td>
                <td>Computer Science</td>
                <td>Social Studies</td>
                <td>Science</td>
                <td>Mathematics</td>
                <td>2D Animation</td>
                <td>Coding Club</td>
              </tr>
              <tr>
                <td>2:00-3:00</td>
                <td>Physical Education</td>
                <td>Arts & Craft</td>
                <td>Computer Science</td>
                <td>3D Animation</td>
                <td>VFX</td>
                <td>Motion Graphics</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="fees">
        <h2 class="section-title">Fee Structure</h2>
        <table class="fees-table">
          <thead>
            <tr>
              <th>Class</th>
              <th>Annual Fee</th>
              <th>Payment Due</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Class 1–5</td>
              <td>₹6,000/year</td>
              <td>1st April</td>
            </tr>
            <tr>
              <td>Class 6–8</td>
              <td>₹8,000/year</td>
              <td>1st April</td>
            </tr>
            <tr>
              <td>Class 9–10</td>
              <td>₹10,000/year</td>
              <td>1st April</td>
            </tr>
            <tr>
              <td>Class 11–12</td>
              <td>₹12,000/year</td>
              <td>1st April</td>
            </tr>
          </tbody>
        </table>
      </section>

      <section id="achievements">
        <h2 class="section-title">Student Achievements</h2>
        <div class="achievements-grid">
          <div class="achievement-item">
            <div class="achievement-icon"><i class="fas fa-medal"></i></div>
            <div class="achievement-title">State Science Olympiad</div>
            <div class="achievement-desc">2 students won gold medals in 2023</div>
          </div>
          <div class="achievement-item">
            <div class="achievement-icon"><i class="fas fa-trophy"></i></div>
            <div class="achievement-title">National Robotics</div>
            <div class="achievement-desc">School team ranked 5th nationally</div>
          </div>
          <div class="achievement-item">
            <div class="achievement-icon"><i class="fas fa-film"></i></div>
            <div class="achievement-title">Animation Festival</div>
            <div class="achievement-desc">3D animation won best student film</div>
          </div>
          <div class="achievement-item">
            <div class="achievement-icon"><i class="fas fa-award"></i></div>
            <div class="achievement-title">Literary Competition</div>
            <div class="achievement-desc">Best essay writer in Hindi category</div>
          </div>
        </div>
      </section>

      <section id="clubs">
        <h2 class="section-title">Clubs & Special Labs</h2>
        <div class="clubs-grid">
          <div class="card club-card">
            <div class="card-header">2D Animation</div>
            <div class="card-body">
              <i class="fas fa-paint-brush"></i>
              <h3>2D Animation Lab</h3>
              <p>Students learn traditional and digital 2D animation techniques using industry-standard software.</p>
            </div>
          </div>
          <div class="card club-card">
            <div class="card-header">3D Animation</div>
            <div class="card-body">
              <i class="fas fa-cube"></i>
              <h3>3D Animation Studio</h3>
              <p>Advanced 3D modeling, texturing, rigging and animation using Blender and Maya.</p>
            </div>
          </div>
          <div class="card club-card">
            <div class="card-header">VFX</div>
            <div class="card-body">
              <i class="fas fa-magic"></i>
              <h3>Visual Effects Lab</h3>
              <p>Green screen, compositing, particle effects and motion tracking using industry tools.</p>
            </div>
          </div>
          <div class="card club-card">
            <div class="card-header">Game Art</div>
            <div class="card-body">
              <i class="fas fa-gamepad"></i>
              <h3>Game Development</h3>
              <p>Students design characters, environments and create simple games using Unity.</p>
            </div>
          </div>
        </div>
      </section>

      <section id="gallery">
        <h2 class="section-title">Photo Gallery</h2>
        <div class="gallery-grid" id="gallery-items">
          <!-- Gallery items will be inserted here -->
        </div>
      </section>

      <section id="faq">
        <h2 class="section-title">Frequently Asked Questions</h2>
        <div class="faq-container">
          <div class="faq-item">
            <div class="faq-question" aria-expanded="false">
              What are the school timings?
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
              <p>School timings are from 9:00 AM to 3:00 PM, Monday to Saturday. Pre-primary section has separate timings from 9:00 AM to 12:30 PM.</p>
            </div>
          </div>
          <div class="faq-item">
            <div class="faq-question" aria-expanded="false">
              What curriculum does the school follow?
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
              <p>We follow the CBSE curriculum from Class 1 to 12, with additional focus on digital arts, animation and technology education.</p>
            </div>
          </div>
          <div class="faq-item">
            <div class="faq-question" aria-expanded="false">
              Does the school provide transportation?
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
              <p>Yes, we provide transportation facilities covering major areas of Balrampur and nearby regions. Buses are GPS-enabled and monitored.</p>
            </div>
          </div>
          <div class="faq-item">
            <div class="faq-question" aria-expanded="false">
              What extracurricular activities are offered?
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
              <p>We offer a wide range of activities including 2D/3D animation, VFX, robotics, coding, music, dance, sports, and various clubs.</p>
            </div>
          </div>
          <div class="faq-item">
            <div class="faq-question" aria-expanded="false">
              How can parents stay updated about their child's progress?
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
              <p>Parents can access the student portal, receive regular progress reports, attend parent-teacher meetings, and communicate through our messaging system.</p>
            </div>
          </div>
        </div>
      </section>

      <section id="contact">
        <h2 class="section-title">Contact Us</h2>
        <div class="contact-form">
          <form id="contact-form">
            <div class="form-group-contact">
              <label for="contact-name">Your Name</label>
              <input type="text" id="contact-name" required>
            </div>
            <div class="form-group-contact">
              <label for="contact-email">Email Address</label>
              <input type="email" id="contact-email" required>
            </div>
            <div class="form-group-contact">
              <label for="contact-phone">Phone Number</label>
              <input type="tel" id="contact-phone">
            </div>
            <div class="form-group-contact">
              <label for="contact-relation">Relation to Student</label>
              <select id="contact-relation" required>
                <option value="">Select</option>
                <option value="parent">Parent</option>
                <option value="guardian">Guardian</option>
                <option value="student">Student</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group-contact">
              <label for="contact-message">Message</label>
              <textarea id="contact-message" required></textarea>
            </div>
            <button type="submit" class="submit-btn">Send Message</button>
          </form>
        </div>
      </section>
    </div>
  </main>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox">
    <div class="lightbox-content">
      <img src="" alt="" class="lightbox-img" id="lightbox-img">
      <div class="lightbox-nav lightbox-prev" id="lightbox-prev"><i class="fas fa-chevron-left"></i></div>
      <div class="lightbox-nav lightbox-next" id="lightbox-next"><i class="fas fa-chevron-right"></i></div>
      <div class="lightbox-close" id="lightbox-close">×</div>
      <div class="lightbox-counter" id="lightbox-counter">1 / 1</div>
    </div>
  </div>

  <!-- VIEW MESSAGES MODAL -->
  <div class="modal" id="messages-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Received Messages</h3>
        <button class="modal-close" id="close-messages">×</button>
      </div>
      <div class="modal-body">
        <div class="messages-list" id="messages-list">
          <!-- Messages will be inserted here -->
        </div>
      </div>
    </div>
  </div>

  <!-- PRINT SNAPSHOT -->
  <div class="print-only" id="print-snapshot">
    <h1>Milli Karwaan Public School</h1>
    <h2>Student Portal Snapshot</h2>
    <p><strong>Generated on:</strong> <span id="print-date"></span></p>
    <p><strong>Student:</strong> <span id="print-student"></span></p>
    <p><strong>Class:</strong> <span id="print-class"></span></p>
    
    <h3>Homework</h3>
    <div id="print-homework-content"></div>
    
    <h3>Notices</h3>
    <div id="print-notices-content"></div>
    
    <h3>Events</h3>
    <div id="print-events-content"></div>
  </div>

  <script>
    // Global variables
    let studentData = null;
    let homeworkData = {};
    let teachersData = [];
    let eventsData = [];
    let noticesData = [];
    let timetableData = {};
    let galleryData = [];
    let messagesData = [];
    let updateTimestamp = null;

    // DOM Elements
    const accessGate = document.getElementById('access-gate');
    const gateForm = document.getElementById('gate-form');
    const gateError = document.getElementById('gate-error');
    const mainContent = document.getElementById('main-content');
    const dropdownMenu = document.getElementById('dropdown-menu');
    const menuBtn = document.getElementById('menu-btn');
    const sidebar = document.getElementById('sidebar');
    const sidebarClose = document.getElementById('sidebar-close');
    const themeToggle = document.getElementById('theme-toggle');
    const quickSearch = document.getElementById('quick-search');
    const searchHomework = document.getElementById('search-homework');
    const filterTag = document.getElementById('filter-tag');
    const printHomeworkBtn = document.getElementById('print-homework');
    const downloadHomeworkBtn = document.getElementById('download-homework');
    const exportDataBtn = document.getElementById('export-data');
    const importDataBtn = document.getElementById('import-data');
    const downloadSnapshotBtn = document.getElementById('download-snapshot');
    const viewMessagesBtn = document.getElementById('view-messages');
    const resetDemoBtn = document.getElementById('reset-demo');
    const contactForm = document.getElementById('contact-form');
    const messagesModal = document.getElementById('messages-modal');
    const closeMessages = document.getElementById('close-messages');
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    const lightboxPrev = document.getElementById('lightbox-prev');
    const lightboxNext = document.getElementById('lightbox-next');
    const lightboxClose = document.getElementById('lightbox-close');
    const lightboxCounter = document.getElementById('lightbox-counter');

    // Student display elements
    const studentNameDisplay = document.getElementById('student-name-display');
    const studentClassDisplay = document.getElementById('student-class-display');
    const parentNameDisplay = document.getElementById('parent-name-display');
    const todayFocus = document.getElementById('today-focus');

    // Counters
    const studentCount = document.getElementById('student-count');
    const teacherCount = document.getElementById('teacher-count');
    const noticeCount = document.getElementById('notice-count');
    const galleryCount = document.getElementById('gallery-count');

    // Print snapshot elements
    const printDate = document.getElementById('print-date');
    const printStudent = document.getElementById('print-student');
    const printClass = document.getElementById('print-class');
    const printHomeworkContent = document.getElementById('print-homework-content');
    const printNoticesContent = document.getElementById('print-notices-content');
    const printEventsContent = document.getElementById('print-events-content');

    // Initialize app
    function init() {
      // Check for existing student data
      const storedStudent = localStorage.getItem('mkps_student');
      if (storedStudent) {
        try {
          studentData = JSON.parse(storedStudent);
          hideAccessGate();
          populateStudentInfo();
          loadAllData();
        } catch (e) {
          console.error('Failed to parse student data:', e);
          showAccessGate();
        }
      } else {
        showAccessGate();
      }

      // Check theme preference
      const savedTheme = localStorage.getItem('mkps_theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark');
        document.documentElement.setAttribute('data-theme', 'dark');
        themeToggle.checked = true;
      }

      // Set up event listeners
      setupEventListeners();
      
      // Block back button after gate submission
      if (studentData) {
        window.history.pushState(null, null, location.href);
        window.onpopstate = function() {
          window.history.pushState(null, null, location.href);
        };
      }
    }

    function showAccessGate() {
      accessGate.classList.remove('fade-out');
      mainContent.classList.add('hidden');
    }

    function hideAccessGate() {
      accessGate.classList.add('fade-out');
      mainContent.classList.remove('hidden');
      setTimeout(() => {
        accessGate.style.display = 'none';
      }, 500);
    }

    function setupEventListeners() {
      // Gate form submission
      gateForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('student-name').value.trim();
        const studentClass = document.getElementById('student-class').value;
        const parentName = document.getElementById('parent-name').value.trim();

        if (!name || !studentClass || !parentName) {
          gateError.textContent = 'Please fill all fields';
          return;
        }

        studentData = { name, class: studentClass, parent: parentName };
        
        try {
          localStorage.setItem('mkps_student', JSON.stringify(studentData));
          hideAccessGate();
          populateStudentInfo();
          loadAllData();
          
          // Block back button
          window.history.pushState(null, null, location.href);
          window.onpopstate = function() {
            window.history.pushState(null, null, location.href);
          };
        } catch (e) {
          gateError.textContent = 'Failed to save data. Please try again.';
        }
      });

      // Navigation menu
      menuBtn.addEventListener('click', () => {
        dropdownMenu.classList.toggle('show');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!menuBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
          dropdownMenu.classList.remove('show');
        }
      });

      // Sidebar
      document.getElementById('sidebar-open').addEventListener('click', () => {
        sidebar.classList.add('open');
      });

      sidebarClose.addEventListener('click', () => {
        sidebar.classList.remove('open');
      });

      // Theme toggle
      themeToggle.addEventListener('change', () => {
        if (themeToggle.checked) {
          document.body.classList.add('dark');
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('mkps_theme', 'dark');
        } else {
          document.body.classList.remove('dark');
          document.documentElement.removeAttribute('data-theme');
          localStorage.setItem('mkps_theme', 'light');
        }
      });

      // Quick search
      quickSearch.addEventListener('input', function() {
        const query = this.value.toLowerCase();
        const homeworkItems = document.querySelectorAll('.homework-item');
        
        homeworkItems.forEach(item => {
          const text = item.textContent.toLowerCase();
          item.style.display = text.includes(query) ? 'block' : 'none';
        });
      });

      // Homework search and filtering
      searchHomework.addEventListener('input', renderHomework);
      filterTag.addEventListener('change', renderHomework);

      // Homework actions
      printHomeworkBtn.addEventListener('click', printHomework);
      downloadHomeworkBtn.addEventListener('click', downloadHomework);

      // Utility buttons
      exportDataBtn.addEventListener('click', exportMkpsData);
      importDataBtn.addEventListener('click', importMkpsData);
      downloadSnapshotBtn.addEventListener('click', downloadSnapshot);
      viewMessagesBtn.addEventListener('click', viewMessages);
      resetDemoBtn.addEventListener('click', resetMkpsDemo);

      // Contact form
      contactForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('contact-name').value;
        const email = document.getElementById('contact-email').value;
        const phone = document.getElementById('contact-phone').value;
        const relation = document.getElementById('contact-relation').value;
        const message = document.getElementById('contact-message').value;

        const msg = {
          id: Date.now(),
          name,
          email,
          phone,
          relation,
          message,
          timestamp: new Date().toISOString()
        };

        try {
          const stored = localStorage.getItem('mkps_messages');
          const messages = stored ? JSON.parse(stored) : [];
          messages.push(msg);
          localStorage.setItem('mkps_messages', JSON.stringify(messages));
          
          // Update global variable
          messagesData = messages;
          
          alert('Message sent successfully!');
          contactForm.reset();
        } catch (e) {
          alert('Failed to send message. Please try again.');
        }
      });

      // Lightbox
      lightboxClose.addEventListener('click', () => {
        lightbox.classList.remove('open');
      });

      lightboxPrev.addEventListener('click', showPrevImage);
      lightboxNext.addEventListener('click', showNextImage);

      // Close lightbox on click outside image
      lightbox.addEventListener('click', (e) => {
        if (e.target === lightbox) {
          lightbox.classList.remove('open');
        }
      });

      // Keyboard navigation for lightbox
      document.addEventListener('keydown', (e) => {
        if (lightbox.classList.contains('open')) {
          if (e.key === 'Escape') {
            lightbox.classList.remove('open');
          } else if (e.key === 'ArrowLeft') {
            showPrevImage();
          } else if (e.key === 'ArrowRight') {
            showNextImage();
          }
        }
      });

      // Storage event listener for admin updates
      window.addEventListener('storage', (e) => {
        if (e.key === 'mkps_update') {
          const newTimestamp = e.newValue;
          if (newTimestamp && newTimestamp !== updateTimestamp) {
            updateTimestamp = newTimestamp;
            loadAllData();
          }
        }
      });
    }

    function populateStudentInfo() {
      if (studentData) {
        studentNameDisplay.textContent = studentData.name;
        studentClassDisplay.textContent = `Class ${studentData.class}`;
        parentNameDisplay.textContent = studentData.parent;
        
        // Set today's focus
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const today = days[new Date().getDay()];
        todayFocus.textContent = `Today is ${today}. Check your homework and timetable.`;
      }
    }

    function loadAllData() {
      try {
        // Load homework
        const hw = localStorage.getItem('mkps_homework');
        homeworkData = hw ? JSON.parse(hw) : generateDefaultHomework();
        if (!localStorage.getItem('mkps_homework')) {
          localStorage.setItem('mkps_homework', JSON.stringify(homeworkData));
        }
        renderHomework();

        // Load teachers
        const tch = localStorage.getItem('mkps_teachers');
        teachersData = tch ? JSON.parse(tch) : generateDefaultTeachers();
        if (!localStorage.getItem('mkps_teachers')) {
          localStorage.setItem('mkps_teachers', JSON.stringify(teachersData));
        }
        renderTeachers();

        // Load events
        const evt = localStorage.getItem('mkps_events');
        eventsData = evt ? JSON.parse(evt) : generateDefaultEvents();
        if (!localStorage.getItem('mkps_events')) {
          localStorage.setItem('mkps_events', JSON.stringify(eventsData));
        }
        renderEvents();

        // Load notices
        const ntc = localStorage.getItem('mkps_notices');
        noticesData = ntc ? JSON.parse(ntc) : generateDefaultNotices();
        if (!localStorage.getItem('mkps_notices')) {
          localStorage.setItem('mkps_notices', JSON.stringify(noticesData));
        }
        renderNotices();

        // Load timetable
        const tt = localStorage.getItem('mkps_timetable');
        timetableData = tt ? JSON.parse(tt) : generateDefaultTimetable();
        if (!localStorage.getItem('mkps_timetable')) {
          localStorage.setItem('mkps_timetable', JSON.stringify(timetableData));
        }
        // Timetable is static in HTML, but could be updated dynamically

        // Load gallery
        const gal = localStorage.getItem('mkps_gallery');
        galleryData = gal ? JSON.parse(gal) : generateDefaultGallery();
        if (!localStorage.getItem('mkps_gallery')) {
          localStorage.setItem('mkps_gallery', JSON.stringify(galleryData));
        }
        renderGallery();

        // Load messages
        const msg = localStorage.getItem('mkps_messages');
        messagesData = msg ? JSON.parse(msg) : [];
        // No need to render messages here, they're in a modal

        // Update analytics counters
        updateAnalytics();

      } catch (e) {
        console.error('Error loading data:', e);
        // If there's an error, reset to demo data
        resetMkpsDemo();
      }
    }

    function renderHomework() {
      const list = document.getElementById('homework-list');
      list.innerHTML = '';

      if (!studentData) return;

      const classHomework = homeworkData[studentData.class] || [];
      const searchTerm = searchHomework.value.toLowerCase();
      const tagFilter = filterTag.value;

      const filteredHomework = classHomework.filter(hw => {
        const matchesSearch = !searchTerm || 
          hw.subject.toLowerCase().includes(searchTerm) ||
          hw.instructions.toLowerCase().includes(searchTerm) ||
          hw.teacher.toLowerCase().includes(searchTerm);
        
        const matchesTag = !tagFilter || (hw.tags && hw.tags.includes(tagFilter));
        
        return matchesSearch && matchesTag;
      });

      if (filteredHomework.length === 0) {
        list.innerHTML = '<p class="text-center">No homework found for your class.</p>';
        return;
      }

      filteredHomework.forEach(hw => {
        const item = document.createElement('div');
        item.className = 'homework-item';
        
        const tagsHtml = hw.tags ? hw.tags.map(tag => 
          `<span class="tag">${tag}</span>`
        ).join('') : '';

        item.innerHTML = `
          <div class="homework-header-info">
            <span class="homework-date">${hw.date}</span>
            <span class="homework-class">Class ${studentData.class}</span>
          </div>
          <div class="homework-subject">${hw.subject}</div>
          <div class="homework-teacher">By ${hw.teacher}</div>
          <div class="homework-instructions">${hw.instructions}</div>
          <div class="homework-tags">${tagsHtml}</div>
          <div class="homework-actions-item">
            <a href="mailto:?subject=Homework%20Help&body=I%20need%20help%20with%20${encodeURIComponent(hw.subject)}%20homework"><i class="fas fa-envelope"></i> Email Teacher</a>
            <a href="#" class="print-link" data-content="${encodeURIComponent(hw.instructions)}"><i class="fas fa-print"></i> Print</a>
          </div>
        `;
        
        list.appendChild(item);
      });

      // Add print link event listeners
      document.querySelectorAll('.print-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const content = decodeURIComponent(e.target.closest('a').dataset.content);
          const printWindow = window.open('', '_blank');
          printWindow.document.write(`
            <html>
              <head>
                <title>Homework Print</title>
                <style>
                  body { font-family: Arial, sans-serif; padding: 20px; }
                  h1 { color: #e53e3e; }
                </style>
              </head>
              <body>
                <h1>Homework Assignment</h1>
                <p><strong>Instructions:</strong></p>
                <p>${content}</p>
                <p><strong>Generated on:</strong> ${new Date().toLocaleString()}</p>
              </body>
            </html>
          `);
          printWindow.document.close();
          printWindow.print();
        });
      });
    }

    function renderTeachers() {
      const list = document.getElementById('teachers-list');
      list.innerHTML = '';

      teachersData.forEach(teacher => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="card-header">Faculty Member</div>
          <div class="card-body">
            <div class="teacher-info">
              <img src="https://randomuser.me/api/portraits/men/41.jpg" alt="${teacher.name}" class="teacher-avatar">
              <div class="teacher-details">
                <h3>${teacher.name}</h3>
                <p>${teacher.subject}</p>
              </div>
            </div>
            <div class="contact-teacher">
              <a href="mailto:${teacher.email || 'info@mkps.edu.in'}"><i class="fas fa-envelope"></i> Email</a>
            </div>
          </div>
        `;
        list.appendChild(card);
      });

      teacherCount.textContent = teachersData.length;
    }

    function renderEvents() {
      const list = document.getElementById('events-list');
      list.innerHTML = '';

      // Sort events by date
      const sortedEvents = [...eventsData].sort((a, b) => new Date(a.date) - new Date(b.date));

      sortedEvents.forEach((event, index) => {
        const item = document.createElement('div');
        item.className = 'timeline-item';
        
        const date = new Date(event.date);
        const day = date.getDate();
        const month = date.toLocaleString('default', { month: 'short' });

        item.innerHTML = `
          <div class="timeline-date">
            ${day}<br>${month}
          </div>
          <div class="timeline-content">
            <h3>${event.title}</h3>
            <p>${event.description}</p>
            ${event.venue ? `<p><i class="fas fa-map-marker-alt"></i> ${event.venue}</p>` : ''}
          </div>
        `;
        
        list.appendChild(item);
      });

      // Add confetti for upcoming events
      const today = new Date();
      const upcoming = eventsData.filter(e => new Date(e.date) >= today);
      if (upcoming.length > 0) {
        // Add a subtle visual indicator
        const first = document.querySelector('.timeline-item');
        if (first) {
          first.style.borderLeft = '5px solid #e53e3e';
        }
      }
    }

    function renderNotices() {
      const list = document.getElementById('notices-list');
      list.innerHTML = '';

      // Sort by date, newest first
      const sortedNotices = [...noticesData].sort((a, b) => new Date(b.date) - new Date(a.date));

      sortedNotices.forEach(notice => {
        const item = document.createElement('div');
        item.className = `notice priority-${notice.priority}`;
        
        const badgeText = notice.priority === 'high' ? 'Urgent' : 
                         notice.priority === 'medium' ? 'Important' : 'Information';
        const badgeClass = notice.priority === 'high' ? 'high' : 
                          notice.priority === 'medium' ? 'medium' : 'low';

        const date = new Date(notice.date);
        const dateString = date.toLocaleDateString('en-IN');

        item.innerHTML = `
          <div class="notice-badge ${badgeClass}">${badgeText}</div>
          <div class="notice-date">${dateString}</div>
          <div class="notice-title">${notice.title}</div>
          <div class="notice-content">${notice.content}</div>
        `;
        
        list.appendChild(item);
      });

      noticeCount.textContent = noticesData.length;
    }

    function renderGallery() {
      const list = document.getElementById('gallery-items');
      list.innerHTML = '';

      galleryData.forEach((item, index) => {
        const galleryItem = document.createElement('div');
        galleryItem.className = 'gallery-item';
        galleryItem.innerHTML = `<img src="${item.url}" alt="${item.caption}" data-index="${index}">`;
        list.appendChild(galleryItem);
      });

      // Add lightbox event listeners
      document.querySelectorAll('.gallery-item img').forEach(img => {
        img.addEventListener('click', () => {
          openLightbox(parseInt(img.dataset.index));
        });
      });

      galleryCount.textContent = galleryData.length;
    }

    function openLightbox(index) {
      if (galleryData.length === 0) return;
      
      const item = galleryData[index];
      lightboxImg.src = item.url;
      lightboxImg.alt = item.caption;
      lightboxCounter.textContent = `${index + 1} / ${galleryData.length}`;
      lightbox.dataset.currentIndex = index;
      lightbox.classList.add('open');
    }

    function showPrevImage() {
      const currentIndex = parseInt(lightbox.dataset.currentIndex);
      const newIndex = currentIndex > 0 ? currentIndex - 1 : galleryData.length - 1;
      openLightbox(newIndex);
    }

    function showNextImage() {
      const currentIndex = parseInt(lightbox.dataset.currentIndex);
      const newIndex = currentIndex < galleryData.length - 1 ? currentIndex + 1 : 0;
      openLightbox(newIndex);
    }

    function printHomework() {
      window.print();
    }

    function downloadHomework() {
      const homeworkItems = document.querySelectorAll('.homework-item');
      if (homeworkItems.length === 0) {
        alert('No homework to download');
        return;
      }

      let content = '# Homework Assignments\n\n';
      content += `Student: ${studentData.name}\n`;
      content += `Class: ${studentData.class}\n`;
      content += `Date: ${new Date().toLocaleString()}\n\n`;

      homeworkItems.forEach(item => {
        const subject = item.querySelector('.homework-subject').textContent;
        const teacher = item.querySelector('.homework-teacher').textContent.replace('By ', '');
        const instructions = item.querySelector('.homework-instructions').textContent;
        const date = item.querySelector('.homework-date').textContent;
        
        content += `## ${subject}\n`;
        content += `- Date: ${date}\n`;
        content += `- Teacher: ${teacher}\n`;
        content += `- Instructions: ${instructions}\n\n`;
      });

      downloadFile(content, 'homework.txt', 'text/plain');
    }

    function exportMkpsData() {
      const data = {
        mkps_student: localStorage.getItem('mkps_student'),
        mkps_homework: localStorage.getItem('mkps_homework'),
        mkps_teachers: localStorage.getItem('mkps_teachers'),
        mkps_events: localStorage.getItem('mkps_events'),
        mkps_notices: localStorage.getItem('mkps_notices'),
        mkps_timetable: localStorage.getItem('mkps_timetable'),
        mkps_gallery: localStorage.getItem('mkps_gallery'),
        mkps_messages: localStorage.getItem('mkps_messages'),
        mkps_update: localStorage.getItem('mkps_update'),
        export_timestamp: new Date().toISOString()
      };

      const dataStr = JSON.stringify(data, null, 2);
      downloadFile(dataStr, 'mkps_backup.json', 'application/json');
    }

    function importMkpsData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = e => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
          try {
            const data = JSON.parse(event.target.result);
            
            // Validate required keys
            const requiredKeys = [
              'mkps_student', 'mkps_homework', 'mkps_teachers', 
              'mkps_events', 'mkps_notices', 'mkps_timetable',
              'mkps_gallery', 'mkps_messages', 'mkps_update'
            ];

            const missingKeys = requiredKeys.filter(key => !(key in data));
            if (missingKeys.length > 0) {
              alert(`Invalid data format. Missing keys: ${missingKeys.join(', ')}`);
              return;
            }

            // Import data
            Object.keys(data).forEach(key => {
              if (key.startsWith('mkps_')) {
                localStorage.setItem(key, data[key]);
              }
            });

            alert('Data imported successfully! Refreshing...');
            location.reload();

          } catch (e) {
            alert('Invalid JSON file. Please check the file and try again.');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function downloadSnapshot() {
      // Set print snapshot content
      printDate.textContent = new Date().toLocaleString();
      printStudent.textContent = studentData.name;
      printClass.textContent = studentData.class;

      // Homework
      const homeworkPrint = document.createElement('div');
      const homeworkItems = document.querySelectorAll('.homework-item');
      homeworkItems.forEach(item => {
        const clone = item.cloneNode(true);
        // Remove action buttons for print
        const actions = clone.querySelector('.homework-actions-item');
        if (actions) actions.remove();
        homeworkPrint.appendChild(clone);
      });
      printHomeworkContent.innerHTML = homeworkPrint.innerHTML;

      // Notices
      const noticesPrint = document.createElement('div');
      const noticeItems = document.querySelectorAll('.notice');
      noticeItems.forEach(item => {
        const clone = item.cloneNode(true);
        noticesPrint.appendChild(clone);
      });
      printNoticesContent.innerHTML = noticesPrint.innerHTML;

      // Events
      const eventsPrint = document.createElement('div');
      const eventItems = document.querySelectorAll('.timeline-item');
      eventItems.forEach(item => {
        const clone = item.cloneNode(true);
        eventsPrint.appendChild(clone);
      });
      printEventsContent.innerHTML = eventsPrint.innerHTML;

      // Print
      window.print();
    }

    function viewMessages() {
      const list = document.getElementById('messages-list');
      list.innerHTML = '';

      if (messagesData.length === 0) {
        list.innerHTML = '<p class="text-center">No messages received yet.</p>';
      } else {
        messagesData.slice().reverse().forEach(msg => {
          const date = new Date(msg.timestamp);
          const item = document.createElement('div');
          item.className = 'message-item';
          item.innerHTML = `
            <div class="message-meta">
              <span>${msg.name} (${msg.relation})</span>
              <span>${date.toLocaleString()}</span>
            </div>
            <div class="message-content">${msg.message}</div>
          `;
          list.appendChild(item);
        });
      }

      messagesModal.classList.add('open');
    }

    function resetMkpsDemo() {
      if (!confirm('This will reset all data to default demo values. Continue?')) {
        return;
      }

      // Clear all mkps_* data
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('mkps_')) {
          localStorage.removeItem(key);
        }
      }

      // Reset student data if it existed
      if (studentData) {
        localStorage.setItem('mkps_student', JSON.stringify(studentData));
      }

      // Regenerate all demo data
      homeworkData = generateDefaultHomework();
      localStorage.setItem('mkps_homework', JSON.stringify(homeworkData));

      teachersData = generateDefaultTeachers();
      localStorage.setItem('mkps_teachers', JSON.stringify(teachersData));

      eventsData = generateDefaultEvents();
      localStorage.setItem('mkps_events', JSON.stringify(eventsData));

      noticesData = generateDefaultNotices();
      localStorage.setItem('mkps_notices', JSON.stringify(noticesData));

      timetableData = generateDefaultTimetable();
      localStorage.setItem('mkps_timetable', JSON.stringify(timetableData));

      galleryData = generateDefaultGallery();
      localStorage.setItem('mkps_gallery', JSON.stringify(galleryData));

      messagesData = [];
      localStorage.setItem('mkps_messages', JSON.stringify(messagesData));

      // Set update timestamp
      updateTimestamp = new Date().toISOString();
      localStorage.setItem('mkps_update', updateTimestamp);

      // Reload data
      loadAllData();
      alert('Demo data has been reset!');
    }

    function updateAnalytics() {
      studentCount.textContent = studentData ? 1 : 0;
      teacherCount.textContent = teachersData.length;
      noticeCount.textContent = noticesData.length;
      galleryCount.textContent = galleryData.length;
    }

    function downloadFile(content, filename, contentType) {
      const blob = new Blob([content], { type: contentType });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Demo Data Generators
    function generateDefaultHomework() {
      const subjects = ['Mathematics', 'Science', 'English', 'Hindi', 'Social Studies', 'Computer Science', '2D Animation', '3D Animation', 'VFX', 'Motion Graphics'];
      const teachers = ['Arif Khan', 'Shruti Verma', 'Prakash Singh', 'Riya Thomas', 'Neeraj Gupta', 'Alka Sharma'];
      const tags = ['urgent', 'project', 'quiz', 'vfx', '3d', 'animation'];
      
      const hw = {};
      
      for (let classNum = 1; classNum <= 12; classNum++) {
        hw[classNum] = [];
        
        // Add 2-4 homework items per class
        const count = Math.floor(Math.random() * 3) + 2;
        for (let i = 0; i < count; i++) {
          const date = new Date();
          date.setDate(date.getDate() + Math.floor(Math.random() * 14)); // Within 2 weeks
          
          const subject = subjects[Math.floor(Math.random() * subjects.length)];
          const teacher = teachers[Math.floor(Math.random() * teachers.length)];
          const tagCount = Math.floor(Math.random() * 3);
          const selectedTags = [];
          
          for (let t = 0; t < tagCount; t++) {
            const tag = tags[Math.floor(Math.random() * tags.length)];
            if (!selectedTags.includes(tag)) {
              selectedTags.push(tag);
            }
          }
          
          hw[classNum].push({
            date: date.toLocaleDateString('en-IN'),
            subject,
            teacher,
            instructions: `Complete exercises ${Math.floor(Math.random() * 10) + 1}-${Math.floor(Math.random() * 5) + 5} in your textbook and submit by the due date.`,
            tags: selectedTags
          });
        }
      }
      
      // Add some special assignments for higher classes
      hw[9].push({
        date: new Date(Date.now() + 3*24*60*60*1000).toLocaleDateString('en-IN'),
        subject: 'Science',
        teacher: 'Shruti Verma',
        instructions: 'Prepare a detailed project on "Renewable Energy Sources" with diagrams and real-world examples. Minimum 10 pages.',
        tags: ['project', 'urgent']
      });
      
      hw[11].push({
        date: new Date(Date.now() + 5*24*60*60*1000).toLocaleDateString('en-IN'),
        subject: '3D Animation',
        teacher: 'Riya Thomas',
        instructions: 'Create a 3D model of a human face with proper topology and UV mapping. Submit in .blend format.',
        tags: ['project', '3d', 'animation']
      });
      
      return hw;
    }

    function generateDefaultTeachers() {
      return [
        { name: 'Arif Khan', subject: 'Mathematics', email: 'arif.khan@mkps.edu.in' },
        { name: 'Shruti Verma', subject: 'Science', email: 'shruti.verma@mkps.edu.in' },
        { name: 'Prakash Singh', subject: 'English', email: 'prakash.singh@mkps.edu.in' },
        { name: 'Riya Thomas', subject: 'Computer Science', email: 'riya.thomas@mkps.edu.in' },
        { name: 'Neeraj Gupta', subject: 'Social Studies', email: 'neeraj.gupta@mkps.edu.in' },
        { name: 'Alka Sharma', subject: 'Hindi', email: 'alka.sharma@mkps.edu.in' },
        { name: 'Amit Patel', subject: '2D Animation', email: 'amit.patel@mkps.edu.in' },
        { name: 'Sneha Reddy', subject: '3D Animation', email: 'sneha.reddy@mkps.edu.in' },
        { name: 'Vikram Joshi', subject: 'VFX', email: 'vikram.joshi@mkps.edu.in' },
        { name: 'Priya Nair', subject: 'Motion Graphics', email: 'priya.nair@mkps.edu.in' }
      ];
    }

    function generateDefaultEvents() {
      const today = new Date();
      const events = [];
      
      // Add events for the next 30 days
      for (let i = 0; i < 8; i++) {
        const eventDate = new Date(today);
        eventDate.setDate(today.getDate() + Math.floor(Math.random() * 30));
        
        const eventTypes = [
          { title: 'Parent-Teacher Meeting', desc: 'Quarterly meeting with class teachers and parents.' },
          { title: 'Science Exhibition', desc: 'Annual science fair showcasing student projects.' },
          { title: 'Sports Day', desc: 'Inter-class sports competition with various events.' },
          { title: 'Cultural Festival', desc: 'Celebration of cultural diversity with performances.' },
          { title: 'Math Olympiad', desc: 'Mathematics competition for students of classes 6-12.' },
          { title: 'Animation Workshop', desc: 'Special workshop on 3D animation techniques.' },
          { title: 'Robotics Challenge', desc: 'Students showcase their robotics projects.' },
          { title: 'Annual Day Celebration', desc: 'Grand celebration of the school year with performances.' },
          { title: 'VFX Demo Session', desc: 'Demonstration of visual effects techniques by senior students.' },
          { title: 'Career Guidance Seminar', desc: 'Session with industry professionals on career options.' }
        ];
        
        const eventType = eventTypes[Math.floor(Math.random() * eventTypes.length)];
        
        events.push({
          date: eventDate.toISOString().split('T')[0],
          title: eventType.title,
          description: eventType.desc,
          venue: ['Main Hall', 'Sports Ground', 'Auditorium', 'Science Lab', 'Computer Lab'][Math.floor(Math.random() * 5)]
        });
      }
      
      // Sort by date
      return events.sort((a, b) => new Date(a.date) - new Date(b.date));
    }

    function generateDefaultNotices() {
      return [
        {
          date: new Date(Date.now() - 2*24*60*60*1000).toISOString().split('T')[0],
          title: 'Summer Vacation Schedule',
          content: 'Summer vacation will commence from June 15th and resume on July 10th. All students are expected to complete their summer projects.',
          priority: 'medium'
        },
        {
          date: new Date().toISOString().split('T')[0],
          title: 'New Animation Lab Opening',
          content: 'We are excited to announce the opening of our new state-of-the-art 3D Animation and VFX lab. Students of classes 9-12 will have scheduled sessions starting next week.',
          priority: 'high'
        },
        {
          date: new Date(Date.now() + 3*24*60*60*1000).toISOString().split('T')[0],
          title: 'Parent-Teacher Meeting',
          content: 'The quarterly parent-teacher meeting is scheduled for this Saturday at 10:00 AM in the main hall. All parents are requested to attend.',
          priority: 'medium'
        },
        {
          date: new Date(Date.now() + 7*24*60*60*1000).toISOString().split('T')[0],
          title: 'Science Exhibition',
          content: 'The annual science exhibition will be held on the last Friday of this month. Students are encouraged to prepare innovative projects.',
          priority: 'medium'
        },
        {
          date: new Date(Date.now() + 14*24*60*60*1000).toISOString().split('T')[0],
          title: 'Fee Payment Reminder',
          content: 'The second installment of school fees is due on the 1st of next month. Please ensure timely payment to avoid late fees.',
          priority: 'low'
        }
      ];
    }

    function generateDefaultTimetable() {
      // Timetable is already in HTML, but we can store it for API consistency
      return {
        classes: ['1-5', '6-8', '9-10', '11-12'],
        schedule: {
          '9:00-10:00': ['Mathematics', 'Science', 'English', 'Hindi', 'Social Studies', 'Computer Science'],
          '10:00-11:00': ['Science', 'Mathematics', 'Hindi', 'English', 'Computer Science', 'Arts & Craft'],
          '11:00-12:00': ['English', 'Hindi', 'Mathematics', 'Science', 'Physical Education', 'Robotics Club'],
          '1:00-2:00': ['Computer Science', 'Social Studies', 'Science', 'Mathematics', '2D Animation', 'Coding Club'],
          '2:00-3:00': ['Physical Education', 'Arts & Craft', 'Computer Science', '3D Animation', 'VFX', 'Motion Graphics']
        }
      };
    }

    function generateDefaultGallery() {
      const subjects = ['2D Animation', '3D Animation', 'VFX', 'Motion Graphics', 'Robotics', 'Science Project', 'Cultural Event', 'Sports Day'];
      const images = [];
      
      for (let i = 0; i < 12; i++) {
        const subject = subjects[Math.floor(Math.random() * subjects.length)];
        const isAnimation = ['2D Animation', '3D Animation', 'VFX', 'Motion Graphics'].includes(subject);
        
        images.push({
          url: isAnimation 
            ? `https://source.unsplash.com/random/800x600/?${subject.toLowerCase().replace(' ', '+')}`
            : `https://source.unsplash.com/random/800x600/?school,${subject.toLowerCase().replace(' ', '+')}`,
          caption: `${subject} - ${isAnimation ? 'Student Project' : 'Event'}`
        });
      }
      
      return images;
    }

    // Global functions for admin.html
    window.renderHomeworkFor = function(cls) {
      if (studentData && studentData.class == cls) {
        renderHomework();
      }
    };

    window.refreshTeachers = function() {
      const tch = localStorage.getItem('mkps_teachers');
      teachersData = tch ? JSON.parse(tch) : generateDefaultTeachers();
      renderTeachers();
    };

    window.refreshEvents = function() {
      const evt = localStorage.getItem('mkps_events');
      eventsData = evt ? JSON.parse(evt) : generateDefaultEvents();
      renderEvents();
    };

    window.refreshNotices = function() {
      const ntc = localStorage.getItem('mkps_notices');
      noticesData = ntc ? JSON.parse(ntc) : generateDefaultNotices();
      renderNotices();
    };

    window.refreshTimetable = function() {
      const tt = localStorage.getItem('mkps_timetable');
      timetableData = tt ? JSON.parse(tt) : generateDefaultTimetable();
      // Timetable is static in HTML
    };

    window.refreshGallery = function() {
      const gal = localStorage.getItem('mkps_gallery');
      galleryData = gal ? JSON.parse(gal) : generateDefaultGallery();
      renderGallery();
    };

    window.refreshMessages = function() {
      const msg = localStorage.getItem('mkps_messages');
      messagesData = msg ? JSON.parse(msg) : [];
      // Messages are in modal
    };

    window.exportMkpsData = exportMkpsData;
    window.resetMkpsDemo = resetMkpsDemo;

    // Initialize the app
    document.addEventListener('DOMContentLoaded', init);

    // FAQ Accordion
    document.querySelectorAll('.faq-question').forEach(button => {
      button.addEventListener('click', () => {
        const expanded = button.getAttribute('aria-expanded') === 'true' || false;
        button.setAttribute('aria-expanded', !expanded);
        
        const answer = button.nextElementSibling;
        if (expanded) {
          answer.classList.remove('open');
        } else {
          answer.classList.add('open');
        }
      });
    });
  </script>
</body>
</html>
