<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Panel - Milli Karwaan Public School</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root{
    --brand:#004080;
    --brand-2:#2c5aa0;
    --accent:#f8c43e;
    --bg:#f4f7fb;
    --card:#ffffff;
    --muted:#6b7280;
    --success:#28a745;
    --danger:#dc3545;
    --glass: rgba(255,255,255,0.85);
    --radius:12px;
    --shadow: 0 8px 30px rgba(2,6,23,0.08);
    --trans: all .25s ease;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:Inter,Segoe UI,Helvetica,Arial; background:linear-gradient(180deg,#eef5ff,#f4f7fb); color:#111; min-height:100vh;}
  .wrap{max-width:1200px; margin:28px auto; padding:0 16px;}
  header{display:flex; align-items:center; gap:14px; margin-bottom:18px;}
  header img{height:64px; width:64px; object-fit:cover; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.08);}
  header h1{font-size:1.35rem; margin:0; color:var(--brand)}
  header p{margin:0; color:var(--muted); font-size:0.95rem}
  .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px}
  .grid{display:grid; grid-template-columns: 320px 1fr; gap:18px}
  @media(max-width:980px){ .grid{grid-template-columns:1fr} }

  /* login */
  .login-wrap{max-width:520px; margin:30px auto}
  .login-box{padding:22px; border-radius:12px}
  .field{margin-bottom:12px}
  label{display:block; font-weight:600; margin-bottom:6px; color:var(--brand)}
  input[type="text"], input[type="password"], select, textarea{width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e6eef9; font-size:1rem; background:#fcfeff}
  .btn{display:inline-block; background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#fff; padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700}
  .btn-ghost{background:transparent; border:1px solid #dbeafe; color:var(--brand); padding:9px 12px}

  /* sidebar nav */
  .sidebar .menu-item{padding:12px 14px; border-radius:10px; display:flex; gap:10px; align-items:center; cursor:pointer; color:var(--brand); margin-bottom:8px; font-weight:600}
  .sidebar .menu-item:hover{background:rgba(0,64,128,0.05)}
  .sidebar .small{font-size:0.9rem; color:var(--muted); margin-bottom:12px}

  /* main admin content */
  .admin-top{display:flex; justify-content:space-between; gap:12px; align-items:center; margin-bottom:14px}
  .section-title{font-size:1.05rem; font-weight:700; color:var(--brand); margin-bottom:8px}
  .tools{display:flex; gap:8px; align-items:center}
  .panel{margin-bottom:16px}

  /* lists */
  .list{list-style:none; padding:0; margin:0}
  .list li{display:flex; justify-content:space-between; gap:12px; align-items:center; padding:10px; border-radius:10px; border:1px solid #f0f5ff; background:linear-gradient(180deg,#fff,#fbfdff); margin-bottom:8px}
  .list li .meta{color:var(--muted); font-size:0.95rem}
  .actions{display:flex; gap:8px}

  /* form row */
  .row{display:flex; gap:10px}
  .row .col{flex:1}

  /* modal */
  .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.45); z-index:200}
  .modal .modal-card{width:100%; max-width:760px; padding:18px; border-radius:12px; background:var(--card)}
  .modal .modal-head{display:flex; justify-content:space-between; align-items:center; margin-bottom:12px}

  /* small helpers */
  .pill{display:inline-block; padding:6px 10px; border-radius:999px; background:#f3faff; color:var(--brand-2); font-weight:700}
  .muted{color:var(--muted)}
  .danger{color:var(--danger)}
  .success{color:var(--success)}

  /* responsive tweaks */
  @media(max-width:640px){
    header h1{font-size:1rem}
    .grid{gap:12px}
  }

  /* file input */
  .file-row{display:flex; gap:8px; align-items:center}
  .small-btn{padding:8px 10px; border-radius:8px; border:none; background:#f3f8ff; color:var(--brand); cursor:pointer}
  .inline-input{display:flex; gap:8px; align-items:center}
  pre {white-space:pre-wrap; word-wrap:break-word; font-family:monospace; font-size:0.9rem; background:#f7fbff; padding:12px; border-radius:8px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo">
      <div>
        <h1>Milli Karwaan Public School Balrampur â€” Admin</h1>
        <p class="muted">Manage Homework, Teachers, Events, Notices, Timetable, Gallery & Messages</p>
      </div>
    </header>

    <!-- LOGIN VIEW -->
    <div id="loginView" class="card login-wrap" style="display:block">
      <div class="login-box">
        <h2 style="margin-bottom:6px">Admin Login</h2>
        <p class="muted" style="margin-bottom:12px">Enter admin password to manage school content. (Password set by owner)</p>
        <div class="field">
          <label>Username</label>
          <input id="adminUser" type="text" placeholder="admin">
        </div>
        <div class="field">
          <label>Password</label>
          <input id="adminPass" type="password" placeholder="Enter password">
        </div>
        <div style="display:flex; gap:10px; margin-top:10px">
          <button class="btn" onclick="doLogin()">Login</button>
          <button class="btn-ghost" onclick="fillDemo()">Fill demo</button>
        </div>
        <p class="muted" style="margin-top:10px">Admin password is <strong>Abutalha</strong> (hardcoded for this demo). Use responsibly.</p>
      </div>
    </div>

    <!-- ADMIN DASHBOARD -->
    <div id="adminUI" style="display:none">
      <div class="grid">
        <!-- SIDEBAR -->
        <aside class="card sidebar">
          <div class="small">Quick Links</div>
          <div class="menu-item" onclick="showPanel('dashboard')"><i class="fa fa-tachometer-alt"></i> Dashboard</div>
          <div class="menu-item" onclick="showPanel('homework')"><i class="fa fa-book"></i> Homework</div>
          <div class="menu-item" onclick="showPanel('teachers')"><i class="fa fa-chalkboard-teacher"></i> Teachers</div>
          <div class="menu-item" onclick="showPanel('events')"><i class="fa fa-calendar-day"></i> Events</div>
          <div class="menu-item" onclick="showPanel('notices')"><i class="fa fa-bell"></i> Notices</div>
          <div class="menu-item" onclick="showPanel('timetable')"><i class="fa fa-table"></i> Timetable</div>
          <div class="menu-item" onclick="showPanel('gallery')"><i class="fa fa-image"></i> Gallery</div>
          <div class="menu-item" onclick="showPanel('messages')"><i class="fa fa-envelope"></i> Messages</div>
          <div class="menu-item" onclick="showPanel('settings')"><i class="fa fa-cogs"></i> Settings</div>
          <hr style="margin:12px 0;border:none;border-top:1px solid #f0f6ff">
          <div style="display:flex;gap:8px">
            <button class="small-btn" onclick="exportData()">Export JSON</button>
            <label class="small-btn" style="cursor:pointer">
              Import<input id="importFile" type="file" accept=".json" style="display:none" onchange="importData(event)">
            </label>
          </div>
          <div style="margin-top:12px">
            <button class="small-btn" onclick="logout()">Logout</button>
          </div>
        </aside>

        <!-- MAIN PANEL -->
        <main>
          <!-- DASHBOARD -->
          <section id="panel-dashboard" class="card panel" style="display:none">
            <div class="admin-top">
              <div>
                <div class="section-title">Dashboard</div>
                <div class="muted">Overview of current stored content</div>
              </div>
              <div class="tools">
                <div class="pill" id="countHomework">Homework: 0</div>
                <div class="pill" id="countTeachers">Teachers: 0</div>
                <div class="pill" id="countMessages">Messages: 0</div>
              </div>
            </div>

            <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px">
              <div class="card">
                <div style="font-weight:700; color:var(--brand)">Recent Homework (sample)</div>
                <div id="dashHomework" style="margin-top:10px"></div>
              </div>
              <div class="card">
                <div style="font-weight:700; color:var(--brand)">Recent Messages</div>
                <div id="dashMessages" style="margin-top:10px"></div>
              </div>
              <div class="card">
                <div style="font-weight:700; color:var(--brand)">Recent Teachers</div>
                <div id="dashTeachers" style="margin-top:10px"></div>
              </div>
            </div>
          </section>

          <!-- HOMEWORK MANAGEMENT -->
          <section id="panel-homework" class="card panel" style="display:none">
            <div class="section-title">Manage Homework</div>
            <div class="muted" style="margin-bottom:12px">Add, edit or delete homework items for specific classes. Changes are saved to localStorage and will appear on the public index.html.</div>

            <div style="display:flex; gap:12px; margin-bottom:12px; flex-wrap:wrap">
              <div style="min-width:160px">
                <label>Class</label>
                <select id="hwClass"></select>
              </div>
              <div style="flex:1">
                <label>Homework Text</label>
                <input id="hwText" type="text" placeholder="e.g. Maths: Solve exercise 5 (pg.42)">
              </div>
              <div style="min-width:120px; display:flex; align-items:end">
                <button class="btn" onclick="addHomework()">Add Homework</button>
              </div>
            </div>

            <div>
              <ul id="hwList" class="list"></ul>
            </div>
          </section>

          <!-- TEACHERS MANAGEMENT -->
          <section id="panel-teachers" class="card panel" style="display:none">
            <div class="section-title">Manage Teachers</div>
            <div class="muted" style="margin-bottom:12px">Add, update or remove teachers. Add photo URL if available.</div>

            <div class="panel card" style="margin-bottom:12px">
              <div class="row">
                <div class="col">
                  <label>Name</label>
                  <input id="tName" type="text" placeholder="e.g. Mr. Ali">
                </div>
                <div class="col">
                  <label>Subject</label>
                  <input id="tSubject" type="text" placeholder="e.g. Mathematics">
                </div>
              </div>
              <div class="row" style="margin-top:8px">
                <div class="col">
                  <label>Phone</label>
                  <input id="tPhone" type="text" placeholder="e.g. 9758919001">
                </div>
                <div class="col">
                  <label>Photo URL</label>
                  <input id="tPhoto" type="text" placeholder="Optional image URL">
                </div>
              </div>
              <div style="margin-top:12px">
                <button class="btn" onclick="addTeacher()">Add Teacher</button>
              </div>
            </div>

            <ul id="teacherList" class="list"></ul>
          </section>

          <!-- EVENTS MANAGEMENT -->
          <section id="panel-events" class="card panel" style="display:none">
            <div class="section-title">Manage Events</div>
            <div class="muted" style="margin-bottom:12px">Add upcoming events visible on index page.</div>

            <div class="panel card" style="margin-bottom:12px">
              <div class="row">
                <div class="col"><label>Title</label><input id="eTitle" type="text"></div>
                <div class="col"><label>Date</label><input id="eDate" type="date"></div>
              </div>
              <div style="margin-top:8px"><label>Description</label><textarea id="eDesc" rows="2"></textarea></div>
              <div style="margin-top:8px"><button class="btn" onclick="addEvent()">Add Event</button></div>
            </div>

            <ul id="eventList" class="list"></ul>
          </section>

          <!-- NOTICES MANAGEMENT -->
          <section id="panel-notices" class="card panel" style="display:none">
            <div class="section-title">Manage Notices</div>
            <div class="muted" style="margin-bottom:12px">Publish important notices for parents and students.</div>

            <div class="panel card" style="margin-bottom:12px">
              <div class="row">
                <div class="col"><label>Title</label><input id="nTitle" type="text"></div>
                <div class="col"><label>Priority</label>
                  <select id="nPriority">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                  </select>
                </div>
              </div>
              <div style="margin-top:8px"><label>Body</label><textarea id="nBody" rows="2"></textarea></div>
              <div style="margin-top:8px"><button class="btn" onclick="addNotice()">Add Notice</button></div>
            </div>

            <ul id="noticeList" class="list"></ul>
          </section>

          <!-- TIMETABLE MANAGEMENT -->
          <section id="panel-timetable" class="card panel" style="display:none">
            <div class="section-title">Timetable</div>
            <div class="muted" style="margin-bottom:12px">Edit the sample weekly timetable. Each day stores an array of slots.</div>

            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px">
              <select id="ttDay"></select>
              <input id="ttSlot" type="text" placeholder="e.g. Maths">
              <button class="btn" onclick="addTimetableSlot()">Add Slot</button>
              <button class="btn-ghost" onclick="clearTimetable()" style="border-color:#fde68a">Clear All</button>
            </div>

            <div id="ttArea"></div>
          </section>

          <!-- GALLERY MANAGEMENT -->
          <section id="panel-gallery" class="card panel" style="display:none">
            <div class="section-title">Gallery</div>
            <div class="muted" style="margin-bottom:12px">Manage gallery images (URLs). These will show on index.html gallery.</div>

            <div style="display:flex; gap:8px; margin-bottom:12px">
              <input id="gUrl" type="text" placeholder="Image URL (png/jpg)">
              <button class="btn" onclick="addGallery()">Add Image</button>
            </div>

            <ul id="galleryList" class="list"></ul>
          </section>

          <!-- MESSAGES -->
          <section id="panel-messages" class="card panel" style="display:none">
            <div class="section-title">Parent & Student Messages</div>
            <div class="muted" style="margin-bottom:12px">Messages saved from the contact form on index.html</div>

            <ul id="messageList" class="list"></ul>
          </section>

          <!-- SETTINGS -->
          <section id="panel-settings" class="card panel" style="display:none">
            <div class="section-title">Settings & Utilities</div>
            <div class="muted" style="margin-bottom:12px">Advanced operations: seed sample data, clear storage, and bulk import/export.</div>

            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <button class="btn" onclick="seedDemo()">Seed Demo Data</button>
              <button class="btn-ghost" onclick="clearAllData()">Clear All Data</button>
              <button class="btn" onclick="exportData()">Export Data (JSON)</button>
              <label class="small-btn" style="cursor:pointer">Import<input id="fileImport2" type="file" accept=".json" style="display:none" onchange="importData(event)"></label>
            </div>

            <div style="margin-top:12px">
              <div class="section-title" style="font-size:1rem">Raw localStorage (preview)</div>
              <pre id="rawPreview"></pre>
            </div>
          </section>

        </main>
      </div>
    </div>

    <!-- MODAL -->
    <div id="modal" class="modal" onclick="if(event.target===this) closeModal()">
      <div class="modal-card">
        <div class="modal-head">
          <div id="modalTitle" style="font-weight:700; color:var(--brand)"></div>
          <div><button class="small-btn" onclick="closeModal()">Close</button></div>
        </div>
        <div id="modalBody"></div>
      </div>
    </div>

  </div>

<script>
/* ========== LocalStorage Keys (must match index.html) ========== */
const KEY_HOMEWORK = 'mkps_homework';
const KEY_TEACHERS = 'mkps_teachers';
const KEY_EVENTS = 'mkps_events';
const KEY_NOTICES = 'mkps_notices';
const KEY_TIMETABLE = 'mkps_timetable';
const KEY_MESSAGES = 'mkps_messages';
const KEY_GALLERY = 'mkps_gallery';

/* ========== Admin password (hardcoded as requested) ========== */
const ADMIN_PASS = 'Abutalha';

/* ========== Helpers ========== */
function save(key, val){ localStorage.setItem(key, JSON.stringify(val)); updateCounts(); }
function load(key, fallback){ const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }
function uid(){ return Math.random().toString(36).slice(2,9) + Date.now().toString(36).slice(-4); }
function el(id){ return document.getElementById(id); }
function show(id){ el(id).style.display='block'; }
function hide(id){ el(id).style.display='none'; }

/* ========== Login Logic ========== */
function doLogin(){
  const u = el('adminUser').value.trim() || 'admin';
  const p = el('adminPass').value;
  if(p === ADMIN_PASS){
    // set session flag
    sessionStorage.setItem('mkps_admin_auth','true');
    initAdminUI();
    alert('Login successful â€” Welcome, ' + u);
  } else {
    alert('Incorrect password');
  }
}
function logout(){
  sessionStorage.removeItem('mkps_admin_auth');
  location.reload();
}
function checkAuth(){
  return sessionStorage.getItem('mkps_admin_auth') === 'true';
}

/* ========== Initialization ========== */
function initAdminUI(){
  hide('loginView');
  show('adminUI');
  showPanel('dashboard');
  populateClassSelects();
  renderAllLists();
  updateCounts();
  refreshRawPreview();
}

/* if already logged in from this tab */
if(checkAuth()){
  initAdminUI();
}

/* ========== Populate class selects in forms ========== */
function populateClassSelects(){
  const hwClass = el('hwClass'); hwClass.innerHTML='';
  const ttDay = el('ttDay'); ttDay.innerHTML='';
  for(let i=1;i<=12;i++){
    const opt = document.createElement('option'); opt.value = i; opt.textContent = 'Class ' + i;
    hwClass.appendChild(opt);
  }
  const days = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  days.forEach(d=>{ const o=document.createElement('option'); o.value=d; o.textContent=d; ttDay.appendChild(o); });
}

/* ========== Panels switching ========== */
function showPanel(name){
  const panels = ['dashboard','homework','teachers','events','notices','timetable','gallery','messages','settings'];
  panels.forEach(p => {
    const elp = document.getElementById('panel-' + p);
    if(elp) elp.style.display = (p === name) ? 'block' : 'none';
  });
  // refresh data when switching
  renderAllLists();
  if(name === 'settings') refreshRawPreview();
}

/* ========== Seed Demo Data (same seeds as index.html) ========== */
function seedDemo(){
  // homework per class
  const sampleHw = {};
  for(let i=1;i<=12;i++){
    sampleHw[i] = [
      `Maths: Practice chapter ${Math.min(i,10)} â€” 20 minutes`,
      `English: Read page ${10+i} and write 5 sentences`,
      `Science: Short notes on topic ${i <=6 ? 'Plants' : 'Energy'}`
    ];
  }
  save(KEY_HOMEWORK, sampleHw);

  // teachers
  const sampleTeachers = [
    {id:uid(), name:"Mr. Ali", subject:"Mathematics", phone:"97589190
