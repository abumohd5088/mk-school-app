<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Milli Karwaan Public School — Balrampur</title>
  <meta name="description" content="Milli Karwaan Public School Balrampur — student dashboard, homework, notices, timetable, gallery & more.">
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FontAwesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Animate.css -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@500;700&display=swap');
    :root{
      --accent1: #0f766e;
      --accent2: #065f46;
      --gold: #f59e0b;
      --muted: #6b7280;
    }
    *{font-family: 'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
    .montserrat{font-family:'Montserrat',sans-serif;}
    /* small helpers */
    .card-hover:hover{ transform: translateY(-10px); box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15); transition: all .35s ease; }
    .glass { background: rgba(255,255,255,0.85); backdrop-filter: blur(6px); }
    .kebab-panel { min-width: 240px; }
    .modal-bg { background: rgba(2,6,23,0.6); }
    .badge-primary { background: linear-gradient(90deg,var(--accent1),var(--accent2)); color: white; padding:6px 10px; border-radius:999px; font-weight:700; }
    /* timeline */
    .timeline::before{ content:''; position:absolute; left:24px; top:0; bottom:0; width:3px; background: linear-gradient(180deg,var(--accent1),var(--accent2)); }
    /* small responsive tweaks */
    @media (max-width:768px){
      .left-rail { display:none; }
      .mobile-rail { display:flex; gap:8px; }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased">

  <!-- HEADER -->
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center gap-3">
          <img id="siteLogo" src="https://i.postimg.cc/Zqm9DSvt/erasebg-transformed.png" alt="MKPS" class="w-14 h-14 rounded-lg object-contain shadow" />
          <div>
            <div class="montserrat text-xl font-bold">Milli Karwaan Public School</div>
            <div class="text-sm text-gray-500 flex items-center gap-2"><i class="fas fa-map-marker-alt text-indigo-500"></i> Near Police Chowki, Balrampur</div>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <div class="hidden md:flex items-center gap-3">
            <div id="userGreeting" class="text-sm text-gray-600">Please enter name & class</div>
          </div>

          <button id="kebabBtn" class="p-2 rounded-md hover:bg-gray-100" title="Quick actions"><i class="fas fa-ellipsis-v"></i></button>

          <button id="themeToggle" class="p-2 rounded-md hover:bg-gray-100" title="Toggle theme"><i class="fas fa-moon"></i></button>

          <button id="adminFabTop" class="ml-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2 rounded-lg shadow hover:shadow-lg flex items-center gap-2">
            <i class="fas fa-user-shield"></i><span class="hidden sm:inline">Admin</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Kebab Quick Panel (hidden until toggled) -->
  <div id="quickPanel" class="fixed right-6 top-20 z-50 hidden">
    <div class="kebab-panel bg-white rounded-lg shadow-lg p-4">
      <div class="flex items-center justify-between mb-3">
        <strong>Quick actions</strong>
        <button id="closeQuick" class="text-gray-500 hover:text-gray-800"><i class="fas fa-times"></i></button>
      </div>
      <div class="flex flex-col gap-2">
        <button id="qaAddNotice" class="py-2 px-3 rounded-md bg-indigo-50 text-indigo-700 text-left">+ Add Notice</button>
        <button id="qaAddHw" class="py-2 px-3 rounded-md bg-green-50 text-green-700 text-left">+ Add Homework</button>
        <button id="qaImport" class="py-2 px-3 rounded-md bg-gray-50 text-gray-700 text-left">Import JSON</button>
        <button id="qaExport" class="py-2 px-3 rounded-md bg-gray-50 text-gray-700 text-left">Export JSON</button>
        <button id="qaPrint" class="py-2 px-3 rounded-md bg-gray-50 text-gray-700 text-left">Print Page</button>
      </div>
    </div>
  </div>

  <!-- STUDENT MODAL (first-run) -->
  <div id="studentModal" class="fixed inset-0 modal-bg flex items-center justify-center z-40 p-4">
    <div class="bg-white rounded-3xl max-w-3xl w-full overflow-hidden shadow-2xl animate__animated animate__fadeInUp">
      <div class="grid grid-cols-1 md:grid-cols-2">
        <div class="p-8 bg-gradient-to-br from-indigo-600 to-purple-600 text-white">
          <div class="flex flex-col items-center">
            <div class="bg-white bg-opacity-10 p-4 rounded-full mb-4">
              <i class="fas fa-user-graduate text-3xl"></i>
            </div>
            <h2 class="text-2xl font-bold montserrat">Welcome to Milli Karwaan</h2>
            <p class="mt-3 text-indigo-100 text-center">Enter your name & class to open your personalised student dashboard.</p>
            <div class="mt-6 w-full">
              <div class="grid grid-cols-3 gap-3">
                <div class="bg-white bg-opacity-10 rounded-xl p-3 text-center">
                  <i class="fas fa-book-open text-xl mb-1"></i>
                  <div class="text-sm font-semibold">Homework</div>
                </div>
                <div class="bg-white bg-opacity-10 rounded-xl p-3 text-center">
                  <i class="fas fa-calendar-check text-xl mb-1"></i>
                  <div class="text-sm font-semibold">Timetable</div>
                </div>
                <div class="bg-white bg-opacity-10 rounded-xl p-3 text-center">
                  <i class="fas fa-images text-xl mb-1"></i>
                  <div class="text-sm font-semibold">Gallery</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="p-8 bg-white">
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Student Name</label>
            <div class="relative">
              <div class="absolute left-3 top-3 text-gray-400"><i class="fas fa-user"></i></div>
              <input id="studentName" type="text" class="w-full pl-10 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-100" placeholder="Enter full name">
            </div>
          </div>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Class</label>
            <div class="relative">
              <div class="absolute left-3 top-3 text-gray-400"><i class="fas fa-chalkboard"></i></div>
              <select id="studentClass" class="w-full pl-10 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-100">
                <option value="">Select your class</option>
                <option>Nursery</option><option>LKG</option><option>UKG</option>
                <option>Class 1</option><option>Class 2</option><option>Class 3</option>
                <option>Class 4</option><option>Class 5</option><option>Class 6</option>
                <option>Class 7</option><option>Class 8</option><option>Class 9</option>
                <option>Class 10</option><option>Class 11</option><option>Class 12</option>
              </select>
            </div>
          </div>

          <div class="grid grid-cols-1 gap-3">
            <button id="loginBtn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-3">
              <i class="fas fa-arrow-right"></i> Enter Dashboard
            </button>
            <button id="demoBtn" class="w-full border border-gray-200 py-3 rounded-xl">Demo (Class 6)</button>
            <div class="text-sm text-gray-500 text-center mt-2">Contact: <a href="tel:+919758919151" class="text-indigo-600">+91 97589 19151</a> • <a href="mailto:madamsir066@gmail.com" class="text-indigo-600">madamsir066@gmail.com</a></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN APP -->
  <main id="app" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <!-- LEFT RAIL (desktop) -->
      <aside class="left-rail col-span-1 bg-white rounded-xl p-4 shadow hidden lg:block">
        <div class="flex items-center justify-between mb-4">
          <div class="text-sm text-gray-500">Menu</div>
          <div class="text-sm"><span id="railClassBadge" class="badge-primary">—</span></div>
        </div>

        <nav class="flex flex-col gap-2" id="menuItems">
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover active" data-view="home"><i class="fas fa-house"></i> Dashboard</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="homework"><i class="fas fa-book"></i> Homework</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="timetable"><i class="fas fa-clock"></i> Timetable</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="notices"><i class="fas fa-bullhorn"></i> Notices</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="events"><i class="fas fa-calendar-alt"></i> Events</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="gallery"><i class="fas fa-image"></i> Gallery</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="videos"><i class="fas fa-video"></i> Videos</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="results"><i class="fas fa-file-alt"></i> Results</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="teachers"><i class="fas fa-chalkboard-teacher"></i> Teachers Desk</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="achievements"><i class="fas fa-trophy"></i> Achievements</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="attendance"><i class="fas fa-check-circle"></i> Attendance</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="fees"><i class="fas fa-money-bill"></i> Fees</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="downloads"><i class="fas fa-download"></i> Downloads</button>
          <button class="text-left menu-item p-3 rounded-lg flex items-center gap-3 card-hover" data-view="contact"><i class="fas fa-phone"></i> Contact</button>
        </nav>

        <div class="mt-4 flex gap-2">
          <button id="exportBtn" class="flex-1 py-2 px-3 bg-indigo-100 text-indigo-700 rounded-lg"><i class="fas fa-file-export"></i> Export</button>
          <button id="importBtn" class="flex-1 py-2 px-3 border rounded-lg"><i class="fas fa-file-import"></i> Import</button>
        </div>

        <div class="text-xs text-gray-400 mt-4">Owner tools: Export/Import modifies local JSON. Use admin to manage content.</div>
      </aside>

      <!-- MAIN CONTENT -->
      <section class="col-span-1 lg:col-span-3">
        <!-- Top small controls (mobile) -->
        <div class="flex items-center justify-between lg:hidden mb-4">
          <div class="flex items-center gap-3 mobile-rail">
            <button id="openMenuMobile" class="p-2 bg-white rounded-lg shadow"><i class="fas fa-bars"></i></button>
            <div class="text-sm text-gray-600" id="mobileClassSmall">Class: —</div>
          </div>
          <div class="flex items-center gap-2">
            <button id="searchOpenMobile" class="p-2 bg-white rounded-lg shadow"><i class="fas fa-search"></i></button>
            <button id="adminFabMobile" class="p-2 bg-indigo-600 text-white rounded-lg shadow"><i class="fas fa-user-shield"></i></button>
          </div>
        </div>

        <!-- Views container -->
        <div id="viewsWrap" class="space-y-6">
          <!-- DASHBOARD -->
          <div id="view-home" class="card bg-white rounded-xl p-6 shadow">
            <div class="flex items-start justify-between gap-4">
              <div>
                <h2 id="vwTitle" class="text-2xl font-bold montserrat">Dashboard</h2>
                <p id="vwSub" class="text-sm text-gray-500 mt-1">Personalised for <strong id="vwName">—</strong> • <span id="vwClass">—</span></p>
              </div>
              <div class="flex items-center gap-3">
                <div class="text-center">
                  <div id="statStudents" class="text-2xl font-extrabold">0</div>
                  <div class="text-xs text-gray-500">Students</div>
                </div>
                <div class="text-center">
                  <div id="statHW" class="text-2xl font-extrabold">0</div>
                  <div class="text-xs text-gray-500">HW</div>
                </div>
                <button id="refreshBtn" title="Refresh" class="p-2 bg-gray-50 rounded-lg"><i class="fas fa-sync"></i></button>
              </div>
            </div>

            <!-- news ticker + quick preview -->
            <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="col-span-2">
                <div class="ticker p-3 bg-gradient-to-r from-green-50 to-white rounded-lg border-l-4 border-green-400">
                  <div id="tickerInner" class="whitespace-nowrap overflow-hidden text-sm text-gray-700"></div>
                </div>

                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div class="card-hover p-4 rounded-xl bg-white shadow">
                    <h4 class="font-semibold">Latest Homework</h4>
                    <div id="homeworkPreview" class="mt-3 space-y-2 text-sm text-gray-700"></div>
                  </div>

                  <div class="card-hover p-4 rounded-xl bg-white shadow">
                    <h4 class="font-semibold">Announcements</h4>
                    <div id="annPreview" class="mt-3 space-y-2 text-sm text-gray-700"></div>
                  </div>
                </div>
              </div>

              <aside>
                <div class="p-4 rounded-xl bg-white shadow text-center">
                  <div class="text-sm text-gray-500">Attendance</div>
                  <div id="attendanceBox" class="text-2xl font-bold mt-2">—</div>
                  <div class="text-xs text-gray-400 mt-2">This month</div>
                </div>

                <div class="mt-4 p-4 rounded-xl bg-white shadow">
                  <h4 class="font-semibold">Quick Links</h4>
                  <div class="flex flex-col gap-2 mt-3">
                    <button class="py-2 px-3 text-left rounded-lg border hover:bg-gray-50" id="goHomework">Open Homework</button>
                    <button class="py-2 px-3 text-left rounded-lg border hover:bg-gray-50" id="goTimetable">Open Timetable</button>
                    <button class="py-2 px-3 text-left rounded-lg border hover:bg-gray-50" id="exportLocal">Export Data</button>
                  </div>
                </div>
              </aside>
            </div>
          </div>

          <!-- HOMEWORK VIEW -->
          <div id="view-homework" class="hidden card bg-white rounded-xl p-6 shadow">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-bold">Homework — <span id="hwClassLabel">—</span></h3>
              <div class="flex items-center gap-2">
                <button id="printHw" class="py-2 px-3 border rounded">Print</button>
                <button id="addHwBtn" class="py-2 px-3 bg-indigo-600 text-white rounded">Add</button>
              </div>
            </div>
            <div id="hwList" class="mt-4 space-y-3"></div>
          </div>

          <!-- TIMETABLE VIEW -->
          <div id="view-timetable" class="hidden card bg-white rounded-xl p-6 shadow">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-bold">Timetable — <span id="ttClassLabel">—</span></h3>
              <button id="printTimetableBtn" class="py-2 px-3 border rounded">Print</button>
            </div>
            <div id="ttTable" class="mt-4"></div>
          </div>

          <!-- NOTICES VIEW -->
          <div id="view-notices" class="hidden card bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold">Notices — <span id="ntClassLabel">—</span></h3>
            <div id="noticesList" class="mt-4 space-y-3"></div>
          </div>

          <!-- EVENTS VIEW -->
          <div id="view-events" class="hidden card bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold">Events</h3>
            <div id="eventsList" class="mt-4 space-y-3"></div>
          </div>

          <!-- GALLERY VIEW -->
          <div id="view-gallery" class="hidden card bg-white rounded-xl p-6 shadow">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-bold">Gallery</h3>
              <div class="flex items-center gap-2">
                <button id="addImageBtn" class="py-2 px-3 border rounded">Add Image</button>
                <button id="exportImages" class="py-2 px-3 border rounded">Export</button>
              </div>
            </div>
            <div id="galleryGrid" class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"></div>
          </div>

          <!-- VIDEOS VIEW -->
          <div id="view-videos" class="hidden card bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold">Videos</h3>
            <div id="videosGrid" class="mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>
          </div>

          <!-- RESULTS VIEW -->
          <div id="view-results" class="hidden card bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold">Results & Exam Schedule</h3>
            <div id="resultsPreview" class="mt-4 space-y-3"></div>
          </div>

          <!-- TEACHERS VIEW -->
          <div id="view-teachers" class="hidden card bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold">Teacher's Desk</h3>
            <div id="teachersDesk" class="mt-4 space-y-3"></div>
          </div>

          <!-- ACHIEVEMENTS VIEW -->
          <div id="view-achievements" class="hidden card bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold">Achievements</h3>
            <div id="achievementsList" class="mt-4 space-y-3"></div>
          </div>

          <!-- ATTENDANCE VIEW -->
          <div id="view-attendance" class="hidden card bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold">Attendance</h3>
            <div id="attendanceDetails" class="mt-4"></div>
          </div>

          <!-- FEES VIEW -->
          <div id="view-fees" class="hidden card bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold">Fees</h3>
            <div id="feesPreview" class="mt-4"></div>
            <div class="mt-4"><button id="payLink" class="py-2 px-4 bg-yellow-500 rounded">Pay (Demo)</button></div>
          </div>

          <!-- DOWNLOADS VIEW -->
          <div id="view-downloads" class="hidden card bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold">Downloads</h3>
            <div id="downloadsList" class="mt-4 space-y-3"></div>
          </div>

          <!-- CONTACT VIEW -->
          <div id="view-contact" class="hidden card bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold">Contact & Enquiry</h3>
            <form id="contactForm" class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
              <input id="cname" placeholder="Your name" class="p-3 border rounded" required/>
              <input id="cinfo" placeholder="Phone or email" class="p-3 border rounded" required/>
              <textarea id="cmsg" placeholder="Message" class="p-3 border rounded md:col-span-2"></textarea>
              <div class="md:col-span-2 flex gap-2">
                <button class="py-2 px-4 bg-indigo-600 text-white rounded">Send</button>
                <button type="button" id="viewEnquiries" class="py-2 px-4 border rounded">View local enquiries</button>
              </div>
            </form>

            <div class="mt-4 text-sm text-gray-500">
              Phone: <a href="tel:+919758919151" class="text-indigo-600">+91 97589 19151</a> • Email: <a href="mailto:madamsir066@gmail.com" class="text-indigo-600">madamsir066@gmail.com</a>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Floating chat bubble -->
  <div id="chatBubble" class="chat-bubble">
    <i class="fas fa-comment"></i>
  </div>

  <div id="chatContainer" class="chat-container">
    <div class="chat-header">
      <div class="flex items-center gap-3">
        <div class="bg-white rounded-full p-2"><i class="fas fa-headset text-indigo-600"></i></div>
        <div>
          <div class="font-semibold">School Help</div>
          <div class="text-xs">Chat with support (demo)</div>
        </div>
      </div>
      <button id="closeChat" class="text-white"><i class="fas fa-times"></i></button>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="message message-received p-2 rounded-xl mb-2"><div class="message-content">Hello! How can we help you today?</div></div>
    </div>
    <div class="chat-input">
      <input id="chatInput" placeholder="Type a message..." />
      <button id="chatSend"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <!-- MODAL (generic) -->
  <div id="modal" class="fixed inset-0 modal-bg hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl w-full max-w-2xl overflow-hidden shadow p-4" id="modalBox"></div>
  </div>

  <!-- FOOTER -->
  <footer class="mt-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-gradient-to-r from-gray-900 to-indigo-900 text-white rounded-t-xl">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <h4 class="font-bold montserrat">Milli Karwaan Public School</h4>
          <p class="text-sm mt-2">Near Police Chowki, Balrampur • Phone: +91 97589 19151</p>
        </div>
        <div>
          <h5 class="font-semibold">Quick links</h5>
          <ul class="mt-3 text-sm space-y-2">
            <li><a href="#" class="text-gray-200">Admissions</a></li>
            <li><a href="#" class="text-gray-200">Syllabus</a></li>
            <li><a href="#" class="text-gray-200">Fee Structure</a></li>
            <li><a href="#" class="text-gray-200">Contact</a></li>
          </ul>
        </div>
        <div>
          <h5 class="font-semibold">Connect</h5>
          <div class="flex items-center gap-3 mt-3">
            <a class="w-8 h-8 bg-indigo-700 rounded-full flex items-center justify-center" href="#"><i class="fab fa-facebook-f"></i></a>
            <a class="w-8 h-8 bg-indigo-700 rounded-full flex items-center justify-center" href="#"><i class="fab fa-youtube"></i></a>
            <a class="w-8 h-8 bg-indigo-700 rounded-full flex items-center justify-center" href="#"><i class="fab fa-instagram"></i></a>
          </div>
        </div>
      </div>

      <div class="mt-6 text-center text-gray-300 text-sm">© <span id="year"></span> Milli Karwaan Public School — All rights reserved.</div>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script>
  // -------------------------
  // Client-side single-file site logic
  // -------------------------
  (function(){
    const STORAGE_KEY = 'MKPS_FULL_DATA_v1';
    const SESSION_KEY = 'MKPS_SESSION';
    const logoUrl = 'https://i.postimg.cc/Zqm9DSvt/erasebg-transformed.png';

    // Default demo data (class-filtered)
    const DEFAULT = {
      studentsCount: 1024,
      homework: {
        'Class 6': [{id:'h1',subject:'Mathematics',title:'Algebra Exercise',due:'2025-11-25',notes:'Solve Q1-10 in exercise 5'}],
        'Class 1': [{id:'h2',subject:'English',title:'Alphabet Practice',due:'2025-11-26',notes:'A-F writing'}]
      },
      timetable: {
        'Class 6': [{day:'Mon',time:'8:00-9:00',subject:'Mathematics'},{day:'Tue',time:'9:00-10:00',subject:'Science'}],
        'Class 1': [{day:'Mon',time:'9:00-9:30',subject:'English'}]
      },
      announcements: {
        'Class 6': [{id:'n1',title:'Science Exhibition',date:'2025-12-10',body:'Bring project models.'}],
        'Class 1': [{id:'n2',title:'Drawing Competition',date:'2025-11-28',body:'Bring colours.'}]
      },
      events: [{id:'e1',title:'Annual Sports Day',date:'2025-12-06'},{id:'e2',title:'Diwali Holiday',date:'2025-10-31'}],
      gallery: [logoUrl,'https://placehold.co/600x400/667eea/ffffff?text=Event+1','https://placehold.co/600x400/ff6b35/ffffff?text=Sports'],
      videos: [{id:'v1',title:'Welcome to MKPS',url:'https://www.youtube.com/embed/dQw4w9WgXcQ'}],
      results: [{exam:'Mid-Term 2025',date:'2025-12-20',link:'#'}],
      teachers: [{name:'Mrs. Sharma',subject:'Mathematics',note:'Senior Maths Teacher'},{name:'Mr. Verma',subject:'Science',note:'Physics'}],
      achievements: [{id:'a1',title:'Science Olympiad - 2nd Position',date:'2025-09-15'}],
      attendance: {'Class 6':{present:28,total:30}, 'Class 1':{present:29,total:30}},
      fees: [{id:'f1',studentName:'Demo Student',class:'Class 6',amount:15000,status:'unpaid'}],
      downloads: [{id:'d1',title:'Math Notes - Chapter 5',url:'#'}]
    };

    // load/save helpers
    function loadData(){ try{ const raw=localStorage.getItem(STORAGE_KEY); return raw? JSON.parse(raw) : JSON.parse(JSON.stringify(DEFAULT)); } catch(e){ console.error(e); return JSON.parse(JSON.stringify(DEFAULT)); } }
    function saveData(d){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); }catch(e){console.error(e);} }

    let DATA = loadData();

    function loadSession(){ try{ const s = localStorage.getItem(SESSION_KEY); return s? JSON.parse(s) : null; }catch(e){return null;} }
    function saveSession(sess){ localStorage.setItem(SESSION_KEY, JSON.stringify(sess)); }
    function clearSession(){ localStorage.removeItem(SESSION_KEY); location.reload(); }

    let SESSION = loadSession();

    // query helpers
    const $ = q => document.querySelector(q);
    const $$ = q => Array.from(document.querySelectorAll(q));
    const uid = (p='id') => p + Math.random().toString(36).slice(2,8);
    document.getElementById('year').textContent = new Date().getFullYear();

    // initial UI wiring
    function initUI(){
      // fill logo
      $('#siteLogo').src = logoUrl;

      // modal buttons
      $('#loginBtn').addEventListener('click', onStart);
      $('#demoBtn').addEventListener('click', ()=>{
        $('#studentName').value='Demo Student';
        $('#studentClass').value='Class 6';
        onStart();
      });

      // kebab
      $('#kebabBtn').addEventListener('click', ()=> { $('#quickPanel').classList.toggle('hidden'); });
      $('#closeQuick').addEventListener('click', ()=> { $('#quickPanel').classList.add('hidden'); });
      $('#qaAddNotice').addEventListener('click', addNoticeQuick);
      $('#qaAddHw').addEventListener('click', addHwQuick);
      $('#qaImport').addEventListener('click', importAll);
      $('#qaExport').addEventListener('click', exportAll);
      $('#qaPrint').addEventListener('click', ()=> window.print());

      // admin floating
      $('#adminFabTop').addEventListener('click', adminPrompt);
      $('#adminFabMobile').addEventListener('click', adminPrompt);
      $('#adminBtn')?.addEventListener('click', adminPrompt); // optional if button exists

      // chat
      $('#chatBubble').addEventListener('click', ()=> { $('#chatContainer').classList.add('active'); });
      $('#closeChat').addEventListener('click', ()=> { $('#chatContainer').classList.remove('active'); });
      $('#chatSend').addEventListener('click', ()=> {
        const v = $('#chatInput').value.trim(); if(!v) return; appendChat(v,true); $('#chatInput').value=''; setTimeout(()=>appendChat('Thanks for your message. We will respond soon.',false),800);
      });

      // menu items
      $$('#menuItems .menu-item').forEach(btn=>{
        btn.addEventListener('click', ()=> {
          $$('#menuItems .menu-item').forEach(x=>x.classList.remove('active'));
          btn.classList.add('active');
          navigate(btn.dataset.view);
        });
      });

      // quick nav inside page
      $('#goHomework').addEventListener('click', ()=> navigate('homework'));
      $('#goTimetable').addEventListener('click', ()=> navigate('timetable'));
      $('#refreshBtn').addEventListener('click', ()=> { DATA = loadData(); renderAll(); alert('Refreshed'); });

      // forms
      $('#contactForm').addEventListener('submit', (e)=>{ e.preventDefault(); saveEnquiry(); });

      // exports/imports
      $('#exportBtn').addEventListener('click', exportAll);
      $('#importBtn').addEventListener('click', importAll);
      $('#exportLocal')?.addEventListener('click', exportAll);

      // print helpers
      $('#printHw')?.addEventListener('click', ()=> printElement('#hwList'));
      $('#printTimetableBtn')?.addEventListener('click', ()=> printElement('#ttTable'));

      // add/hw buttons
      $('#addHwBtn')?.addEventListener('click', ()=> addHwQuick());
      $('#addImageBtn')?.addEventListener('click', addImageQuick);
      $('#exportImages')?.addEventListener('click', ()=> alert('Export images (demo)'));

      // load session if exists
      if(SESSION && SESSION.name && SESSION.class){
        hideModal();
        applySession(SESSION);
      }
      renderAll();
    }

    // modal helpers
    function onStart(){
      const name = ($('#studentName').value||'').trim();
      const cls = ($('#studentClass').value||'').trim();
      if(!name || !cls){ alert('Please enter name and select class'); return; }
      const sess = { name, class: cls };
      saveSession(sess);
      applySession(sess);
      hideModal();
    }
    function hideModal(){ document.getElementById('studentModal').style.display = 'none'; }
    function showModal(){ document.getElementById('studentModal').style.display = 'flex'; }

    // apply session to UI
    function applySession(sess){
      SESSION = sess;
      saveSession(sess);
      $('#vwName').textContent = sess.name;
      $('#vwClass').textContent = sess.class;
      $('#railClassBadge').textContent = sess.class;
      $('#userGreeting').textContent = `Welcome, ${sess.name} (${sess.class})`;
      $('#mobileClassSmall').textContent = `Class: ${sess.class}`;
      navigate('home');
      renderAll();
    }

    // navigation
    const views = {
      home: '#view-home',
      homework: '#view-homework',
      timetable: '#view-timetable',
      notices: '#view-notices',
      events: '#view-events',
      gallery: '#view-gallery',
      videos: '#view-videos',
      results: '#view-results',
      teachers: '#view-teachers',
      achievements: '#view-achievements',
      attendance: '#view-attendance',
      fees: '#view-fees',
      downloads: '#view-downloads',
      contact: '#view-contact'
    };

    function navigate(view){
      Object.values(views).forEach(sel=>{
        const el = document.querySelector(sel);
        if(el) el.classList.add('hidden');
      });
      const sel = views[view];
      if(sel){ const el = document.querySelector(sel); if(el) el.classList.remove('hidden'); }
      // update labels
      $('#hwClassLabel').textContent = SESSION ? SESSION.class : '—';
      $('#ttClassLabel').textContent = SESSION ? SESSION.class : '—';
      $('#ntClassLabel').textContent = SESSION ? SESSION.class : '—';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // render all sections
    function renderAll(){
      if(!SESSION) return;
      const cls = SESSION.class;
      // counters
      $('#statStudents').textContent = DATA.studentsCount || 0;
      const hwCount = (DATA.homework[cls]||[]).length;
      $('#statHW').textContent = hwCount;

      renderTicker();
      renderHomeworkPreview(cls);
      renderAnnouncementsPreview(cls);
      renderEventsPreview();
      renderGallery();
      renderVideos();
      renderTeachers();
      renderAchievements();
      renderTimetable(cls);
      renderHomeworkList(cls);
      renderNoticesList(cls);
      renderAttendancePreview(cls);
      renderFees();
      renderDownloads();
    }

    /* ---------- Render helpers ---------- */

    function renderTicker(){
      const items = [];
      Object.keys(DATA.announcements||{}).forEach(c => (DATA.announcements[c]||[]).forEach(n=> items.push(`${n.title} (${c})`)));
      (DATA.events||[]).forEach(e => items.push(`${e.title} on ${e.date}`));
      const t = (items.length ? items.join(' • ') : 'Welcome to Milli Karwaan Public School') + ' • ';
      $('#tickerInner').textContent = t + t;
    }

    function renderHomeworkPreview(cls){
      const list = DATA.homework[cls] || [];
      const node = $('#homeworkPreview');
      if(!node) return;
      if(!list.length) node.innerHTML = '<div class="text-sm text-gray-500">No homework assigned.</div>';
      else node.innerHTML = list.slice(0,3).map(h => `<div class="p-2 rounded border">${h.subject} — <strong>${h.title}</strong><div class="text-xs text-gray-500">Due: ${h.due}</div></div>`).join('');
    }
    function renderHomeworkList(cls){
      const list = DATA.homework[cls] || [];
      const node = $('#hwList');
      if(!node) return;
      if(!list.length) node.innerHTML = '<div class="text-sm text-gray-500">No homework for this class.</div>';
      else node.innerHTML = list.map(h => `<div class="p-3 rounded-lg border flex justify-between items-start"><div><div class="font-semibold">${h.subject} — ${h.title}</div><div class="text-xs text-gray-500">${h.notes}</div></div><div class="text-xs text-gray-500">Due: ${h.due}</div></div>`).join('');
    }

    function renderAnnouncementsPreview(cls){
      const arr = DATA.announcements[cls] || [];
      const node = $('#annPreview'); if(!node) return;
      if(!arr.length) node.innerHTML = '<div class="text-sm text-gray-500">No announcements.</div>';
      else node.innerHTML = arr.slice(0,3).map(a => `<div class="p-2 rounded border"><strong>${a.title}</strong><div class="text-xs text-gray-500">${a.date}</div><div class="text-xs mt-1">${a.body}</div></div>`).join('');
    }
    function renderNoticesList(cls){
      const arr = DATA.announcements[cls] || [];
      const node = $('#noticesList'); if(!node) return;
      if(!arr.length) node.innerHTML = '<div class="text-sm text-gray-500">No notices for this class.</div>';
      else node.innerHTML = arr.map(a => `<div class="p-3 rounded-lg border"><div class="font-semibold">${a.title}</div><div class="text-xs text-gray-500">${a.date}</div><p class="mt-2">${a.body}</p></div>`).join('');
    }

    function renderEventsPreview(){ $('#eventsPreview').innerHTML = (DATA.events||[]).map(ev=>`<li>${ev.title} — ${ev.date}</li>`).join(''); }
    function renderEventsList(){ $('#eventsList').innerHTML = (DATA.events||[]).map(ev=>`<div class="p-3 rounded-lg border"><strong>${ev.title}</strong><div class="text-xs text-gray-500">${ev.date}</div></div>`).join(''); }

    function renderTimetable(cls){
      const arr = DATA.timetable[cls] || [];
      const node = $('#ttTable'); if(!node) return;
      if(!arr.length){ node.innerHTML = '<div class="text-sm text-gray-500">No timetable available.</div>'; return; }
      node.innerHTML = `<table class="w-full text-sm"><thead><tr><th class="text-left p-2">Day</th><th class="text-left p-2">Time</th><th class="text-left p-2">Subject</th></tr></thead><tbody>${arr.map(r=>`<tr><td class="p-2">${r.day}</td><td class="p-2">${r.time}</td><td class="p-2">${r.subject}</td></tr>`).join('')}</tbody></table>`;
    }

    function renderGallery(){
      const node = $('#galleryGrid'); if(!node) return;
      node.innerHTML = (DATA.gallery||[]).map(src=>`<div class="overflow-hidden rounded-lg"><img src="${src}" class="object-cover w-full h-36 rounded-lg cursor-pointer" /></div>`).join('');
      // attach click -> open modal
      $$('#galleryGrid img').forEach(img=>{
        img.addEventListener('click', ()=> openModal(`<img src="${img.src}" class="w-full" />`));
      });
    }

    function renderVideos(){
      const node = $('#videosGrid'); if(!node) return;
      node.innerHTML = (DATA.videos||[]).map(v=>`<div class="rounded-lg border p-3"><div class="font-semibold">${v.title}</div><div class="mt-3"><button class="py-2 px-3 bg-indigo-600 text-white rounded play-video" data-src="${v.url}">Play</button></div></div>`).join('');
      $$('.play-video').forEach(b => b.addEventListener('click', ()=> openModal(`<div style="position:relative;padding-top:56.25%"><iframe src="${b.dataset.src}" style="position:absolute;left:0;top:0;width:100%;height:100%;border:0" allowfullscreen></iframe></div>`)));
    }

    function renderResults(){ const node = $('#resultsPreview'); if(!node) return; node.innerHTML = (DATA.results||[]).map(r=>`<div class="p-3 border rounded"><strong>${r.exam}</strong><div class="text-xs text-gray-500">${r.date}</div><a href="${r.link}" class="text-indigo-600 text-sm">View</a></div>`).join(''); }
    function renderTeachers(){ const node = $('#teachersDesk'); if(!node) return; node.innerHTML = (DATA.teachers||[]).map(t=>`<div class="p-3 border rounded"><strong>${t.name}</strong><div class="text-xs text-gray-500">${t.subject}</div><div class="mt-1">${t.note}</div></div>`).join(''); }
    function renderAchievements(){ const node = $('#achievementsList'); if(!node) return; node.innerHTML = (DATA.achievements||[]).map(a=>`<div class="p-3 border rounded"><strong>${a.title}</strong><div class="text-xs text-gray-500">${a.date}</div></div>`).join(''); }

    function renderAttendancePreview(cls){
      const a = DATA.attendance[cls];
      const node = $('#attendanceBox'); if(!node) return;
      if(!a) node.innerHTML = '<div class="text-sm text-gray-500">No attendance data.</div>';
      else node.innerHTML = `<div class="text-2xl font-bold">${a.present}/${a.total}</div><div class="text-xs mt-1 text-gray-500">${Math.round((a.present/a.total)*100)}% present</div>`;
    }
    function renderAttendanceDetails(cls){
      const a = DATA.attendance[cls]; const node = $('#attendanceDetails'); if(!node) return;
      if(!a) node.innerHTML = '<div class="text-sm text-gray-500">No attendance records.</div>';
      else node.innerHTML = `<div class="p-3 border rounded"><div>Present: ${a.present}</div><div>Total: ${a.total}</div><div class="text-xs text-gray-500">Percentage: ${Math.round((a.present/a.total)*100)}%</div></div>`;
    }

    function renderFees(){ const node = $('#feesPreview'); if(!node) return; const f = (DATA.fees||[]).slice(0,5); if(!f.length) node.innerHTML = '<div class="text-sm text-gray-500">No fees data.</div>'; else node.innerHTML = f.map(fi=>`<div class="p-3 border rounded"><strong>${fi.studentName}</strong><div class="text-xs">${fi.class}</div><div class="mt-1">₹${fi.amount} — <span class="font-semibold">${fi.status}</span></div></div>`).join(''); }

    function renderDownloads(){ const node = $('#downloadsList'); if(!node) return; const d = DATA.downloads || []; if(!d.length) node.innerHTML = '<div class="text-sm text-gray-500">No downloads.</div>'; else node.innerHTML = d.map(dd=>`<div class="p-3 border rounded flex justify-between items-center"><div><strong>${dd.title}</strong></div><div><a class="text-indigo-600" href="${dd.url}">Download</a></div></div>`).join(''); }

    /* ---------- Search ---------- */
    function doSearch(q){
      const query = (q || '').toLowerCase();
      if(!query) return alert('Enter search term');
      const cls = SESSION.class;
      const results = [];
      (DATA.homework[cls] || []).forEach(h => { if((h.title + ' ' + h.subject + ' ' + h.notes).toLowerCase().includes(query)) results.push({type:'Homework',item:h}); });
      (DATA.announcements[cls] || []).forEach(a => { if((a.title + ' ' + a.body).toLowerCase().includes(query)) results.push({type:'Notice',item:a}); });
      if(!results.length) openModal('<div class="p-4">No results</div>');
      else openModal('<div class="p-4">'+ results.map(r=>`<div class="p-2 border rounded mb-2"><strong>${r.type}</strong><div>${r.item.title || r.item.title || r.item.subject}</div></div>`).join('') +'</div>');
    }

    /* ---------- Export / Import ---------- */
    function exportAll(){
      const blob = new Blob([JSON.stringify(DATA,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'mkps-data.json'; document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url); alert('Exported local data');
    }
    function importAll(){
      const input = document.createElement('input'); input.type = 'file'; input.accept='.json';
      input.onchange = ()=> {
        const f = input.files[0]; if(!f) return;
        const r = new FileReader();
        r.onload = ()=> {
          try{ const parsed = JSON.parse(r.result); DATA = parsed; saveData(DATA); renderAll(); alert('Imported data'); } catch(e){ alert('Invalid JSON'); }
        };
        r.readAsText(f);
      };
      input.click();
    }

    /* ---------- Quick add (kebab) ---------- */
    function addNoticeQuick(){
      const cls = prompt('Class (e.g. Class 6):'); if(!cls) return;
      const title = prompt('Title:'); if(!title) return;
      const date = prompt('Date (YYYY-MM-DD):', new Date().toISOString().slice(0,10));
      const body = prompt('Details:','');
      DATA.announcements[cls] = DATA.announcements[cls] || []; DATA.announcements[cls].unshift({id:uid('n'),title,date,body});
      saveData(DATA); renderAll(); alert('Notice added');
    }
    function addHwQuick(){
      const cls = prompt('Class (e.g. Class 6):'); if(!cls) return;
      const sub = prompt('Subject:','Mathematics'); const title = prompt('Title:','Exercise'); const due = prompt('Due (YYYY-MM-DD):','2025-12-01'); const notes = prompt('Notes:','');
      DATA.homework[cls] = DATA.homework[cls] || []; DATA.homework[cls].unshift({id:uid('h'),subject:sub,title,due,notes}); saveData(DATA); renderAll(); alert('Homework added');
    }
    function addImageQuick(){
      const url = prompt('Image URL:'); if(!url) return;
      DATA.gallery.unshift(url); saveData(DATA); renderGallery(); alert('Image added');
    }

    /* ---------- Contact / enquiries ---------- */
    function saveEnquiry(){
      const name = $('#cname').value.trim(); const info = $('#cinfo').value.trim(); const msg = $('#cmsg').value.trim();
      if(!name || !info){ alert('Please provide name and contact'); return; }
      const list = JSON.parse(localStorage.getItem('MKPS_ENQUIRIES')||'[]');
      list.unshift({id:uid('q'),name,info,msg,class: (SESSION?SESSION.class:'—'),at: new Date().toISOString()});
      localStorage.setItem('MKPS_ENQUIRIES', JSON.stringify(list));
      alert('Enquiry saved locally'); $('#contactForm').reset();
    }
    function showEnquiries(){
      const list = JSON.parse(localStorage.getItem('MKPS_ENQUIRIES')||'[]');
      if(!list.length) return alert('No enquiries');
      openModal('<div class="p-3">'+ list.map(q=>`<div class="p-2 border rounded mb-2"><strong>${q.name}</strong> (${q.class})<div class="text-xs text-gray-500">${q.info}</div><div class="mt-1">${q.msg}</div></div>`).join('') +'</div>');
    }

    $('#viewEnquiries').addEventListener('click', showEnquiries);

    /* ---------- Print / small helpers ---------- */
    function printElement(selector){
      const el = document.querySelector(selector); if(!el) return alert('Nothing to print');
      const w = window.open('','_blank'); w.document.write('<html><head><title>Print</title><style>body{font-family:Arial;padding:18px}</style></head><body>');
      w.document.write(el.outerHTML); w.document.write('</body></html>'); w.document.close(); w.print();
    }

    /* ---------- Modal ---------- */
    function openModal(html){
      $('#modalBox').innerHTML = html + '<div class="mt-4 text-right"><button class="py-2 px-3 border rounded closeModal">Close</button></div>';
      $('#modal').classList.remove('hidden');
    }
    function closeModal(){ $('#modal').classList.add('hidden'); $('#modalBox').innerHTML = ''; }
    document.addEventListener('click', (e)=> { if(e.target.matches('.closeModal')) closeModal(); if(e.target.id==='modal') closeModal(); });

    /* ---------- Chat ---------- */
    function appendChat(text,isUser){
      const box = $('#chatMessages');
      const wrapper = document.createElement('div');
      wrapper.className = 'message ' + (isUser ? 'message-right' : '');
      wrapper.innerHTML = `<div class="message-content ${isUser? 'message-sent':'message-received'}">${text}</div>`;
      box.appendChild(wrapper);
      box.scrollTop = box.scrollHeight;
    }

    /* ---------- Admin prompt & on-the-fly editor ---------- */
    function adminPrompt(){
      const pwd = prompt('Enter Admin password:'); if(!pwd) return;
      if(String(pwd) === 'Abutalha'){
        openAdminWindow();
      } else alert('Access Denied');
    }

    function openAdminWindow(){
      const adminHtml = generateAdminHtml();
      const blob = new Blob([adminHtml], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      window.open(url, '_blank');
    }

    function generateAdminHtml(){
      const rawData = JSON.stringify(DATA,null,2).replace(/</g,'&lt;');
      return `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MKPS Admin</title>
      <style>body{font-family:Arial;padding:18px;background:#021621;color:#cfeee3} textarea{width:100%;height:360px;background:#012a25;color:#cfeee3;border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.06)} button{padding:8px 10px;border-radius:8px;border:none;background:#0f766e;color:#fff;margin-right:6px}</style></head><body>
      <h2>MKPS — Local Admin</h2><p>Editing local data only. Changes save to localStorage key: ${STORAGE_KEY}</p>
      <div><textarea id="raw">${rawData}</textarea></div>
      <div style="margin-top:8px"><button id="save">Save</button><button id="export">Export JSON</button><button id="close">Close</button></div>
      <div style="margin-top:12px"><button id="addNotice">Add Notice</button> <button id="addHW">Add Homework</button> <button id="addEvent">Add Event</button></div>
      <script>
        const KEY='${STORAGE_KEY}';
        function load(){ try{ return JSON.parse(localStorage.getItem(KEY) || '{}'); }catch(e){return {}; } }
        function save(d){ localStorage.setItem(KEY, JSON.stringify(d)); }
        document.getElementById('save').addEventListener('click', ()=> {
          try{ const parsed = JSON.parse(document.getElementById('raw').value); save(parsed); alert('Saved'); } catch(e){ alert('Invalid JSON'); }
        });
        document.getElementById('export').addEventListener('click', ()=> {
          const a = document.createElement('a'); const blob = new Blob([document.getElementById('raw').value], {type:'application/json'}); a.href = URL.createObjectURL(blob); a.download='mkps-admin-data.json'; document.body.appendChild(a); a.click(); a.remove();
        });
        document.getElementById('close').addEventListener('click', ()=> window.close());
        document.getElementById('addNotice').addEventListener('click', ()=> {
          const cls = prompt('Class (e.g. Class 6):'); if(!cls) return; const title = prompt('Title:'); const date = prompt('Date:', new Date().toISOString().slice(0,10)); const body = prompt('Details:','');
          const d = load(); d.announcements = d.announcements || {}; d.announcements[cls] = d.announcements[cls] || []; d.announcements[cls].unshift({id:'n'+Math.random().toString(36).slice(2,8),title,date,body}); document.getElementById('raw').value = JSON.stringify(d,null,2);
        });
        document.getElementById('addHW').addEventListener('click', ()=> {
          const cls = prompt('Class (e.g. Class 6):'); if(!cls) return; const sub = prompt('Subject:','Math'); const title = prompt('Title:','Exercise'); const due = prompt('Due:'); const notes = prompt('Notes:','');
          const d = load(); d.homework = d.homework || {}; d.homework[cls] = d.homework[cls] || []; d.homework[cls].unshift({id:'h'+Math.random().toString(36).slice(2,8),subject:sub,title,due,notes}); document.getElementById('raw').value = JSON.stringify(d,null,2);
        });
        document.getElementById('addEvent').addEventListener('click', ()=> {
          const title = prompt('Event title:'); const date = prompt('Date:'); const d = load(); d.events = d.events || []; d.events.unshift({id:'e'+Math.random().toString(36).slice(2,8),title,date}); document.getElementById('raw').value = JSON.stringify(d,null,2);
        });
      </script>
      </body></html>`;
    }

    /* ---------- Utilities ---------- */
    function esc(s){ if(s==null) return ''; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    // initial
    initUI();

    // watch storage changes
    window.addEventListener('storage', (e)=> { if(e.key === STORAGE_KEY) { DATA = loadData(); renderAll(); } });

    // load session if exists
    if(SESSION && SESSION.name && SESSION.class){
      applySession(SESSION);
      hideModal();
    }

    // Expose small helpers for debugging
    window.MKPS = { DATA, saveData, exportAll, importAll };

  })();
  </script>
</body>
</html>
