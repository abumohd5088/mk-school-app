<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Milli Karwaan Public School Balrampur</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --primary: #1e40af;
      --primary-light: #3b82f6;
      --primary-dark: #1e3a8a;
      --secondary: #d97706;
      --accent: #ec4899;
      --bg-light: #f8fafc;
      --bg-dark: #0f172a;
      --card-light: rgba(255, 255, 255, 0.15);
      --card-dark: rgba(15, 23, 42, 0.7);
      --text-light: #e2e8f0;
      --text-dark: #cbd5e1;
      --border-light: rgba(255, 255, 255, 0.2);
      --border-dark: rgba(30, 41, 59, 0.5);
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      --radius: 16px;
      --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    [data-theme="light"] {
      --primary: #2563eb;
      --primary-light: #3b82f6;
      --primary-dark: #1d4ed8;
      --secondary: #ea580c;
      --accent: #db2777;
      --bg-light: #ffffff;
      --bg-dark: #f1f5f9;
      --card-light: rgba(255, 255, 255, 0.8);
      --card-dark: rgba(241, 245, 249, 0.8);
      --text-light: #1e293b;
      --text-dark: #334155;
      --border-light: rgba(203, 213, 225, 0.5);
      --border-dark: rgba(203, 213, 225, 0.3);
      --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: var(--transition);
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(125deg, transparent 60%, rgba(59, 130, 246, 0.05) 80%, rgba(236, 72, 153, 0.1) 100%);
      pointer-events: none;
      z-index: -2;
      transition: var(--transition);
    }

    .glow {
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.2) 0%, transparent 70%);
      opacity: 0;
      pointer-events: none;
      z-index: -1;
      filter: blur(40px);
      transition: opacity 0.5s ease;
    }

    .gate, .portal {
      display: none;
    }

    .active {
      display: block !important;
    }

    .gate {
      position: fixed;
      inset: 0;
      background: linear-gradient(to right, #0f172a, #1e293b);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .gate-form {
      background: var(--card-dark);
      backdrop-filter: blur(16px);
      border: 1px solid var(--border-dark);
      border-radius: var(--radius);
      padding: 2.5rem;
      width: 90%;
      max-width: 500px;
      box-shadow: var(--shadow);
      transform: translateY(20px);
      opacity: 0;
      animation: slideUp 0.8s ease forwards;
    }

    @keyframes slideUp {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .gate h2 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      color: white;
      text-align: center;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 1.2rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-dark);
      font-weight: 500;
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 0.8rem 1rem;
      border: 1px solid var(--border-dark);
      background: rgba(0, 0, 0, 0.2);
      color: white;
      border-radius: 8px;
      font-size: 1rem;
      transition: var(--transition);
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }

    .btn-submit {
      background: linear-gradient(to right, var(--primary), var(--primary-light));
      color: white;
      border: none;
      padding: 0.8rem 2rem;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 20px rgba(59, 130, 246, 0.5);
    }

    .portal {
      display: flex;
      min-height: 100vh;
    }

    header {
      background: var(--card-dark);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border-dark);
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .school-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .school-logo {
      height: 60px;
      border-radius: 8px;
    }

    .school-details h1 {
      font-size: 1.4rem;
      color: white;
      font-weight: 700;
      font-family: 'Playfair Display', serif;
    }

    .school-details p {
      font-size: 0.85rem;
      color: var(--text-dark);
    }

    .call-btn {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }

    .call-btn:hover {
      background: #c2410c;
      transform: scale(1.05);
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    nav a {
      color: var(--text-dark);
      text-decoration: none;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      font-size: 0.95rem;
      transition: var(--transition);
      white-space: nowrap;
    }

    nav a:hover, nav a.active {
      background: var(--primary);
      color: white;
    }

    .menu-toggle {
      background: none;
      border: none;
      color: var(--text-dark);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
    }

    .sidebar {
      width: 280px;
      background: var(--card-dark);
      backdrop-filter: blur(12px);
      border-right: 1px solid var(--border-dark);
      padding: 1.5rem;
      height: calc(100vh - 80px);
      position: sticky;
      top: 80px;
      overflow-y: auto;
    }

    .section {
      padding: 2rem;
      flex: 1;
      min-width: 0;
    }

    .section h2 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      color: white;
      position: relative;
      padding-bottom: 0.5rem;
    }

    .section h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 50px;
      height: 3px;
      background: var(--accent);
      border-radius: 2px;
    }

    .card {
      background: var(--card-dark);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border-dark);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
      transition: var(--transition);
      transform: translateY(0);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
      transform: rotate(45deg);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.8s;
    }

    .card:hover::before {
      opacity: 1;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }

    .card h3 {
      color: white;
      margin-bottom: 0.8rem;
      font-size: 1.3rem;
    }

    .card p {
      color: var(--text-dark);
      line-height: 1.6;
    }

    .homework-list {
      display: grid;
      gap: 1rem;
    }

    .hw-item {
      background: rgba(0, 0, 0, 0.2);
      border-left: 4px solid var(--primary);
      padding: 1rem;
      border-radius: 8px;
      transition: var(--transition);
    }

    .hw-item:hover {
      background: rgba(0, 0, 0, 0.3);
      transform: translateX(5px);
    }

    .hw-subject {
      font-weight: 600;
      color: white;
    }

    .hw-meta {
      font-size: 0.85rem;
      color: var(--text-dark);
      margin: 0.3rem 0;
    }

    .btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: var(--transition);
      margin-right: 0.5rem;
      margin-top: 0.5rem;
      display: inline-block;
    }

    .btn:hover {
      background: var(--primary-light);
      transform: scale(1.05);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary-light);
      color: var(--primary-light);
    }

    .btn-outline:hover {
      background: rgba(59, 130, 246, 0.1);
    }

    .search-bar {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid var(--border-dark);
      background: rgba(0, 0, 0, 0.2);
      color: white;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .search-bar::placeholder {
      color: var(--text-dark);
    }

    .teacher-grid, .gallery-grid, .event-timeline {
      display: grid;
      gap: 1rem;
    }

    .teacher-card, .gallery-item {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius);
      cursor: pointer;
    }

    .teacher-card img, .gallery-item img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      transition: var(--transition);
    }

    .teacher-card:hover img, .gallery-item:hover img {
      transform: scale(1.05);
    }

    .teacher-info, .gallery-caption {
      padding: 1rem;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      position: absolute;
      bottom: 0;
      width: 100%;
    }

    .event-item {
      position: relative;
      padding-left: 2rem;
      margin-bottom: 1.5rem;
      border-left: 2px solid var(--primary);
    }

    .event-item::before {
      content: '';
      position: absolute;
      left: -9px;
      top: 0;
      width: 16px;
      height: 16px;
      background: var(--accent);
      border-radius: 50%;
    }

    .notice-badge {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    .urgent {
      background: #ef4444;
      color: white;
    }

    .timetable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .timetable th, .timetable td {
      border: 1px solid var(--border-dark);
      padding: 0.8rem;
      text-align: center;
    }

    .timetable th {
      background: var(--primary);
      color: white;
    }

    .accordion-item {
      margin-bottom: 1rem;
      border: 1px solid var(--border-dark);
      border-radius: 8px;
      overflow: hidden;
    }

    .accordion-header {
      background: rgba(0, 0, 0, 0.2);
      padding: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      transition: var(--transition);
    }

    .accordion-header:hover {
      background: var(--primary);
    }

    .accordion-body {
      padding: 1rem;
      background: rgba(0, 0, 0, 0.1);
      color: var(--text-dark);
      display: none;
    }

    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .lightbox.active {
      display: flex;
    }

    .lightbox img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 8px;
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
    }

    .close-lightbox {
      position: absolute;
      top: 20px;
      right: 20px;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      background: none;
      border: none;
    }

    .achievement-counter {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--accent);
      text-align: center;
      margin: 1rem 0;
    }

    .theme-toggle {
      background: none;
      border: 1px solid var(--border-dark);
      color: var(--text-dark);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 900px) {
      .portal {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        position: static;
      }

      nav ul {
        flex-direction: column;
      }

      .school-details h1 {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body data-theme="dark">
  <div class="glow"></div>

  <!-- Gate Form -->
  <div class="gate active" id="gate">
    <div class="gate-form">
      <h2>Welcome to Milli Karwaan Public School</h2>
      <form id="studentForm">
        <div class="form-group">
          <label for="studentName">Student Name</label>
          <input type="text" id="studentName" required placeholder="Enter full name"/>
        </div>
        <div class="form-group">
          <label for="class">Class</label>
          <select id="class" required>
            <option value="">Select Class</option>
            <option value="1">Class 1</option>
            <option value="2">Class 2</option>
            <option value="3">Class 3</option>
            <option value="4">Class 4</option>
            <option value="5">Class 5</option>
            <option value="6">Class 6</option>
            <option value="7">Class 7</option>
            <option value="8">Class 8</option>
            <option value="9">Class 9</option>
            <option value="10">Class 10</option>
            <option value="11">Class 11</option>
            <option value="12">Class 12</option>
          </select>
        </div>
        <div class="form-group">
          <label for="parentName">Parent/Guardian Name</label>
          <input type="text" id="parentName" required placeholder="Enter parent name"/>
        </div>
        <button type="submit" class="btn-submit">Enter Portal</button>
      </form>
    </div>
  </div>

  <!-- Main Portal -->
  <div class="portal" id="portal">
    <header>
      <div class="school-info">
        <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo" class="school-logo"/>
        <div class="school-details">
          <h1>Milli Karwaan Public School Balrampur</h1>
          <p>Boluha Police Chowki Balrampur (U.P.) | madamsir066@gmail.com</p>
        </div>
      </div>
      <button class="call-btn" onclick="window.location.href='tel:9758919151'">CALL US</button>
    </header>

    <nav>
      <ul id="mainNav">
        <li><a href="#" class="nav-link active" data-section="homework">Homework</a></li>
        <li><a href="#" class="nav-link" data-section="teachers">Teachers</a></li>
        <li><a href="#" class="nav-link" data-section="events">Events</a></li>
        <li><a href="#" class="nav-link" data-section="notices">Notices</a></li>
        <li><a href="#" class="nav-link" data-section="timetable">Timetable</a></li>
        <li><a href="#" class="nav-link" data-section="gallery">Gallery</a></li>
        <li><a href="#" class="nav-link" data-section="faq">FAQ</a></li>
        <li><a href="#" class="nav-link" data-section="achievements">Achievements</a></li>
        <li><a href="#" class="nav-link" data-section="contact">Contact</a></li>
        <li><a href="#" class="nav-link" data-section="about">About Us</a></li>
      </ul>
      <button class="menu-toggle">⋮</button>
    </nav>

    <div class="sidebar">
      <h3 style="color: white; margin-bottom: 1rem;">Quick Access</h3>
      
      <div class="card">
        <h3>Homework Search</h3>
        <input type="text" class="search-bar" id="hwSearch" placeholder="Search homework..."/>
        <select id="classFilter" style="width: 100%; padding: 0.8rem; margin: 0.5rem 0; background: rgba(0,0,0,0.2); border: 1px solid var(--border-dark); border-radius: 8px; color: white;">
          <option value="">All Classes</option>
          <option value="1">Class 1</option>
          <option value="2">Class 2</option>
          <option value="3">Class 3</option>
          <option value="4">Class 4</option>
          <option value="5">Class 5</option>
          <option value="6">Class 6</option>
          <option value="7">Class 7</option>
          <option value="8">Class 8</option>
          <option value="9">Class 9</option>
          <option value="10">Class 10</option>
          <option value="11">Class 11</option>
          <option value="12">Class 12</option>
        </select>
        <button class="btn" onclick="renderHomeworkFor(document.getElementById('classFilter').value || studentData.class)">View Homework</button>
      </div>

      <div class="card">
        <h3>Analytics</h3>
        <p style="color: var(--text-dark);">Current Class: <strong id="currentClass">-</strong></p>
        <p style="color: var(--text-dark);">Homework Items: <strong id="hwCount">0</strong></p>
        <p style="color: var(--text-dark);">Messages: <strong id="msgCount">0</strong></p>
      </div>

      <div class="card">
        <h3>Admin Tools</h3>
        <button class="btn btn-outline" onclick="exportMkpsData()">Export Data</button>
        <button class="btn btn-outline" onclick="importMkpsData()">Import Data</button>
        <button class="btn btn-outline" onclick="downloadSnapshot()">Download Snapshot</button>
      </div>

      <button class="theme-toggle" id="themeToggle">
        <span>🌙</span> <span>Dark Mode</span>
      </button>
    </div>

    <main class="section" id="mainSection">
      <!-- Content loaded dynamically -->
    </main>

    <div class="lightbox" id="lightbox">
      <button class="close-lightbox" onclick="closeLightbox()">×</button>
      <img id="lightboxImg" src="" alt="Enlarged view"/>
    </div>
  </div>

  <script>
    let studentData = null;
    let homeworkData = {};
    let teachersData = [];
    let eventsData = [];
    let noticesData = [];
    let timetableData = {};
    let galleryData = [];
    let messagesData = [];

    const gate = document.getElementById('gate');
    const portal = document.getElementById('portal');
    const mainSection = document.getElementById('mainSection');
    const studentForm = document.getElementById('studentForm');
    const glow = document.querySelector('.glow');
    const themeToggle = document.getElementById('themeToggle');

    function checkStudentData() {
      const saved = localStorage.getItem('mkps_student');
      if (saved) {
        studentData = JSON.parse(saved);
        gate.classList.remove('active');
        portal.classList.add('active');
        initPortal();
      }
    }

    studentForm.addEventListener('submit', function(e) {
      e.preventDefault();
      studentData = {
        name: document.getElementById('studentName').value.trim(),
        class: document.getElementById('class').value,
        parent: document.getElementById('parentName').value.trim(),
        timestamp: new Date().toISOString()
      };

      localStorage.setItem('mkps_student', JSON.stringify(studentData));
      localStorage.setItem('mkps_update', new Date().toISOString());

      gate.classList.remove('active');
      portal.classList.add('active');
      initPortal();
    });

    function initPortal() {
      loadAllData();
      setupEventListeners();
      renderSection('homework');
    }

    function loadAllData() {
      const hw = localStorage.getItem('mkps_homework');
      homeworkData = hw ? JSON.parse(hw) : generateDemoHomework();

      const teachers = localStorage.getItem('mkps_teachers');
      teachersData = teachers ? JSON.parse(teachers) : generateDemoTeachers();

      const events = localStorage.getItem('mkps_events');
      eventsData = events ? JSON.parse(events) : generateDemoEvents();

      const notices = localStorage.getItem('mkps_notices');
      noticesData = notices ? JSON.parse(notices) : generateDemoNotices();

      const tt = localStorage.getItem('mkps_timetable');
      timetableData = tt ? JSON.parse(tt) : generateDemoTimetable();

      const gallery = localStorage.getItem('mkps_gallery');
      galleryData = gallery ? JSON.parse(gallery) : generateDemoGallery();

      const messages = localStorage.getItem('mkps_messages');
      messagesData = messages ? JSON.parse(messages) : [];

      localStorage.setItem('mkps_update', new Date().toISOString());
    }

    function setupEventListeners() {
      themeToggle.addEventListener('click', toggleTheme);
      document.addEventListener('mousemove', (e) => {
        const { clientX: x, clientY: y } = e;
        glow.style.left = `${x}px`;
        glow.style.top = `${y}px`;
        glow.style.opacity = '0.4';
        setTimeout(() => glow.style.opacity = '0', 150);
      });
    }

    function toggleTheme() {
      const body = document.body;
      const isDark = body.getAttribute('data-theme') === 'dark';
      if (isDark) {
        body.setAttribute('data-theme', 'light');
        themeToggle.innerHTML = '<span>☀️</span> <span>Light Mode</span>';
      } else {
        body.setAttribute('data-theme', 'dark');
        themeToggle.innerHTML = '<span>🌙</span> <span>Dark Mode</span>';
      }
      localStorage.setItem('mkps_theme', body.getAttribute('data-theme'));
    }

    function checkTheme() {
      const saved = localStorage.getItem('mkps_theme') || 'dark';
      document.body.setAttribute('data-theme', saved);
      themeToggle.innerHTML = saved === 'dark' 
        ? '<span>🌙</span> <span>Dark Mode</span>'
        : '<span>☀️</span> <span>Light Mode</span>';
    }

    function renderSection(section) {
      let content = '';
      switch(section) {
        case 'homework': content = renderHomework(); break;
        case 'teachers': content = renderTeachers(); break;
        case 'events': content = renderEvents(); break;
        case 'notices': content = renderNotices(); break;
        case 'timetable': content = renderTimetable(); break;
        case 'gallery': content = renderGallery(); break;
        case 'faq': content = renderFAQ(); break;
        case 'achievements': content = renderAchievements(); break;
        case 'contact': content = renderContact(); break;
        case 'about': content = renderAbout(); break;
        default: content = `<div class="card"><h3>Welcome, ${studentData.name}</h3><p>You are in Class ${studentData.class}.</p></div>`;
      }
      mainSection.innerHTML = content;
    }

    window.renderHomeworkFor = function(cls) {
      const classNum = cls || studentData.class;
      const hw = homeworkData[classNum] || [];
      const container = document.getElementById('homeworkList');
      let html = '';
      if (hw.length === 0) {
        html = '<div class="card"><p>No homework assigned.</p></div>';
      } else {
        hw.forEach(item => {
          html += `
            <div class="hw-item">
              <div class="hw-subject">${item.subject}</div>
              <div class="hw-meta">Teacher: ${item.teacher} | Due: ${item.dueDate}</div>
              <p>${item.instructions}</p>
            </div>
          `;
        });
      }
      if (container) container.innerHTML = html;
      return html;
    };

    function renderHomework() {
      return `
        <h2>Homework</h2>
        <div class="card">
          <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
            <select id="classSelector" onchange="renderHomeworkFor(this.value)" style="padding: 0.6rem; border-radius: 8px; border: 1px solid var(--border-dark); background: rgba(0,0,0,0.2); color: white;">
              <option value="${studentData.class}">Class ${studentData.class} (Current)</option>
              <option value="1">Class 1</option>
              <option value="2">Class 2</option>
              <option value="3">Class 3</option>
              <option value="4">Class 4</option>
              <option value="5">Class 5</option>
              <option value="6">Class 6</option>
              <option value="7">Class 7</option>
              <option value="8">Class 8</option>
              <option value="9">Class 9</option>
              <option value="10">Class 10</option>
              <option value="11">Class 11</option>
              <option value="12">Class 12</option>
            </select>
            <button class="btn" onclick="window.print()">🖨️ Print</button>
            <button class="btn btn-outline" onclick="downloadSnapshot()">📥 Download</button>
          </div>
          <div class="homework-list" id="homeworkList">
            ${window.renderHomeworkFor(studentData.class)}
          </div>
        </div>
      `;
    }

    function renderTeachers() {
      let html = '<h2>Our Teachers</h2><div class="teacher-grid">';
      teachersData.forEach(t => {
        html += `
          <div class="card teacher-card">
            <img src="${t.photo || 'https://placehold.co/300x200/1e40af/ffffff?text=Teacher'}" alt="${t.name}">
            <div class="teacher-info">
              <h3>${t.name}</h3>
              <p>${t.subject}</p>
              <button class="btn" onclick="window.location.href='tel:${t.phone}'">📞 Call</button>
              <button class="btn btn-outline" onclick="window.location.href='mailto:${t.email}'">📧 Email</button>
            </div>
          </div>
        `;
      });
      html += '</div>';
      return html;
    }

    function renderEvents() {
      let html = '<h2>School Events</h2><div class="event-timeline">';
      eventsData.forEach(e => {
        html += `
          <div class="card event-item">
            <h3>${e.title}</h3>
            <p class="hw-meta">📅 ${e.date} | 📍 ${e.venue}</p>
            <p>${e.description}</p>
          </div>
        `;
      });
      html += '</div>';
      return html;
    }

    function renderNotices() {
      let html = '<h2>Notices & Announcements</h2>';
      noticesData.forEach(n => {
        const badge = n.urgent ? '<span class="notice-badge urgent">URGENT</span>' : '';
        html += `
          <div class="card">
            <h3>${n.title} ${badge}</h3>
            <p class="hw-meta">📅 ${n.date}</p>
            <p>${n.message}</p>
          </div>
        `;
      });
      return html;
    }

    function renderTimetable() {
      const tt = timetableData[studentData.class] || timetableData['1'];
      const days = Object.keys(tt);
      let html = '<h2>Class Timetable</h2><div class="card"><table class="timetable"><tr><th>Time</th>';
      days.forEach(d => html += `<th>${d}</th>`);
      html += '</tr>';

      const times = Object.keys(tt[days[0]]);
      times.forEach(t => {
        html += `<tr><td>${t}</td>`;
        days.forEach(d => html += `<td>${tt[d][t] || '-'}</td>`);
        html += '</tr>';
      });
      html += '</table></div>';
      return html;
    }

    function renderGallery() {
      let html = '<h2>School Gallery</h2><div class="gallery-grid">';
      galleryData.forEach(g => {
        html += `
          <div class="card gallery-item" onclick="openLightbox('${g.url}')">
            <img src="${g.url}" alt="${g.caption}">
            <div class="gallery-caption">${g.caption}</div>
          </div>
        `;
      });
      html += '</div>';
      return html;
    }

    function openLightbox(src) {
      document.getElementById('lightboxImg').src = src;
      document.getElementById('lightbox').classList.add('active');
    }

    function closeLightbox() {
      document.getElementById('lightbox').classList.remove('active');
    }

    function renderFAQ() {
      const faqs = [
        { q: "School hours?", a: "8:00 AM to 2:30 PM, Mon-Sat." },
        { q: "Fee structure?", a: "Class 1–5: ₹6k/year; 6–8: ₹8k; 9–10: ₹10k; 11–12: ₹12k." },
        { q: "Contact teachers?", a: "Use Teachers section to call or email." },
        { q: "Extracurriculars?", a: "Yes: Sports, Music, Arts & Craft, Science Club." }
      ];

      let html = '<h2>Frequently Asked Questions</h2>';
      faqs.forEach(f => {
        html += `
          <div class="accordion-item">
            <div class="accordion-header"><span>${f.q}</span><span>+</span></div>
            <div class="accordion-body"><p>${f.a}</p></div>
          </div>
        `;
      });

      setTimeout(() => {
        document.querySelectorAll('.accordion-header').forEach(h => {
          h.addEventListener('click', function() {
            const b = this.nextElementSibling;
            const s = this.querySelector('span:last-child');
            document.querySelectorAll('.accordion-body').forEach(bb => bb.style.display = 'none');
            document.querySelectorAll('.accordion-header span:last-child').forEach(ss => ss.textContent = '+');
            if (b.style.display !== 'block') {
              b.style.display = 'block';
              s.textContent = '−';
            }
          });
        });
      }, 100);

      return html;
    }

    function renderAchievements() {
      return `
        <h2>School Achievements</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
          <div class="card" style="text-align: center;"><div class="achievement-counter" data-count="150">0</div><p style="color: var(--text-dark);">Students</p></div>
          <div class="card" style="text-align: center;"><div class="achievement-counter" data-count="12">0</div><p style="color: var(--text-dark);">Teachers</p></div>
          <div class="card" style="text-align: center;"><div class="achievement-counter" data-count="8">0</div><p style="color: var(--text-dark);">Awards</p></div>
          <div class="card" style="text-align: center;"><div class="achievement-counter" data-count="5">0</div><p style="color: var(--text-dark);">Sports Titles</p></div>
        </div>
      `;
    }

    function animateCounters() {
      document.querySelectorAll('.achievement-counter').forEach(el => {
        const target = +el.getAttribute('data-count');
        let count = 0;
        const step = target / 80;
        const timer = setInterval(() => {
          count += step;
          if (count >= target) {
            count = target;
            clearInterval(timer);
          }
          el.textContent = Math.floor(count);
        }, 20);
      });
    }

    function renderContact() {
      return `
        <h2>Contact Us</h2>
        <div class="card">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
            <div>
              <h3>Get In Touch</h3>
              <p style="color: var(--text-dark); margin: 1rem 0;">
                <strong>Address:</strong> Boluha Police Chowki Balrampur (U.P.)<br>
                <strong>Phone:</strong> <a href="tel:9758919151" style="color: var(--primary-light);">9758919151</a><br>
                <strong>Email:</strong> <a href="mailto:madamsir066@gmail.com" style="color: var(--primary-light);">madamsir066@gmail.com</a>
              </p>
            </div>
            <div>
              <form id="contactForm">
                <div class="form-group"><label>Name</label><input type="text" required placeholder="Your name"/></div>
                <div class="form-group"><label>Email</label><input type="email" required placeholder="Your email"/></div>
                <div class="form-group"><label>Message</label><textarea rows="3" required placeholder="Your message" style="width:100%;padding:0.8rem;border:1px solid var(--border-dark);background:rgba(0,0,0,0.2);color:white;border-radius:8px;"></textarea></div>
                <button type="submit" class="btn">Send Message</button>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    document.addEventListener('submit', function(e) {
      if (e.target.id === 'contactForm') {
        e.preventDefault();
        const f = e.target;
        messagesData.push({
          name: f.querySelector('input[type="text"]').value,
          email: f.querySelector('input[type="email"]').value,
          message: f.querySelector('textarea').value,
          timestamp: new Date().toISOString()
        });
        localStorage.setItem('mkps_messages', JSON.stringify(messagesData));
        alert('Message sent!');
        f.reset();
      }
    }, true);

    function renderAbout() {
      return `
        <h2>About Milli Karwaan Public School</h2>
        <div class="card">
          <p style="margin-bottom: 1rem; line-height: 1.8;">
            We provide quality education with modern teaching and traditional values. Our mission is academic excellence and character building.
          </p>
          <div style="margin-top: 1.5rem;"><h3>Our Vision</h3><p>To create responsible, knowledgeable citizens.</p></div>
          <div style="margin-top: 1.5rem;"><h3>Our Mission</h3><p>Accessible, high-quality education for all.</p></div>
        </div>
      `;
    }

    window.exportMkpsData = function() {
      const data = {};
      for (let i = 0; i < localStorage.length; i++) {
        const k = localStorage.key(i);
        if (k.startsWith('mkps_')) data[k] = localStorage.getItem(k);
      }
      const b = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const u = URL.createObjectURL(b);
      const a = document.createElement('a');
      a.href = u;
      a.download = `mkps_backup_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(u);
    };

    window.importMkpsData = function() {
      const i = document.createElement('input');
      i.type = 'file';
      i.accept = '.json';
      i.onchange = e => {
        const f = e.target.files[0];
        const r = new FileReader();
        r.onload = function(e) {
          try {
            const d = JSON.parse(e.target.result);
            if (typeof d === 'object' && Object.keys(d).some(k => k.startsWith('mkps_'))) {
              Object.keys(d).forEach(k => localStorage.setItem(k, d[k]));
              alert('Data imported!');
              location.reload();
            } else alert('Invalid format.');
          } catch (err) { alert('Error parsing file.'); }
        };
        r.readAsText(f);
      };
      i.click();
    };

    function downloadSnapshot() {
      const hw = homeworkData[studentData.class] || [];
      let c = `<html><head><title>Homework - Class ${studentData.class}</title><style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:20px;line-height:1.6;} .hw-item{background:#f8fafc;padding:15px;margin:15px 0;border-left:4px solid #1e40af;}</style></head><body><h1>Homework - Class ${studentData.class}</h1>`;
      hw.forEach(h => {
        c += `<div class="hw-item"><div><strong>${h.subject}</strong></div><div>Teacher: ${h.teacher} | Due: ${h.dueDate}</div><p>${h.instructions}</p></div>`;
      });
      c += `<footer>Generated on ${new Date().toLocaleString()}</footer></body></html>`;
      const b = new Blob([c], { type: 'text/html' });
      const u = URL.createObjectURL(b);
      const a = document.createElement('a');
      a.href = u;
      a.download = `homework_class${studentData.class}_${new Date().toISOString().split('T')[0]}.html`;
      a.click();
      URL.revokeObjectURL(u);
    }

    function generateDemoHomework() {
      const s = ['Math', 'Science', 'English', 'Hindi', 'SST', 'CS'];
      const t = ['Arif', 'Shruti', 'Prakash', 'Riya', 'Neeraj', 'Alka'];
      const d = {};
      for (let i = 1; i <= 12; i++) {
        d[i] = [];
        for (let j = 0; j < 2; j++) {
          d[i].push({
            subject: s[Math.floor(Math.random() * s.length)],
            teacher: t[Math.floor(Math.random() * t.length)],
            dueDate: new Date(Date.now() + Math.random() * 7 * 86400000).toLocaleDateString(),
            instructions: `Complete the assigned ${s[Math.floor(Math.random() * s.length)].toLowerCase()} exercises.`
          });
        }
      }
      localStorage.setItem('mkps_homework', JSON.stringify(d));
      return d;
    }

    function generateDemoTeachers() {
      return [
        { name: 'Arif Khan', subject: 'Math', phone: '9876543210', email: 'arif@mkps.edu', photo: 'https://placehold.co/300x200/1e40af/ffffff?text=Arif+Khan' },
        { name: 'Shruti Verma', subject: 'Science', phone: '9876543211', email: 'shruti@mkps.edu', photo: 'https://placehold.co/300x200/1e40af/ffffff?text=Shruti+Verma' }
      ];
    }

    function generateDemoEvents() {
      return [
        { title: 'Annual Day', date: '2023-12-15', venue: 'School Ground', description: 'Cultural festival.' },
        { title: 'Science Fair', date: '2024-01-10', venue: 'Lab', description: 'Student projects.' }
      ];
    }

    function generateDemoNotices() {
      return [
        { title: 'Holiday', date: '2023-11-01', message: 'School closed on Diwali.', urgent: false },
        { title: 'Fee Due', date: '2023-11-05', message: 'Submit fees by Nov 15.', urgent: true }
      ];
    }

    function generateDemoTimetable() {
      const d = {};
      for (let c = 1; c <= 12; c++) {
        d[c] = { Monday: {}, Tuesday: {}, Wednesday: {}, Thursday: {}, Friday: {} };
        ['8:00-9:00', '9:00-10:00', '10:00-11:00'].forEach(t => {
          ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'].forEach(day => {
            d[c][day][t] = ['Math', 'Science', 'English'][Math.floor(Math.random() * 3)];
          });
        });
      }
      return d;
    }

    function generateDemoGallery() {
      return [
        { url: 'https://placehold.co/600x400/1e40af/ffffff?text=Annual+Day', caption: 'Annual Day 2023' },
        { url: 'https://placehold.co/600x400/1e40af/ffffff?text=Science+Fair', caption: 'Science Fair' }
      ];
    }

    window.refreshTeachers = () => { const d = localStorage.getItem('mkps_teachers'); teachersData = d ? JSON.parse(d) : teachersData; };
    window.refreshEvents = () => { const d = localStorage.getItem('mkps_events'); eventsData = d ? JSON.parse(d) : eventsData; };
    window.refreshNotices = () => { const d = localStorage.getItem('mkps_notices'); noticesData = d ? JSON.parse(d) : noticesData; };
    window.refreshTimetable = () => { const d = localStorage.getItem('mkps_timetable'); timetableData = d ? JSON.parse(d) : timetableData; };
    window.refreshGallery = () => { const d = localStorage.getItem('mkps_gallery'); galleryData = d ? JSON.parse(d) : galleryData; };
    window.refreshMessages = () => { const d = localStorage.getItem('mkps_messages'); messagesData = d ? JSON.parse(d) : messagesData; };

    document.addEventListener('DOMContentLoaded', () => {
      checkTheme();
      checkStudentData();
      const obs = new IntersectionObserver(e => e.forEach(ent => {
        if (ent.isIntersecting) {
          animateCounters();
          obs.unobserve(ent.target);
        }
      }));
      const counter = document.querySelector('.achievement-counter');
      if (counter) obs.observe(counter);
    });
  </script>
</body>
</html>
