<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Milli Karwaan Public School Balrampur</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --primary: #1e40af;
      --primary-light: #3b82f6;
      --primary-dark: #1e3a8a;
      --secondary: #d97706;
      --accent: #ec4899;
      --bg-light: #f8fafc;
      --bg-dark: #0f172a;
      --card-light: rgba(255, 255, 255, 0.15);
      --card-dark: rgba(15, 23, 42, 0.7);
      --text-light: #e2e8f0;
      --text-dark: #cbd5e1;
      --border-light: rgba(255, 255, 255, 0.2);
      --border-dark: rgba(30, 41, 59, 0.5);
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      --radius: 16px;
      --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    [data-theme="light"] {
      --primary: #2563eb;
      --primary-light: #3b82f6;
      --primary-dark: #1d4ed8;
      --secondary: #ea580c;
      --accent: #db2777;
      --bg-light: #ffffff;
      --bg-dark: #f1f5f9;
      --card-light: rgba(255, 255, 255, 0.8);
      --card-dark: rgba(241, 245, 249, 0.8);
      --text-light: #1e293b;
      --text-dark: #334155;
      --border-light: rgba(203, 213, 225, 0.5);
      --border-dark: rgba(203, 213, 225, 0.3);
      --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: var(--transition);
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(125deg, transparent 60%, rgba(59, 130, 246, 0.05) 80%, rgba(236, 72, 153, 0.1) 100%);
      pointer-events: none;
      z-index: -2;
      transition: var(--transition);
    }

    .glow {
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.2) 0%, transparent 70%);
      opacity: 0;
      pointer-events: none;
      z-index: -1;
      filter: blur(40px);
      transition: opacity 0.5s ease;
    }

    .gate, .portal {
      display: none;
    }

    .active {
      display: block !important;
    }

    /* Gate Styles */
    .gate {
      position: fixed;
      inset: 0;
      background: linear-gradient(to right, #0f172a, #1e293b);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .gate-form {
      background: var(--card-dark);
      backdrop-filter: blur(16px);
      border: 1px solid var(--border-dark);
      border-radius: var(--radius);
      padding: 2.5rem;
      width: 90%;
      max-width: 500px;
      box-shadow: var(--shadow);
      transform: translateY(20px);
      opacity: 0;
      animation: slideUp 0.8s ease forwards;
    }

    @keyframes slideUp {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .gate h2 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      color: white;
      text-align: center;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 1.2rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-dark);
      font-weight: 500;
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 0.8rem 1rem;
      border: 1px solid var(--border-dark);
      background: rgba(0, 0, 0, 0.2);
      color: white;
      border-radius: 8px;
      font-size: 1rem;
      transition: var(--transition);
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }

    .btn-submit {
      background: linear-gradient(to right, var(--primary), var(--primary-light));
      color: white;
      border: none;
      padding: 0.8rem 2rem;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 20px rgba(59, 130, 246, 0.5);
    }

    /* Portal Layout */
    .portal {
      display: flex;
      min-height: 100vh;
    }

    header {
      background: var(--card-dark);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border-dark);
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .school-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .school-logo {
      height: 60px;
      border-radius: 8px;
    }

    .school-details h1 {
      font-size: 1.4rem;
      color: white;
      font-weight: 700;
      font-family: 'Playfair Display', serif;
    }

    .school-details p {
      font-size: 0.85rem;
      color: var(--text-dark);
    }

    .call-btn {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }

    .call-btn:hover {
      background: #c2410c;
      transform: scale(1.05);
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    nav a {
      color: var(--text-dark);
      text-decoration: none;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      font-size: 0.95rem;
      transition: var(--transition);
      white-space: nowrap;
    }

    nav a:hover, nav a.active {
      background: var(--primary);
      color: white;
    }

    .menu-toggle {
      background: none;
      border: none;
      color: var(--text-dark);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
    }

    .sidebar {
      width: 280px;
      background: var(--card-dark);
      backdrop-filter: blur(12px);
      border-right: 1px solid var(--border-dark);
      padding: 1.5rem;
      height: calc(100vh - 80px);
      position: sticky;
      top: 80px;
      overflow-y: auto;
    }

    .section {
      padding: 2rem;
      flex: 1;
      min-width: 0;
    }

    .section h2 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      color: white;
      position: relative;
      padding-bottom: 0.5rem;
    }

    .section h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 50px;
      height: 3px;
      background: var(--accent);
      border-radius: 2px;
    }

    .card {
      background: var(--card-dark);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border-dark);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
      transition: var(--transition);
      transform: translateY(0);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
      transform: rotate(45deg);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.8s;
    }

    .card:hover::before {
      opacity: 1;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }

    .card h3 {
      color: white;
      margin-bottom: 0.8rem;
      font-size: 1.3rem;
    }

    .card p {
      color: var(--text-dark);
      line-height: 1.6;
    }

    .homework-list {
      display: grid;
      gap: 1rem;
    }

    .hw-item {
      background: rgba(0, 0, 0, 0.2);
      border-left: 4px solid var(--primary);
      padding: 1rem;
      border-radius: 8px;
      transition: var(--transition);
    }

    .hw-item:hover {
      background: rgba(0, 0, 0, 0.3);
      transform: translateX(5px);
    }

    .hw-subject {
      font-weight: 600;
      color: white;
    }

    .hw-meta {
      font-size: 0.85rem;
      color: var(--text-dark);
      margin: 0.3rem 0;
    }

    .btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: var(--transition);
      margin-right: 0.5rem;
      margin-top: 0.5rem;
      display: inline-block;
    }

    .btn:hover {
      background: var(--primary-light);
      transform: scale(1.05);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary-light);
      color: var(--primary-light);
    }

    .btn-outline:hover {
      background: rgba(59, 130, 246, 0.1);
    }

    .search-bar {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid var(--border-dark);
      background: rgba(0, 0, 0, 0.2);
      color: white;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .search-bar::placeholder {
      color: var(--text-dark);
    }

    .teacher-grid, .gallery-grid, .event-timeline {
      display: grid;
      gap: 1rem;
    }

    .teacher-card, .gallery-item {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius);
      cursor: pointer;
    }

    .teacher-card img, .gallery-item img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      transition: var(--transition);
    }

    .teacher-card:hover img, .gallery-item:hover img {
      transform: scale(1.05);
    }

    .teacher-info, .gallery-caption {
      padding: 1rem;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      position: absolute;
      bottom: 0;
      width: 100%;
    }

    .event-item {
      position: relative;
      padding-left: 2rem;
      margin-bottom: 1.5rem;
      border-left: 2px solid var(--primary);
    }

    .event-item::before {
      content: '';
      position: absolute;
      left: -9px;
      top: 0;
      width: 16px;
      height: 16px;
      background: var(--accent);
      border-radius: 50%;
    }

    .notice-badge {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    .urgent {
      background: #ef4444;
      color: white;
    }

    .timetable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .timetable th, .timetable td {
      border: 1px solid var(--border-dark);
      padding: 0.8rem;
      text-align: center;
    }

    .timetable th {
      background: var(--primary);
      color: white;
    }

    .accordion-item {
      margin-bottom: 1rem;
      border: 1px solid var(--border-dark);
      border-radius: 8px;
      overflow: hidden;
    }

    .accordion-header {
      background: rgba(0, 0, 0, 0.2);
      padding: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      transition: var(--transition);
    }

    .accordion-header:hover {
      background: var(--primary);
    }

    .accordion-body {
      padding: 1rem;
      background: rgba(0, 0, 0, 0.1);
      color: var(--text-dark);
      display: none;
    }

    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .lightbox.active {
      display: flex;
    }

    .lightbox img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 8px;
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
    }

    .close-lightbox {
      position: absolute;
      top: 20px;
      right: 20px;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      background: none;
      border: none;
    }

    .achievement-counter {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--accent);
      text-align: center;
      margin: 1rem 0;
    }

    .theme-toggle {
      background: none;
      border: 1px solid var(--border-dark);
      color: var(--text-dark);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 900px) {
      .portal {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        position: static;
      }

      nav ul {
        flex-direction: column;
      }

      .school-details h1 {
        font-size: 1.2rem;
      }
    }

    .floating {
      animation: floating 6s ease-in-out infinite;
    }

    @keyframes floating {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(236, 72, 153, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(236, 72, 153, 0); }
      100% { box-shadow: 0 0 0 0 rgba(236, 72, 153, 0); }
    }

    .glow-button {
      position: relative;
      overflow: hidden;
    }

    .glow-button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(236, 72, 153, 0.4) 0%, transparent 70%);
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
      transition: all 0.6s;
      pointer-events: none;
    }

    .glow-button:hover::after {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
  </style>
</head>
<body data-theme="dark">
  <!-- Glow Effect -->
  <div class="glow"></div>

  <!-- First Visit Gate -->
  <div class="gate active" id="gate">
    <div class="gate-form">
      <h2>Welcome to Milli Karwaan Public School</h2>
      <form id="studentForm">
        <div class="form-group">
          <label for="studentName">Student Name</label>
          <input type="text" id="studentName" required placeholder="Enter full name"/>
        </div>
        <div class="form-group">
          <label for="class">Class</label>
          <select id="class" required>
            <option value="">Select Class</option>
            <option value="1">Class 1</option>
            <option value="2">Class 2</option>
            <option value="3">Class 3</option>
            <option value="4">Class 4</option>
            <option value="5">Class 5</option>
            <option value="6">Class 6</option>
            <option value="7">Class 7</option>
            <option value="8">Class 8</option>
            <option value="9">Class 9</option>
            <option value="10">Class 10</option>
            <option value="11">Class 11</option>
            <option value="12">Class 12</option>
          </select>
        </div>
        <div class="form-group">
          <label for="parentName">Parent/Guardian Name</label>
          <input type="text" id="parentName" required placeholder="Enter parent name"/>
        </div>
        <button type="submit" class="btn-submit glow-button">Enter Portal</button>
      </form>
    </div>
  </div>

  <!-- Main Portal -->
  <div class="portal" id="portal">
    <header>
      <div class="school-info">
        <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo" class="school-logo"/>
        <div class="school-details">
          <h1>Milli Karwaan Public School Balrampur</h1>
          <p>Boluha Police Chowki Balrampur (U.P.) | madamsir066@gmail.com</p>
        </div>
      </div>
      <button class="call-btn" onclick="window.location.href='tel:9758919151'">CALL US</button>
    </header>

    <nav>
      <ul id="mainNav">
        <li><a href="#" class="nav-link active" data-section="homework">Homework</a></li>
        <li><a href="#" class="nav-link" data-section="teachers">Teachers</a></li>
        <li><a href="#" class="nav-link" data-section="events">Events</a></li>
        <li><a href="#" class="nav-link" data-section="notices">Notices</a></li>
        <li><a href="#" class="nav-link" data-section="timetable">Timetable</a></li>
        <li><a href="#" class="nav-link" data-section="gallery">Gallery</a></li>
        <li><a href="#" class="nav-link" data-section="faq">FAQ</a></li>
        <li><a href="#" class="nav-link" data-section="achievements">Achievements</a></li>
        <li><a href="#" class="nav-link" data-section="contact">Contact</a></li>
        <li><a href="#" class="nav-link" data-section="about">About Us</a></li>
      </ul>
      <button class="menu-toggle">⋮</button>
    </nav>

    <div class="sidebar">
      <h3 style="color: white; margin-bottom: 1rem;">Quick Access</h3>
      
      <div class="card">
        <h3>Homework Search</h3>
        <input type="text" class="search-bar" id="hwSearch" placeholder="Search homework..."/>
        <select id="classFilter" style="width: 100%; padding: 0.8rem; margin: 0.5rem 0; background: rgba(0,0,0,0.2); border: 1px solid var(--border-dark); border-radius: 8px; color: white;">
          <option value="">All Classes</option>
          <option value="1">Class 1</option>
          <option value="2">Class 2</option>
          <option value="3">Class 3</option>
          <option value="4">Class 4</option>
          <option value="5">Class 5</option>
          <option value="6">Class 6</option>
          <option value="7">Class 7</option>
          <option value="8">Class 8</option>
          <option value="9">Class 9</option>
          <option value="10">Class 10</option>
          <option value="11">Class 11</option>
          <option value="12">Class 12</option>
        </select>
        <button class="btn" onclick="renderHomeworkFor(document.getElementById('classFilter').value || studentData.class)">View Homework</button>
      </div>

      <div class="card">
        <h3>Analytics</h3>
        <p style="color: var(--text-dark);">Current Class: <strong id="currentClass">-</strong></p>
        <p style="color: var(--text-dark);">Homework Items: <strong id="hwCount">0</strong></p>
        <p style="color: var(--text-dark);">Messages: <strong id="msgCount">0</strong></p>
      </div>

      <div class="card">
        <h3>Admin Tools</h3>
        <button class="btn btn-outline" onclick="exportMkpsData()">Export Data</button>
        <button class="btn btn-outline" onclick="importMkpsData()">Import Data</button>
        <button class="btn btn-outline" onclick="downloadSnapshot()">Download Snapshot</button>
      </div>

      <button class="theme-toggle" id="themeToggle">
        <span>🌙</span> <span>Dark Mode</span>
      </button>
    </div>

    <main class="section" id="mainSection">
      <!-- Dynamic content will be loaded here -->
    </main>

    <!-- Lightbox for Gallery -->
    <div class="lightbox" id="lightbox">
      <button class="close-lightbox" onclick="closeLightbox()">×</button>
      <img id="lightboxImg" src="" alt="Enlarged view"/>
    </div>
  </div>

  <script>
    // Global Variables
    let studentData = null;
    let homeworkData = {};
    let teachersData = [];
    let eventsData = [];
    let noticesData = [];
    let timetableData = {};
    let galleryData = [];
    let messagesData = [];

    // DOM Elements
    const gate = document.getElementById('gate');
    const portal = document.getElementById('portal');
    const mainSection = document.getElementById('mainSection');
    const studentForm = document.getElementById('studentForm');
    const glow = document.querySelector('.glow');
    const themeToggle = document.getElementById('themeToggle');
    const hwSearch = document.getElementById('hwSearch');
    const classFilter = document.getElementById('classFilter');
    const currentClassEl = document.getElementById('currentClass');
    const hwCountEl = document.getElementById('hwCount');
    const msgCountEl = document.getElementById('msgCount');

    // Check for existing student data
    function checkStudentData() {
      const saved = localStorage.getItem('mkps_student');
      if (saved) {
        studentData = JSON.parse(saved);
        gate.classList.remove('active');
        portal.classList.add('active');
        initPortal();
      } else {
        // Prevent back navigation
        history.pushState(null, null, location.href);
        window.onpopstate = function () {
          history.go(1);
        };
      }
    }

    // Save student data
    studentForm.addEventListener('submit', function(e) {
      e.preventDefault();
      studentData = {
        name: document.getElementById('studentName').value.trim(),
        class: document.getElementById('class').value,
        parent: document.getElementById('parentName').value.trim(),
        timestamp: new Date().toISOString()
      };

      localStorage.setItem('mkps_student', JSON.stringify(studentData));
      localStorage.setItem('mkps_update', new Date().toISOString());

      gate.classList.remove('active');
      portal.classList.add('active');
      initPortal();
    });

    // Initialize portal
    function initPortal() {
      loadAllData();
      setupEventListeners();
      renderSection('homework');
      updateAnalytics();
      
      // Setup navigation
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
          this.classList.add('active');
          renderSection(this.getAttribute('data-section'));
        });
      });

      // Prevent back button
      history.pushState(null, null, location.href);
      window.onpopstate = function () {
        history.go(1);
      };
    }

    // Load all data from localStorage
    function loadAllData() {
      // Homework
      const hw = localStorage.getItem('mkps_homework');
      homeworkData = hw ? JSON.parse(hw) : generateDemoHomework();

      // Teachers
      const teachers = localStorage.getItem('mkps_teachers');
      teachersData = teachers ? JSON.parse(teachers) : generateDemoTeachers();

      // Events
      const events = localStorage.getItem('mkps_events');
      eventsData = events ? JSON.parse(events) : generateDemoEvents();

      // Notices
      const notices = localStorage.getItem('mkps_notices');
      noticesData = notices ? JSON.parse(notices) : generateDemoNotices();

      // Timetable
      const tt = localStorage.getItem('mkps_timetable');
      timetableData = tt ? JSON.parse(tt) : generateDemoTimetable();

      // Gallery
      const gallery = localStorage.getItem('mkps_gallery');
      galleryData = gallery ? JSON.parse(gallery) : generateDemoGallery();

      // Messages
      const messages = localStorage.getItem('mkps_messages');
      messagesData = messages ? JSON.parse(messages) : [];

      // Update timestamp
      localStorage.setItem('mkps_update', new Date().toISOString());
    }

    // Setup event listeners
    function setupEventListeners() {
      // Theme toggle
      themeToggle.addEventListener('click', toggleTheme);

      // Search and filter
      hwSearch.addEventListener('input', filterHomework);
      classFilter.addEventListener('change', () => {
        renderHomeworkFor(classFilter.value || studentData.class);
      });

      // Mouse move glow
      document.addEventListener('mousemove', (e) => {
        const { clientX: x, clientY: y } = e;
        glow.style.left = `${x}px`;
        glow.style.top = `${y}px`;
        glow.style.opacity = '0.4';
        
        setTimeout(() => {
          glow.style.opacity = '0';
        }, 150);
      });

      // Keyboard navigation for gallery
      document.addEventListener('keydown', (e) => {
        const lightbox = document.getElementById('lightbox');
        if (lightbox.classList.contains('active') && e.key === 'Escape') {
          closeLightbox();
        }
      });
    }

    // Toggle dark/light mode
    function toggleTheme() {
      const body = document.body;
      const isDark = body.getAttribute('data-theme') === 'dark';
      
      if (isDark) {
        body.setAttribute('data-theme', 'light');
        themeToggle.innerHTML = '<span>☀️</span> <span>Light Mode</span>';
      } else {
        body.setAttribute('data-theme', 'dark');
        themeToggle.innerHTML = '<span>🌙</span> <span>Dark Mode</span>';
      }
      
      localStorage.setItem('mkps_theme', body.getAttribute('data-theme'));
    }

    // Check and apply saved theme
    function checkTheme() {
      const saved = localStorage.getItem('mkps_theme') || 'dark';
      document.body.setAttribute('data-theme', saved);
      themeToggle.innerHTML = saved === 'dark' 
        ? '<span>🌙</span> <span>Dark Mode</span>'
        : '<span>☀️</span> <span>Light Mode</span>';
    }

    // Render section content
    function renderSection(section) {
      let content = '';

      switch(section) {
        case 'homework':
          content = renderHomework();
          break;
        case 'teachers':
          content = renderTeachers();
          break;
        case 'events':
          content = renderEvents();
          break;
        case 'notices':
          content = renderNotices();
          break;
        case 'timetable':
          content = renderTimetable();
          break;
        case 'gallery':
          content = renderGallery();
          break;
        case 'faq':
          content = renderFAQ();
          break;
        case 'achievements':
          content = renderAchievements();
          break;
        case 'contact':
          content = renderContact();
          break;
        case 'about':
          content = renderAbout();
          break;
        default:
          content = `<div class="card"><h3>Welcome, ${studentData.name}</h3><p>You are in Class ${studentData.class}. Welcome to Milli Karwaan Public School portal.</p></div>`;
      }

      mainSection.innerHTML = content;
    }

    // Render Homework
    function renderHomework() {
      return `
        <h2>Homework</h2>
        <div class="card">
          <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
            <select id="classSelector" onchange="renderHomeworkFor(this.value)" style="padding: 0.6rem; border-radius: 8px; border: 1px solid var(--border-dark); background: rgba(0,0,0,0.2); color: white;">
              <option value="${studentData.class}">Class ${studentData.class} (Current)</option>
              <option value="1">Class 1</option>
              <option value="2">Class 2</option>
              <option value="3">Class 3</option>
              <option value="4">Class 4</option>
              <option value="5">Class 5</option>
              <option value="6">Class 6</option>
              <option value="7">Class 7</option>
              <option value="8">Class 8</option>
              <option value="9">Class 9</option>
              <option value="10">Class 10</option>
              <option value="11">Class 11</option>
              <option value="12">Class 12</option>
            </select>
            <button class="btn" onclick="window.print()">🖨️ Print</button>
            <button class="btn btn-outline" onclick="downloadSnapshot()">📥 Download</button>
          </div>
          <div class="homework-list" id="homeworkList">
            ${renderHomeworkFor(studentData.class)}
          </div>
        </div>
      `;
    }

    // Render homework for specific class
    window.renderHomeworkFor = function(cls) {
      const classNum = cls || studentData.class;
      const hw = homeworkData[classNum] || [];
      const container = document.getElementById('homeworkList');

      let html = '';
      if (hw.length === 0) {
        html = '<div class="card"><p>No homework assigned for this class.</p></div>';
      } else {
        hw.forEach(item => {
          html += `
            <div class="hw-item">
              <div class="hw-subject">${item.subject}</div>
              <div class="hw-meta">Teacher: ${item.teacher} | Due: ${item.dueDate}</div>
              <p>${item.instructions}</p>
            </div>
          `;
        });
      }

      if (container) {
        container.innerHTML = html;
      }

      return html;
    };

    // Filter homework
    function filterHomework() {
      const term = hwSearch.value.toLowerCase();
      const classNum = classFilter.value || studentData.class;
      const hw = homeworkData[classNum] || [];
      
      const filtered = hw.filter(item => 
        item.subject.toLowerCase().includes(term) ||
        item.teacher.toLowerCase().includes(term) ||
        item.instructions.toLowerCase().includes(term)
      );

      const container = document.getElementById('homeworkList');
      if (container) {
        let html = '';
        if (filtered.length === 0) {
          html = '<div class="card"><p>No matching homework found.</p></div>';
        } else {
          filtered.forEach(item => {
            html += `
              <div class="hw-item">
                <div class="hw-subject">${item.subject}</div>
                <div class="hw-meta">Teacher: ${item.teacher} | Due: ${item.dueDate}</div>
                <p>${item.instructions}</p>
              </div>
            `;
          });
        }
        container.innerHTML = html;
      }
    }

    // Render Teachers
    function renderTeachers() {
      let html = '<h2>Our Teachers</h2><div class="teacher-grid">';
      teachersData.forEach(teacher => {
        html += `
          <div class="card teacher-card">
            <img src="${teacher.photo || 'https://placehold.co/300x200/1e40af/ffffff?text=Teacher'}" alt="${teacher.name}">
            <div class="teacher-info">
              <h3>${teacher.name}</h3>
              <p>${teacher.subject}</p>
              <button class="btn" onclick="window.location.href='tel:${teacher.phone}'">📞 Call</button>
              <button class="btn btn-outline" onclick="window.location.href='mailto:${teacher.email}'">📧 Email</button>
            </div>
          </div>
        `;
      });
      html += '</div>';
      return html;
    }

    // Render Events
    function renderEvents() {
      let html = '<h2>School Events</h2><div class="event-timeline">';
      eventsData.forEach(event => {
        html += `
          <div class="card event-item">
            <h3>${event.title}</h3>
            <p class="hw-meta">📅 ${event.date} | 📍 ${event.venue}</p>
            <p>${event.description}</p>
          </div>
        `;
      });
      html += '</div>';
      return html;
    }

    // Render Notices
    function renderNotices() {
      let html = '<h2>Notices & Announcements</h2>';
      noticesData.forEach(notice => {
        const badge = notice.urgent ? '<span class="notice-badge urgent">URGENT</span>' : '';
        html += `
          <div class="card">
            <h3>${notice.title} ${badge}</h3>
            <p class="hw-meta">📅 ${notice.date}</p>
            <p>${notice.message}</p>
          </div>
        `;
      });
      return html;
    }

    // Render Timetable
    function renderTimetable() {
      const tt = timetableData[studentData.class] || timetableData['1'];
      let days = Object.keys(tt);
      let html = '<h2>Class Timetable</h2><div class="card"><table class="timetable"><tr><th>Time</th>';
      
      days.forEach(day => {
        html += `<th>${day}</th>`;
      });
      html += '</tr>';

      // Assuming all days have same time slots
      const timeSlots = Object.keys(tt[days[0]]);
      timeSlots.forEach(time => {
        html += `<tr><td>${time}</td>`;
        days.forEach(day => {
          html += `<td>${tt[day][time] || '-'}</td>`;
        });
        html += '</tr>';
      });

      html += '</table></div>';
      return html;
    }

    // Render Gallery
    function renderGallery() {
      let html = '<h2>School Gallery</h2><div class="gallery-grid">';
      galleryData.forEach(item => {
        html += `
          <div class="card gallery-item" onclick="openLightbox('${item.url}')">
            <img src="${item.url}" alt="${item.caption}">
            <div class="gallery-caption">${item.caption}</div>
          </div>
        `;
      });
      html += '</div>';
      return html;
    }

    // Open Lightbox
    function openLightbox(src) {
      const lightbox = document.getElementById('lightbox');
      const img = document.getElementById('lightboxImg');
      img.src = src;
      lightbox.classList.add('active');
    }

    // Close Lightbox
    function closeLightbox() {
      document.getElementById('lightbox').classList.remove('active');
    }

    // Render FAQ
    function renderFAQ() {
      const faqs = [
        { q: "What are the school hours?", a: "School operates from 8:00 AM to 2:30 PM, Monday through Saturday." },
        { q: "What is the fee structure?", a: "Class 1–5: ₹6,000/year; Class 6–8: ₹8,000/year; Class 9–10: ₹10,000/year; Class 11–12: ₹12,000/year." },
        { q: "How can I contact teachers?", a: "Use the Teachers section to find contact details and reach out directly." },
        { q: "Are there extracurricular activities?", a: "Yes, we offer Sports, Music, Arts & Craft, and Science Club activities." }
      ];

      let html = '<h2>Frequently Asked Questions</h2>';
      faqs.forEach(item => {
        html += `
          <div class="accordion-item">
            <div class="accordion-header">
              <span>${item.q}</span>
              <span>+</span>
            </div>
            <div class="accordion-body">
              <p>${item.a}</p>
            </div>
          </div>
        `;
      });

      // Add accordion functionality
      setTimeout(() => {
        document.querySelectorAll('.accordion-header').forEach(header => {
          header.addEventListener('click', function() {
            const body = this.nextElementSibling;
            const isActive = body.style.display === 'block';
            document.querySelectorAll('.accordion-body').forEach(b => b.style.display = 'none');
            document.querySelectorAll('.accordion-header span:last-child').forEach(s => s.textContent = '+');
            if (!isActive) {
              body.style.display = 'block';
              this.querySelector('span:last-child').textContent = '−';
            }
          });
        });
      }, 100);

      return html;
    }

    // Render Achievements
    function renderAchievements() {
      return `
        <h2>School Achievements</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
          <div class="card" style="text-align: center;">
            <div class="achievement-counter" data-count="150">0</div>
            <p style="color: var(--text-dark);">Students</p>
          </div>
          <div class="card" style="text-align: center;">
            <div class="achievement-counter" data-count="12">0</div>
            <p style="color: var(--text-dark);">Teachers</p>
          </div>
          <div class="card" style="text-align: center;">
            <div class="achievement-counter" data-count="8">0</div>
            <p style="color: var(--text-dark);">Awards</p>
          </div>
          <div class="card" style="text-align: center;">
            <div class="achievement-counter" data-count="5">0</div>
            <p style="color: var(--text-dark);">Sports Titles</p>
          </div>
        </div>
        <div class="card" style="margin-top: 2rem;">
          <h3>Recent Accomplishments</h3>
          <p style="margin: 1rem 0;">• State Level Science Fair Winner (2023)<br>
          • District Chess Championship (2022, 2023)<br>
          • National Essay Writing Competition Runner-up<br>
          • Best School Infrastructure Award 2022</p>
        </div>
      `;
    }

    // Animate counters
    function animateCounters() {
      document.querySelectorAll('.achievement-counter').forEach(el => {
        const target = parseInt(el.getAttribute('data-count'));
        let count = 0;
        const duration = 2000;
        const step = target / (duration / 16);

        const timer = setInterval(() => {
          count += step;
          if (count >= target) {
            count = target;
            clearInterval(timer);
          }
          el.textContent = Math.floor(count);
        }, 16);
      });
    }

    // Render Contact
    function renderContact() {
      return `
        <h2>Contact Us</h2>
        <div class="card">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
            <div>
              <h3>Get In Touch</h3>
              <p style="color: var(--text-dark); margin: 1rem 0;">
                <strong>Address:</strong> Boluha Police Chowki Balrampur (U.P.)<br>
                <strong>Phone:</strong> <a href="tel:9758919151" style="color: var(--primary-light);">9758919151</a><br>
                <strong>Email:</strong> <a href="mailto:madamsir066@gmail.com" style="color: var(--primary-light);">madamsir066@gmail.com</a>
              </p>
            </div>
            <div>
              <form id="contactForm">
                <div class="form-group">
                  <label>Name</label>
                  <input type="text" required placeholder="Your name"/>
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <input type="email" required placeholder="Your email"/>
                </div>
                <div class="form-group">
                  <label>Message</label>
                  <textarea rows="3" required placeholder="Your message" style="width: 100%; padding: 0.8rem; border: 1px solid var(--border-dark); background: rgba(0,0,0,0.2); color: white; border-radius: 8px;"></textarea>
                </div>
                <button type="submit" class="btn">Send Message</button>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    // Handle contact form
    document.addEventListener('submit', function(e) {
      if (e.target.id === 'contactForm') {
        e.preventDefault();
        const form = e.target;
        const message = {
          name: form.querySelector('input[type="text"]').value,
          email: form.querySelector('input[type="email"]').value,
          message: form.querySelector('textarea').value,
          timestamp: new Date().toISOString(),
          read: false
        };

        messagesData.push(message);
        localStorage.setItem('mkps_messages', JSON.stringify(messagesData));
        localStorage.setItem('mkps_update', new Date().toISOString());
        
        alert('Thank you for your message! We will get back to you soon.');
        form.reset();
        updateAnalytics();
      }
    }, true);

    // Render About
    function renderAbout() {
      return `
        <h2>About Milli Karwaan Public School</h2>
        <div class="card">
          <p style="margin-bottom: 1rem; line-height: 1.8;">
            Milli Karwaan Public School Balrampur is dedicated to providing quality education with a focus on holistic development. 
            Established with the vision of creating responsible citizens, our school blends modern teaching methodologies with traditional values.
          </p>
          <p style="margin-bottom: 1rem; line-height: 1.8;">
            We offer comprehensive curriculum for classes 1 through 12, with emphasis on academic excellence, character building, 
            and extracurricular activities. Our experienced faculty is committed to nurturing each student's potential.
          </p>
          <div style="margin-top: 1.5rem;">
            <h3>Our Vision</h3>
            <p>To create a learning environment that fosters intellectual growth, moral integrity, and social responsibility.</p>
          </div>
          <div style="margin-top: 1.5rem;">
            <h3>Our Mission</h3>
            <p>To provide accessible, high-quality education that prepares students for academic success and life beyond school.</p>
          </div>
        </div>
      `;
    }

    // Update analytics
    function updateAnalytics() {
      if (studentData) {
        currentClassEl.textContent = `Class ${studentData.class}`;
      }
      hwCountEl.textContent = (homeworkData[studentData?.class] || []).length;
      msgCountEl.textContent = messagesData.length;
    }

    // Export all data
    window.exportMkpsData = function() {
      const data = {};
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('mkps_')) {
          data[key] = localStorage.getItem(key);
        }
      }
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `mkps_backup_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    };

    // Import data
    window.importMkpsData = function() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = e => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(event) {
            try {
              const data = JSON.parse(event.target.result);
              // Validate structure
              if (typeof data === 'object' && data !== null && Object.keys(data).some(k => k.startsWith('mkps_'))) {
                Object.keys(data).forEach(key => {
                  if (key.startsWith('mkps_')) {
                    localStorage.setItem(key, data[key]);
                  }
                });
                alert('Data imported successfully! Refreshing...');
                location.reload();
              } else {
                alert('Invalid data format. Please select a valid MKPS backup file.');
              }
            } catch (err) {
              alert('Error parsing file. Please select a valid JSON file.');
            }
          };
          reader.readAsText(file);
        }
      };
      input.click();
    };

    // Download HTML snapshot
    function downloadSnapshot() {
      const classNum = studentData.class;
      const hw = homeworkData[classNum] || [];
      
      let content = `
        <html>
        <head>
          <title>Homework Snapshot - Class ${classNum}</title>
          <style>
            body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; line-height: 1.6; }
            h1 { color: #1e40af; border-bottom: 2px solid #1e40af; padding-bottom: 10px; }
            .hw-item { background: #f8fafc; padding: 15px; margin: 15px 0; border-left: 4px solid #1e40af; border-radius: 0 8px 8px 0; }
            .hw-subject { font-weight: bold; color: #1e293b; }
            .hw-meta { color: #64748b; font-size: 0.9em; margin: 5px 0; }
            footer { margin-top: 40px; color: #64748b; font-size: 0.8em; text-align: center; }
          </style>
        </head>
        <body>
          <h1>Homework - Class ${classNum}</h1>
          <p><strong>Generated on:</strong> ${new Date().toLocaleString()}</p>
      `;

      if (hw.length === 0) {
        content += '<p>No homework assigned.</p>';
      } else {
        hw.forEach(item => {
          content += `
            <div class="hw-item">
              <div class="hw-subject">${item.subject}</div>
              <div class="hw-meta">Teacher: ${item.teacher} | Due: ${item.dueDate}</div>
              <p>${item.instructions}</p>
            </div>
          `;
        });
      }

      content += `
        <footer>
          Milli Karwaan Public School Balrampur | Boluha Police Chowki Balrampur (U.P.)
        </footer>
        </body>
        </html>
      `;

      const blob = new Blob([content], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `homework_class${classNum}_${new Date().toISOString().split('T')[0]}.html`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // Generate demo data
    function generateDemoHomework() {
      const subjects = ['Mathematics', 'Science', 'English', 'Hindi', 'Social Studies', 'Computer Science', 'Arts & Craft', 'Physical Education'];
      const teachers = ['Arif Khan', 'Shruti Verma', 'Prakash Singh', 'Riya Thomas', 'Neeraj Gupta', 'Alka Sharma'];
      
      const data = {};
      for (let i = 1; i <= 12; i++) {
        data[i] = [];
        const count = Math.floor(Math.random() * 3) + 1;
        for (let j = 0; j < count; j++) {
          const subject = subjects[Math.floor(Math.random() * subjects.length)];
          data[i].push({
            subject,
            teacher: teachers[Math.floor(Math.random() * teachers.length)],
            dueDate: new Date(Date.now() + Math.random() * 7 * 24 * 60 * 60 * 1000).toLocaleDateString(),
            instructions: `Complete exercises on ${subject.toLowerCase()} concepts covered in class. Submit next ${['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'][Math.floor(Math.random() * 5)]}.`
          });
        }
      }
      localStorage.setItem('mkps_homework', JSON.stringify(data));
      return data;
    }

    function generateDemoTeachers() {
      return [
        { name: 'Arif Khan', subject: 'Mathematics', phone: '9876543210', email: 'arif.khan@mkps.edu', photo: 'https://placehold.co/300x200/1e40af/ffffff?text=Arif+Khan' },
        { name: 'Shruti Verma', subject: 'Science', phone: '9876543211', email: 'shruti.verma@mkps.edu', photo: 'https://placehold.co/300x200/1e40af/ffffff?text=Shruti+Verma' },
        { name: 'Prakash Singh', subject: 'English', phone: '9876543212', email: 'prakash.singh@mkps.edu', photo: 'https://placehold.co/300x200/1e40af/ffffff?text=Prakash+Singh' },
        { name: 'Riya Thomas', subject: 'Computer Science', phone: '9876543213', email: 'riya.thomas@mkps.edu', photo: 'https://placehold.co/300x200/1e40af/ffffff?text=Riya+Thomas' },
        { name: 'Neeraj Gupta', subject: 'Social Studies', phone: '9876543214', email: 'neeraj.gupta@mkps.edu', photo: 'https://placehold.co/300x200/1e40af/ffffff?text=Neeraj+Gupta' },
        { name: 'Alka Sharma', subject: 'Hindi', phone: '9876543215', email: 'alka.sharma@mkps.edu', photo: 'https://placehold.co/300x200/1e40af/ffffff?text=Alka+Sharma' }
      ];
    }

    function generateDemoEvents() {
      return [
        { title: 'Annual Day Celebration', date: '2023-12-15', venue: 'School Ground', description: 'Annual cultural festival with performances by students of all classes.' },
        { title: 'Science Fair', date: '2024-01-10', venue: 'Science Lab', description: 'Students will present science projects and experiments.' },
        { title: 'Sports Day', date: '2024-02-20', venue: 'Playground', description: 'Inter-class sports competition with various track and field events.' },
        { title: 'Parent-Teacher Meeting', date: '2024-03-05', venue: 'Classrooms', description: 'Discussion about student progress and academic planning.' }
      ];
    }

    function generateDemoNotices() {
      return [
        { title: 'Holiday Announcement', date: '2023-11-01', message: 'School will remain closed on November 12th for Diwali celebrations.', urgent: false },
        { title: 'Fee Submission', date: '2023-11-05', message: 'Please submit quarterly fees by November 15th to avoid late charges.', urgent: true },
        { title: 'New Bus Route', date: '2023-11-10', message: 'Effective from Monday, the school bus will take a new route to accommodate more students.', urgent: false }
      ];
    }

    function generateDemoTimetable() {
      const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
      const timeSlots = ['8:00-9:00', '9:00-10:00', '10:00-11:00', '11:00-12:00', '12:00-1:00', '1:00-2:00'];
      const subjects = ['Math', 'Science', 'English', 'Hindi', 'SST', 'CS', 'PT', 'Art', 'Break'];
      
      const data = {};
      for (let cls = 1; cls <= 12; cls++) {
        data[cls] = {};
        days.forEach(day => {
          data[cls][day] = {};
          timeSlots.forEach(time => {
            data[cls][day][time] = subjects[Math.floor(Math.random() * subjects.length)];
            if (data[cls][day][time] === 'Break') {
              data[cls][day][time] = 'Break';
            }
          });
        });
      }
      return data;
    }

    function generateDemoGallery() {
      return [
        { url: 'https://placehold.co/600x400/1e40af/ffffff?text=Annual+Day', caption: 'Annual Day Celebration 2023' },
        { url: 'https://placehold.co/600x400/1e40af/ffffff?text=Science+Fair', caption: 'Science Fair Exhibition' },
        { url: 'https://placehold.co/600x400/1e40af/ffffff?text=Sports+Day', caption: 'Sports Day Activities' },
        { url: 'https://placehold.co/600x400/1e40af/ffffff?text=Classroom', caption: 'Modern Classroom Setup' }
      ];
    }

    // Admin functions
    window.refreshTeachers = function() {
      const data = localStorage.getItem('mkps_teachers');
      teachersData = data ? JSON.parse(data) : teachersData;
      if (document.querySelector('.nav-link.active')?.getAttribute('data-section') === 'teachers') {
        renderSection('teachers');
      }
    };

    window.refreshEvents = function() {
      const data = localStorage.getItem('mkps_events');
      eventsData = data ? JSON.parse(data) : eventsData;
      if (document.querySelector('.nav-link.active')?.getAttribute('data-section') === 'events') {
        renderSection('events');
      }
    };

    window.refreshNotices = function() {
      const data = localStorage.getItem('mkps_notices');
      noticesData = data ? JSON.parse(data) : noticesData;
      if (document.querySelector('.nav-link.active')?.getAttribute('data-section') === 'notices') {
        renderSection('notices');
      }
    };

    window.refreshTimetable = function() {
      const data = localStorage.getItem('mkps_timetable');
      timetableData = data ? JSON.parse(data) : timetableData;
      if (document.querySelector('.nav-link.active')?.getAttribute('data-section') === 'timetable') {
        renderSection('timetable');
      }
    };

    window.refreshGallery = function() {
      const data = localStorage.getItem('mkps_gallery');
      galleryData = data ? JSON.parse(data) : galleryData;
      if (document.querySelector('.nav-link.active')?.getAttribute('data-section') === 'gallery') {
        renderSection('gallery');
      }
    };

    window.refreshMessages = function() {
      const data = localStorage.getItem('mkps_messages');
      messagesData = data ? JSON.parse(data) : messagesData;
      updateAnalytics();
    };

    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
      checkTheme();
      checkStudentData();
      
      // Animate counters when achievements section is visible
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            animateCounters();
            observer.unobserve(entry.target);
          }
        });
      });
      
      const achievementCounters = document.querySelector('.achievement-counter');
      if (achievementCounters) {
        observer.observe(achievementCounters);
      }
    });
  </script>
</body>
</html>
