<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Milli Karwaan Public School</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #003366;
      --accent: #00ccff;
      --accent-glow: #00ffff;
      --light: #f0f5ff;
      --dark: #0a1a2f;
      --success: #00cc66;
      --warning: #ff9900;
      --card-bg: rgba(255, 255, 255, 0.1);
      --shadow: 0 8px 32px rgba(0, 51, 102, 0.2);
      --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    .dark-mode {
      --primary: #002244;
      --accent: #00aaff;
      --accent-glow: #00bbff;
      --light: #121212;
      --dark: #f0f0f0;
      --card-bg: rgba(10, 26, 47, 0.3);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background: #000 url('https://images.unsplash.com/photo-1580581244-3a931825b9c1?ixlib=rb-4.0.3') no-repeat center center fixed;
      background-size: cover;
      color: var(--dark);
      line-height: 1.7;
      overflow-x: hidden;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: -1;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      flex: 1;
    }
    .gate-form {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .gate-card {
      background: var(--card-bg);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 204, 255, 0.3);
      border-radius: 20px;
      padding: 40px;
      width: 100%;
      max-width: 500px;
      text-align: center;
      box-shadow: var(--shadow);
      transform: translateY(0);
      animation: float 6s ease-in-out infinite;
      border-image: linear-gradient(45deg, var(--accent), var(--accent-glow)) 1;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(1deg); }
    }
    .gate-card h2 {
      font-family: 'Orbitron', sans-serif;
      color: var(--accent-glow);
      margin-bottom: 20px;
      text-shadow: 0 0 10px var(--accent);
      font-size: 2em;
    }
    .input-group {
      margin: 20px 0;
      text-align: left;
    }
    .input-group label {
      display: block;
      color: var(--accent);
      margin-bottom: 8px;
      font-weight: 500;
    }
    .input-group input, .input-group select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(0, 204, 255, 0.5);
      background: rgba(0, 30, 60, 0.4);
      color: white;
      border-radius: 8px;
      font-size: 1em;
    }
    .btn {
      padding: 14px 30px;
      background: var(--accent);
      color: var(--dark);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1em;
      margin-top: 20px;
      box-shadow: 0 0 20px rgba(0, 204, 255, 0.4);
      transition: var(--transition);
    }
    .btn:hover {
      background: var(--accent-glow);
      transform: translateY(-3px);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      background: rgba(0, 30, 60, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--accent);
      position: sticky;
      top: 0;
      z-index: 1000;
      transform: translateZ(0);
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .logo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid var(--accent);
      box-shadow: 0 0 20px var(--accent);
    }
    .school-info h1 {
      font-family: 'Orbitron', sans-serif;
      color: white;
      font-size: 1.6em;
      text-shadow: 0 0 10px var(--accent);
    }
    .school-info p {
      color: var(--accent);
      font-size: 0.9em;
    }
    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      text-align: right;
    }
    .contact-info {
      font-size: 0.9em;
      color: #ccc;
    }
    .call-btn {
      margin-top: 10px;
      padding: 12px 25px;
      background: var(--success);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 20px rgba(0, 204, 102, 0.5);
      transition: var(--transition);
    }
    .call-btn:hover {
      background: #00e676;
      transform: scale(1.05);
    }
    nav {
      background: rgba(10, 30, 60, 0.9);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(0, 204, 255, 0.3);
    }
    .nav-links {
      display: flex;
      gap: 20px;
    }
    .nav-links a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      padding: 8px 12px;
      border-radius: 6px;
      transition: var(--transition);
    }
    .nav-links a:hover {
      background: var(--accent);
      color: var(--dark);
    }
    .menu-toggle {
      display: none;
      background: var(--accent);
      color: var(--dark);
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    .section {
      margin: 40px 0;
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 0.8s forwards;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 204, 255, 0.2);
      border-radius: 15px;
      padding: 30px;
      box-shadow: var(--shadow);
    }
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .section:nth-child(2) { animation-delay: 0.2s; }
    .section:nth-child(3) { animation-delay: 0.4s; }
    .section:nth-child(4) { animation-delay: 0.6s; }
    .section:nth-child(5) { animation-delay: 0.8s; }
    .section:nth-child(6) { animation-delay: 1s; }
    .section:nth-child(7) { animation-delay: 1.2s; }
    .section:nth-child(8) { animation-delay: 1.4s; }
    .section:nth-child(9) { animation-delay: 1.6s; }
    .section:nth-child(10) { animation-delay: 1.8s; }
    .section h2 {
      font-family: 'Orbitron', sans-serif;
      color: var(--accent-glow);
      margin-bottom: 20px;
      font-size: 1.8em;
      text-shadow: 0 0 10px rgba(0, 204, 255, 0.3);
      position: relative;
      display: inline-block;
    }
    .section h2::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 60%;
      height: 3px;
      background: var(--accent);
    }
    .welcome {
      text-align: center;
      font-size: 1.3em;
      color: var(--accent);
      margin-bottom: 20px;
    }
    .homework-cards {
      display: grid;
      gap: 20px;
      margin-top: 20px;
    }
    .homework-card {
      background: rgba(0, 30, 60, 0.5);
      border: 1px solid rgba(0, 204, 255, 0.3);
      border-radius: 12px;
      padding: 20px;
      transition: var(--transition);
    }
    .homework-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      border-color: var(--accent);
    }
    .homework-card h3 {
      color: var(--accent-glow);
      margin-bottom: 10px;
    }
    .teacher-cards, .gallery-grid, .notice-list, .event-timeline {
      display: grid;
      gap: 20px;
    }
    .teacher-cards {
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
    .gallery-grid {
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }
    .event-timeline {
      gap: 30px;
    }
    .teacher-card, .gallery-item, .notice-item, .event-item {
      background: var(--card-bg);
      border: 1px solid rgba(0, 204, 255, 0.2);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: var(--transition);
    }
    .teacher-card:hover, .gallery-item:hover, .notice-item:hover, .event-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }
    .gallery-item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
    }
    .notice-priority {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: bold;
      color: white;
      margin-right: 10px;
    }
    .high { background: #ff3333; }
    .medium { background: #ff9900; }
    .low { background: #33cc33; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    th {
      background: rgba(0, 204, 255, 0.2);
      color: var(--accent);
    }
    tr:hover {
      background: rgba(0, 204, 255, 0.1);
    }
    .faq-item {
      margin-bottom: 15px;
      border: 1px solid rgba(0, 204, 255, 0.2);
      border-radius: 10px;
      overflow: hidden;
    }
    .faq-question {
      padding: 15px;
      background: rgba(0, 30, 60, 0.5);
      color: var(--accent);
      cursor: pointer;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .faq-answer {
      padding: 0 15px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease;
    }
    .faq-answer p {
      padding: 15px 0;
      color: #ddd;
    }
    .faq-item.active .faq-answer {
      max-height: 200px;
    }
    .contact-form {
      display: grid;
      gap: 15px;
    }
    .contact-form input, .contact-form textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid rgba(0, 204, 255, 0.3);
      background: rgba(0, 30, 60, 0.4);
      color: white;
      border-radius: 8px;
    }
    .contact-form textarea {
      height: 120px;
      resize: vertical;
    }
    .about-content, .achievements {
      line-height: 1.8;
      color: #ddd;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      margin: 30px 0;
      flex-wrap: wrap;
      gap: 10px;
    }
    .stat-item {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      min-width: 120px;
      border: 1px solid rgba(0, 204, 255, 0.2);
    }
    .stat-number {
      font-size: 2em;
      font-weight: bold;
      color: var(--accent-glow);
      font-family: 'Orbitron', sans-serif;
    }
    .sidebar {
      position: fixed;
      right: -300px;
      top: 0;
      width: 300px;
      height: 100%;
      background: rgba(0, 20, 40, 0.95);
      backdrop-filter: blur(10px);
      border-left: 1px solid var(--accent);
      padding: 20px;
      transition: var(--transition);
      z-index: 1100;
      color: white;
    }
    .sidebar.open {
      right: 0;
    }
    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--accent);
    }
    .close-sidebar {
      background: #ff3333;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .search-box {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--accent);
      background: rgba(0, 30, 60, 0.5);
      color: white;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .admin-links a {
      display: block;
      padding: 10px;
      color: var(--accent);
      text-decoration: none;
      margin-bottom: 10px;
      border-radius: 6px;
    }
    .admin-links a:hover {
      background: var(--accent);
      color: var(--dark);
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: center;
    }
    .modal {
      background: var(--light);
      border-radius: 15px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .close-modal {
      background: #ff3333;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .print-view {
      display: none;
    }
    .theme-toggle {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--accent);
      color: var(--dark);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5em;
      cursor: pointer;
      box-shadow: 0 0 20px rgba(0, 204, 255, 0.5);
      z-index: 1200;
    }
    @media (max-width: 768px) {
      .nav-links { display: none; }
      .menu-toggle { display: block; }
      .teacher-cards, .gallery-grid { grid-template-columns: 1fr; }
      .homework-cards { grid-template-columns: 1fr; }
      .event-timeline { grid-template-columns: 1fr; }
      .stats { flex-direction: column; align-items: center; }
      .header {
        flex-direction: column;
        text-align: center;
        gap: 15px;
      }
      .header-right { align-items: center; }
      .contact-info br { display: none; }
    }
    @media print {
      body * { visibility: hidden; }
      .print-view, .print-view * { visibility: visible; }
      .print-view {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
      .header, .nav, .sidebar, .theme-toggle, .gate-form { display: none !important; }
    }
    .lightbox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    .lightbox img {
      max-width: 90%;
      max-height: 80vh;
      border: 5px solid var(--accent);
      border-radius: 10px;
      box-shadow: 0 0 30px var(--accent);
    }
    .lightbox-nav {
      margin-top: 20px;
      color: white;
      font-size: 2em;
      display: flex;
      gap: 30px;
    }
    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 30px;
      color: white;
      font-size: 2em;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- GATE FORM -->
  <div class="gate-form" id="gateForm">
    <div class="gate-card">
      <h2>Student Access</h2>
      <p>Enter your details to access the portal</p>
      <div class="input-group">
        <label>Student Name</label>
        <input type="text" id="studentName" required>
      </div>
      <div class="input-group">
        <label>Class (1â€“12)</label>
        <select id="studentClass" required>
          <option value="">Select Class</option>
          <script>for(let i=1;i<=12;i++)document.write(`<option value="${i}">${i}</option>`);</script>
        </select>
      </div>
      <div class="input-group">
        <label>Parent's Name</label>
        <input type="text" id="parentName" required>
      </div>
      <button class="btn" onclick="submitGate()">Enter Portal</button>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div id="mainContent" style="display:none">

    <!-- HEADER -->
    <header class="header">
      <div class="header-left">
        <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo" class="logo">
        <div class="school-info">
          <h1>Milli Karwaan Public School</h1>
          <p>Balrampur, Uttar Pradesh</p>
        </div>
      </div>
      <div class="header-right">
        <div class="contact-info">
          Boluha Police Chowki<br>
          madamsir066@gmail.com
        </div>
        <a href="tel:9758919151" class="call-btn">ðŸ“ž CALL NOW</a>
      </div>
    </header>

    <!-- NAVIGATION -->
    <nav>
      <div class="nav-links" id="navLinks">
        <a href="#homework">Homework</a>
        <a href="#teachers">Teachers</a>
        <a href="#events">Events</a>
        <a href="#notices">Notices</a>
        <a href="#timetable">Timetable</a>
        <a href="#gallery">Gallery</a>
        <a href="#faq">FAQ</a>
        <a href="#contact">Contact</a>
        <a href="#about">About</a>
        <a href="#" onclick="document.getElementById('exportModal').style.display='flex'">Export Data</a>
        <a href="#" onclick="document.getElementById('importModal').style.display='flex'">Import Data</a>
        <a href="#" onclick="downloadSnapshot()">Snapshot</a>
        <a href="#" onclick="document.getElementById('messagesModal').style.display='flex'">Messages</a>
      </div>
      <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>
    </nav>

    <div class="container">

      <!-- WELCOME MESSAGE -->
      <div class="welcome" id="welcomeMsg"></div>

      <!-- STATS -->
      <div class="stats">
        <div class="stat-item">
          <div class="stat-number" id="studentCount">0</div>
          <div>Students</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="teacherCount">0</div>
          <div>Teachers</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="noticeCount">0</div>
          <div>Notices</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="photoCount">0</div>
          <div>Photos</div>
        </div>
      </div>

      <!-- HOMEWORK -->
      <section class="section" id="homework">
        <h2>Homework</h2>
        <div class="input-group">
          <input type="text" id="searchHomework" placeholder="Search homework..." onkeyup="searchHomework()">
        </div>
        <div class="homework-cards" id="homeworkCards"></div>
      </section>

      <!-- TEACHERS -->
      <section class="section" id="teachers">
        <h2>Our Teachers</h2>
        <div class="teacher-cards" id="teacherCards"></div>
      </section>

      <!-- EVENTS -->
      <section class="section" id="events">
        <h2>School Events</h2>
        <div class="event-timeline" id="eventTimeline"></div>
      </section>

      <!-- NOTICES -->
      <section class="section" id="notices">
        <h2>Notices</h2>
        <div class="notice-list" id="noticeList"></div>
      </section>

      <!-- TIMETABLE -->
      <section class="section" id="timetable">
        <h2>Class Timetable</h2>
        <table id="timeTable"></table>
      </section>

      <!-- GALLERY -->
      <section class="section" id="gallery">
        <h2>Photo Gallery</h2>
        <div class="gallery-grid" id="galleryGrid"></div>
      </section>

      <!-- FAQ -->
      <section class="section" id="faq">
        <h2>Frequently Asked Questions</h2>
        <div class="faq-item">
          <div class="faq-question" onclick="toggleFAQ(this)">
            When does the school start? <i class="fas fa-plus"></i>
          </div>
          <div class="faq-answer"><p>School starts at 7:30 AM for all classes.</p></div>
        </div>
        <div class="faq-item">
          <div class="faq-question" onclick="toggleFAQ(this)">
            What is the uniform policy? <i class="fas fa-plus"></i>
          </div>
          <div class="faq-answer"><p>Monday to Thursday: Full uniform. Friday: House dress. Saturday: Games dress.</p></div>
        </div>
      </section>

      <!-- CONTACT -->
      <section class="section" id="contact">
        <h2>Contact Us</h2>
        <form class="contact-form" onsubmit="saveMessage(event)">
          <div class="input-group">
            <label>Name</label>
            <input type="text" id="msgName" required>
          </div>
          <div class="input-group">
            <label>Email</label>
            <input type="email" id="msgEmail" required>
          </div>
          <div class="input-group">
            <label>Message</label>
            <textarea id="msgText" required></textarea>
          </div>
          <button type="submit" class="btn">Send Message</button>
        </form>
      </section>

      <!-- ABOUT -->
      <section class="section" id="about">
        <h2>About Us</h2>
        <div class="about-content">
          <p>Milli Karwaan Public School, established in 1995, is a leading educational institution in Balrampur, Uttar Pradesh. We are committed to providing quality education with modern facilities and experienced faculty.</p>
        </div>
        <h2 style="margin-top:30px">Achievements</h2>
        <div class="achievements">
          <p>Our students have consistently achieved top ranks in CBSE board exams. We have won multiple awards in sports, science exhibitions, and cultural events at district and state levels.</p>
        </div>
      </section>

    </div>

  </div>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox">
    <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
    <img id="lightboxImg" src="" alt="Enlarged photo">
    <div class="lightbox-nav">
      <span onclick="prevImage()">&lt;</span>
      <span onclick="nextImage()">&gt;</span>
    </div>
  </div>

  <!-- MODALS -->
  <div class="overlay" id="exportModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Export Data</h3>
        <button class="close-modal" onclick="closeModal('exportModal')">âœ•</button>
      </div>
      <p>Export all school data as JSON file.</p>
      <button class="btn" onclick="exportData()">Download JSON</button>
    </div>
  </div>

  <div class="overlay" id="importModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Import Data</h3>
        <button class="close-modal" onclick="closeModal('importModal')">âœ•</button>
      </div>
      <p>Upload a JSON file to import school data.</p>
      <input type="file" id="importFile" accept=".json">
      <button class="btn" onclick="importData()" style="margin-top:10px">Upload & Import</button>
    </div>
  </div>

  <div class="overlay" id="messagesModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Saved Messages</h3>
        <button class="close-modal" onclick="closeModal('messagesModal')">âœ•</button>
      </div>
      <div id="messagesList"></div>
    </div>
  </div>

  <!-- THEME TOGGLE -->
  <div class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</div>

  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h3>Quick Access</h3>
      <button class="close-sidebar" onclick="closeSidebar()">âœ•</button>
    </div>
    <input type="text" class="search-box" placeholder="Quick search..." onkeyup="quickSearch(this.value)">
    <div class="admin-links">
      <a href="#" onclick="renderHomeworkFor(document.getElementById('studentClass').value)">View Class HW</a>
      <a href="#" onclick="refreshTeachers()">Refresh Teachers</a>
      <a href="#" onclick="printView()">Print View</a>
      <a href="#" onclick="resetApp()">Reset App</a>
    </div>
  </div>

  <script>
    // Initialize localStorage defaults
    const defaults = {
      mkps_homework: {},
      mkps_teachers: [
        {name: "Ramesh Singh", subject: "Mathematics", class: "9-12", img: "https://randomuser.me/api/portraits/men/32.jpg"},
        {name: "Sunita Devi", subject: "Science", class: "6-8", img: "https://randomuser.me/api/portraits/women/44.jpg"},
        {name: "Amit Kumar", subject: "English", class: "1-5", img: "https://randomuser.me/api/portraits/men/62.jpg"}
      ],
      mkps_events: [
        {title: "Annual Day", date: "2025-03-15", desc: "Cultural festival and prize distribution"},
        {title: "PTM", date: "2025-03-20", desc: "Parent-Teacher Meeting for all classes"}
      ],
      mkps_notices: [
        {title: "Holiday on Monday", date: "2025-03-10", priority: "high", desc: "Republic Day celebration"},
        {title: "Exam Schedule", date: "2025-03-05", priority: "medium", desc: "Class 10 & 12 exams start from March 25"}
      ],
      mkps_timetable: {
        "9": ["Mon: Math, Sci, Eng, Hin", "Tue: Soc, Mat, Hin, Eng", "Wed: Sci, Mat, Hin, Eng"],
        "10": ["Mon: Bio, Che, Phy, Eng", "Tue: Mat, Hin, Soc, Eng", "Wed: Che, Bio, Phy, Hin"]
      },
      mkps_gallery: [
        "https://images.unsplash.com/photo-1523050854058-8df90110c9f1",
        "https://images.unsplash.com/photo-1498952035770-c65988d085bd",
        "https://images.unsplash.com/photo-1534006903508-67944242e01b"
      ],
      mkps_messages: [],
      mkps_update: Date.now()
    };

    Object.keys(defaults).forEach(k => {
      if (!localStorage.getItem(k)) localStorage.setItem(k, JSON.stringify(defaults[k]));
    });

    // Student Gate
    function submitGate() {
      const name = document.getElementById('studentName').value;
      const cls = document.getElementById('studentClass').value;
      const parent = document.getElementById('parentName').value;
      if (!name || !cls || !parent) return alert('Please fill all fields');
      
      localStorage.setItem('mkps_student', JSON.stringify({name, cls, parent}));
      showMainPortal();
    }

    function showMainPortal() {
      document.getElementById('gateForm').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
      
      const student = JSON.parse(localStorage.getItem('mkps_student'));
      document.getElementById('welcomeMsg').innerHTML = `Welcome, <strong>${student.name}</strong> (Class ${student.cls})`;
      
      // Prevent back
      history.pushState(null, null, location.href);
      window.onpopstate = () => history.pushState(null, null, location.href);
      
      loadAllData();
    }

    // Check if student already logged in
    if (localStorage.getItem('mkps_student')) {
      showMainPortal();
    }

    // Load all data
    function loadAllData() {
      renderHomework();
      renderTeachers();
      renderEvents();
      renderNotices();
      renderTimetable();
      renderGallery();
      renderMessages();
      updateStats();
    }

    function renderHomework() {
      const student = JSON.parse(localStorage.getItem('mkps_student'));
      const homework = JSON.parse(localStorage.getItem('mkps_homework'))[student.cls] || [];
      const container = document.getElementById('homeworkCards');
      container.innerHTML = homework.map(hw => `
        <div class="homework-card">
          <h3>${hw.subject}</h3>
          <p><strong>Date:</strong> ${hw.date}</p>
          <p><strong>Teacher:</strong> ${hw.teacher}</p>
          <p>${hw.instructions}</p>
        </div>
      `).join('');
    }

    function renderTeachers() {
      const teachers = JSON.parse(localStorage.getItem('mkps_teachers'));
      const container = document.getElementById('teacherCards');
      container.innerHTML = teachers.map(t => `
        <div class="teacher-card">
          <img src="${t.img}" alt="${t.name}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;">
          <h3>${t.name}</h3>
          <p>${t.subject}</p>
          <p>Class ${t.class}</p>
        </div>
      `).join('');
    }

    function renderEvents() {
      const events = JSON.parse(localStorage.getItem('mkps_events'));
      const container = document.getElementById('eventTimeline');
      container.innerHTML = events.map(e => `
        <div class="event-item">
          <h3>${e.title}</h3>
          <p><strong>Date:</strong> ${e.date}</p>
          <p>${e.desc}</p>
        </div>
      `).join('');
    }

    function renderNotices() {
      const notices = JSON.parse(localStorage.getItem('mkps_notices'));
      const container = document.getElementById('noticeList');
      container.innerHTML = notices.map(n => `
        <div class="notice-item">
          <span class="notice-priority ${n.priority}">${n.priority.toUpperCase()}</span>
          <h3>${n.title}</h3>
          <p><strong>Date:</strong> ${n.date}</p>
          <p>${n.desc}</p>
        </div>
      `).join('');
    }

    function renderTimetable() {
      const student = JSON.parse(localStorage.getItem('mkps_student'));
      const timetable = JSON.parse(localStorage.getItem('mkps_timetable'))[student.cls] || ['No timetable available'];
      const table = document.getElementById('timeTable');
      table.innerHTML = '<tr><th>Day & Periods</th></tr>' + timetable.map(t => `<tr><td>${t}</td></tr>`).join('');
    }

    function renderGallery() {
      const gallery = JSON.parse(localStorage.getItem('mkps_gallery'));
      const container = document.getElementById('galleryGrid');
      container.innerHTML = gallery.map(img => `
        <div class="gallery-item" onclick="openLightbox('${img}')">
          <img src="${img}" alt="School photo">
        </div>
      `).join('');
    }

    function renderMessages() {
      const messages = JSON.parse(localStorage.getItem('mkps_messages'));
      const container = document.getElementById('messagesList');
      container.innerHTML = messages.length ? 
        messages.map(m => `<div style="margin:15px 0;padding:10px;background:#f0f0f0;color:#333;"><strong>${m.name}</strong> (${m.email}):<br>${m.text}<br><small>${m.date}</small></div>`).join('') :
        '<p>No messages yet.</p>';
    }

    function updateStats() {
      const student = JSON.parse(localStorage.getItem('mkps_student') || '{}');
      document.getElementById('studentCount').textContent = 450;
      document.getElementById('teacherCount').textContent = document.getElementById('teacherCards').children.length;
      document.getElementById('noticeCount').textContent = document.getElementById('noticeList').children.length;
      document.getElementById('photoCount').textContent = document.getElementById('galleryGrid').children.length;
    }

    // Functionalities
    function searchHomework() {
      const term = document.getElementById('searchHomework').value.toLowerCase();
      const cards = document.querySelectorAll('.homework-card');
      cards.forEach(card => {
        const text = card.innerText.toLowerCase();
        card.style.display = text.includes(term) ? 'block' : 'none';
      });
    }

    function saveMessage(e) {
      e.preventDefault();
      const name = document.getElementById('msgName').value;
      const email = document.getElementById('msgEmail').value;
      const text = document.getElementById('msgText').value;
      const messages = JSON.parse(localStorage.getItem('mkps_messages'));
      messages.push({name, email, text, date: new Date().toLocaleString()});
      localStorage.setItem('mkps_messages', JSON.stringify(messages));
      localStorage.setItem('mkps_update', Date.now());
      alert('Message saved!');
      document.getElementById('msgName').value = '';
      document.getElementById('msgEmail').value = '';
      document.getElementById('msgText').value = '';
      renderMessages();
    }

    // Admin Functions
    window.renderHomeworkFor = function(cls) {
      const homework = JSON.parse(localStorage.getItem('mkps_homework'))[cls] || [];
      const container = document.getElementById('homeworkCards');
      container.innerHTML = homework.map(hw => `
        <div class="homework-card">
          <h3>${hw.subject}</h3>
          <p><strong>Date:</strong> ${hw.date}</p>
          <p><strong>Teacher:</strong> ${hw.teacher}</p>
          <p>${hw.instructions}</p>
        </div>
      `).join('');
    };

    window.refreshTeachers = function() {
      renderTeachers();
    };

    // Utilities
    function exportData() {
      const data = {};
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('mkps_')) {
          data[key] = JSON.parse(localStorage.getItem(key));
        }
      }
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `mkps_backup_${new Date().toISOString().slice(0,10)}.json`;
      a.click();
    }

    function importData() {
      const file = document.getElementById('importFile').files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          Object.keys(data).forEach(k => {
            if (k.startsWith('mkps_')) {
              localStorage.setItem(k, JSON.stringify(data[k]));
            }
          });
          localStorage.setItem('mkps_update', Date.now());
          alert('Data imported successfully!');
          location.reload();
        } catch (err) {
          alert('Invalid JSON file. Resetting to defaults.');
          resetApp();
        }
      };
      reader.readAsText(file);
    }

    function downloadSnapshot() {
      const html = `<!DOCTYPE html><html><head><title>Milli Karwaan Snapshot</title></head><body>
        <h1>Milli Karwaan Public School - Data Snapshot</h1>
        <p>Generated on: ${new Date().toLocaleString()}</p>
        ${document.querySelector('.print-view')?.innerHTML || document.body.innerHTML}
        </body></html>`;
      const blob = new Blob([html], {type: 'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'mkps_snapshot.html';
      a.click();
    }

    function printView() {
      window.print();
    }

    function resetApp() {
      if (confirm('Reset all data? This cannot be undone.')) {
        localStorage.clear();
        alert('App reset. Reloading...');
        location.reload();
      }
    }

    // UX Functions
    function toggleMenu() {
      document.getElementById('navLinks').style.display = 
        document.getElementById('navLinks').style.display === 'flex' ? 'none' : 'flex';
    }

    function toggleFAQ(element) {
      const item = element.parentElement;
      item.classList.toggle('active');
      const icon = element.querySelector('i');
      icon.classList.toggle('fa-plus');
      icon.classList.toggle('fa-minus');
    }

    function openLightbox(src) {
      document.getElementById('lightboxImg').src = src;
      document.getElementById('lightbox').style.display = 'flex';
    }

    function closeLightbox() {
      document.getElementById('lightbox').style.display = 'none';
    }

    let currentImageIndex = 0;
    const gallery = JSON.parse(localStorage.getItem('mkps_gallery'));

    function nextImage() {
      currentImageIndex = (currentImageIndex + 1) % gallery.length;
      document.getElementById('lightboxImg').src = gallery[currentImageIndex];
    }

    function prevImage() {
      currentImageIndex = (currentImageIndex - 1 + gallery.length) % gallery.length;
      document.getElementById('lightboxImg').src = gallery[currentImageIndex];
    }

    // Keyboard navigation for lightbox
    document.addEventListener('keydown', (e) => {
      if (document.getElementById('lightbox').style.display === 'flex') {
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowRight') nextImage();
        if (e.key === 'ArrowLeft') prevImage();
      }
    });

    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const themeBtn = document.querySelector('.theme-toggle');
      themeBtn.innerHTML = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ðŸŒ™';
    }

    function quickSearch(term) {
      document.querySelectorAll('.section').forEach(sec => {
        if (sec.innerText.toLowerCase().includes(term.toLowerCase())) {
          sec.scrollIntoView({behavior: 'smooth'});
        }
      });
    }

    function closeModal(id) {
      document.getElementById(id).style.display = 'none';
    }

    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('open');
    }

    document.querySelector('.theme-toggle').innerHTML = 'ðŸŒ™';
  </script>

  <!-- PRINT VIEW (HIDDEN) -->
  <div class="print-view" id="printView">
    <h1>Milli Karwaan Public School - Homework Print</h1>
    <div id="printHomework"></div>
  </div>

</body>
</html>
